{"version":3,"sources":["home.js"],"names":["layui","config","base","extend","index","use","layer","undefined","parent","consts","laypage","laydata","common","element","$","jquery","renderNav","manager","Oidc","UserManager","userManagerConfig","events","addAccessTokenExpiring","console","log","addAccessTokenExpired","addUserSignedOut","addSilentRenewError","e","message","addUserLoaded","loadedUser","user","getUser","then","profile","setSessionStorage","access_token","renderIndex","render","showLoginName","showStateInfo","err","signinRedirectCallback","querySessionStatus","res","init","this","server","getNav","click","signoutPopupCallback","removeUser","clearStaleState","signoutRedirect","state","resp","ajax","type","url","setter","baseUrl","success","data","IsSucceed","navData","Result","TreeNodes","Children","push","Code","Flag","Icon","Id","IsExpand","Key","ParentId","Title","Url","html","msg","icon","error","closeAll","name","open","title","content","offset","yes","layero","window","location","cancel","checkLogionState"],"mappings":"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","file":"../../home.js","sourcesContent":["//\r\nlayui\r\n  .config({\r\n    base: \"../../../layuiadmin/\" //静态资源所在路径\r\n  })\r\n  .extend({\r\n    index: \"lib/index\" //主入口模块\r\n  })\r\n  .use(\r\n    [\r\n      \"index\",\r\n\r\n      \"layer\",\r\n      \"jquery\",\r\n      \"laypage\",\r\n      \"setter\",\r\n      \"element\",\r\n      \"renderNav\",\r\n      \"consts\",\r\n      \"common\"\r\n    ],\r\n    function() {\r\n      var layer = parent.layer === undefined ? layui.layer : parent.layer,\r\n        laypage = layui.laypage,\r\n        laydata = layui.laydata,\r\n        consts = layui.consts,\r\n        common = layui.common,\r\n        element = layui.element,\r\n        $ = layui.jquery,\r\n        renderNav = layui.renderNav;\r\n      //consts.userManagerConfig\r\n      var manager = new Oidc.UserManager(consts.userManagerConfig);\r\n      ///////////////////////////////\r\n      //event 事件\r\n      ///////////////////////////////\r\n      manager.events.addAccessTokenExpiring(function() {\r\n        console.log(\"token expiring\");\r\n      });\r\n      manager.events.addAccessTokenExpired(function() {\r\n        console.log(\"token expired\");\r\n      });\r\n      manager.events.addUserSignedOut(function() {\r\n        console.log(\"检测退出事件(已经退出)\");\r\n      });\r\n      manager.events.addSilentRenewError(function(e) {\r\n        console.log(\"silent renew error\", e.message);\r\n      });\r\n      manager.events.addUserLoaded(function(loadedUser) {\r\n        user = loadedUser;\r\n        manager\r\n          .getUser()\r\n          .then(function(user) {\r\n            if (user && user.profile) {\r\n              console.log(\"添加用户之前用户信息\", user);\r\n              common.setSessionStorage(\"access_token\", user.access_token);\r\n              renderIndex.render.showLoginName(user.profile);\r\n            } else if (user === null) {\r\n              console.log(\"用户信息为空\", user);\r\n              renderIndex.render.showStateInfo(user);\r\n            }\r\n          })\r\n          .catch(function(err) {\r\n            console.log(err);\r\n          });\r\n      });\r\n      ///////////////////////////////\r\n      //event 事件结束\r\n      ///////////////////////////////\r\n      manager\r\n        .getUser()\r\n        .then(function(user) {\r\n          if (user && user.profile) {\r\n            console.log(\"got user获取用户信息\", user);\r\n            renderIndex.render.showLoginName(user.profile);\r\n          } else if (user === null) {\r\n            console.log(\"用户信息为空\", user);\r\n            renderIndex.render.showStateInfo(user);\r\n          }\r\n        })\r\n        .catch(function(err) {\r\n          console.log(err);\r\n        });\r\n      manager\r\n        .signinRedirectCallback()\r\n        .then(function(user) {\r\n          console.log(\"登录目标返回 success\", user);\r\n        })\r\n        .catch(function(err) {\r\n          //console.log(err);\r\n        });\r\n      manager\r\n        .querySessionStatus()\r\n        .then(function(res) {\r\n          console.log(\"返回状态\", res);\r\n        })\r\n        .catch(function(err) {\r\n          console.log(\"查询状态错误\", err);\r\n        });\r\n      //主页渲染\r\n      var renderIndex = {\r\n        init: function() {\r\n          // this.renderLoad();\r\n          this.events();\r\n          this.server.getNav();\r\n          //this.checkLogionState();\r\n        },\r\n        events: function() {\r\n          $(\".search_btn\").click(function() {\r\n            console.log(11);\r\n          });\r\n          $(\"#logout\").click(function() {\r\n            manager.signoutPopupCallback(true);\r\n            manager.removeUser();\r\n            manager.clearStaleState();\r\n            manager\r\n              .signoutRedirect({ state: \"signOut\" })\r\n              .then(function(resp) {\r\n                //mgr.signoutRedirect().then(function(resp) {\r\n                log(\"signed out\", resp);\r\n              })\r\n              .catch(function(err) {\r\n                log(err);\r\n              });\r\n          });\r\n        },\r\n        server: {\r\n          getNav: function () {\r\n            \r\n            $.ajax({\r\n              type: \"get\",\r\n              url: layui.setter.baseUrl + \"/api/Navigation/treeview/menuLink\",\r\n              // async: true,\r\n              success: function(data) {\r\n                if (data.IsSucceed) {\r\n                  const navData = data.Result.TreeNodes;\r\n                  navData[0].Children.push({\r\n                    Code: \"06\",\r\n                    Flag: \"nav\",\r\n                    Icon: \"true\",\r\n                    Id: \"001\",\r\n                    IsExpand: true,\r\n                    Key: \"001\",\r\n                    ParentId: null,\r\n                    Title: \"租户管理\",\r\n                    Url: \"/platform/tenant?rad=1GpEZITN\"\r\n                  });\r\n                  $(\"#navBox\").html(renderNav(navData));\r\n                  element.init();\r\n                } else {\r\n                  layer.msg(\"导航数据加载失败!\", {\r\n                    icon: 5\r\n                  });\r\n                }\r\n              },\r\n              error: function(err) {\r\n                layer.closeAll();\r\n                layer.msg(\"数据加载失败\", { icon: 5 });\r\n              }\r\n            });\r\n          }\r\n        },\r\n        render: {\r\n          showLoginName: function(data) {\r\n            var name = data && data.name ? data.name : \"sysadmin\";\r\n            $(\"#currentName\").html(name);\r\n          },\r\n          showStateInfo: function(data) {\r\n            console.log(data, \"回调数据\");\r\n            layer.open({\r\n              title: \"信息!\",\r\n              content: \"您未登录请先登录!\",\r\n              icon: 2,\r\n              offset: \"200px\",\r\n              yes: function(index, layero) {\r\n                console.log(\"点击了回调\");\r\n                window.location = \"./login.html\";\r\n              },\r\n              cancel: function() {\r\n                //右上角关闭回调\r\n                console.log(\"取消关闭\");\r\n                //return false 开启该代码可禁止点击该按钮关闭\r\n                window.location = \"./login.html\";\r\n              }\r\n            });\r\n          }\r\n        },\r\n        checkLogionState: function() {\r\n          manager\r\n            .getUser()\r\n            .then(function(user) {\r\n              console.log(\"got user获取用户信息\", user);\r\n            })\r\n            .catch(function(err) {\r\n              console.log(err);\r\n            });\r\n        }\r\n      };\r\n      renderIndex.init();\r\n    }\r\n  );\r\n"]}