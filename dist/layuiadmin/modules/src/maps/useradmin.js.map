{"version":3,"sources":["useradmin.js"],"names":["layui","define","exports","$","table","common","laypage","form","render","elem","url","setter","baseUrl","parseData","cols","field","width","title","templet","d","GroupClassify","minWidth","sort","util","toDateString","CreateDate","LockoutEnabled","align","fixed","toolbar","loading","limit","text","count","curr","location","hash","replace","layout","jump","obj","first","reload","userSeverEvent","lockUser","data","str1","JSON","stringify","dataBean","consts","basePostData","Data","ajaxFun","then","res","appResult","isSucceeded","layer","msg","icon","closeAll","loadErrorText","fail","err","console","log","unLockUser","Id","time","delete","edit","on","event","close","confirm","index","tr","open","type","content","maxmin","area","btn","yes","layero","iframeWindow","window","submitID","submit","find","contents","file","trigger","success","userinfo","Seconds","val","IsLockForever","UserId","r","flag","test","btn2"],"mappings":"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","file":"../../useradmin.js","sourcesContent":["layui.define([\"table\", \"form\", \"common\", \"consts\"], function(exports) {\r\n  var $ = layui.$,\r\n    table = layui.table,\r\n    common = layui.common,\r\n    form = layui.form;\r\n  var laypage = layui.laypage;\r\n  //用户管理表格渲染\r\n  var userManageTable = table.render({\r\n    elem: \"#LAY-user-manage\",\r\n    url: layui.setter.baseUrl + \"/api/User/query/group/normal/1/10\", //接口\r\n    // ,response:layui.setter.response\r\n    parseData: layui.setter.parseData,\r\n    cols: [\r\n      [\r\n        {\r\n          field: \"GroupClassify\",\r\n          width: 100,\r\n          title: \"类别\",\r\n          templet: function(d) {\r\n            if ((d.GroupClassify = \"normal\")) {\r\n              return \"普通用户\";\r\n            } else if ((d.GroupClassify = \"manager\")) {\r\n              return \"业务管理员\";\r\n            } else if ((d.GroupClassify = \"guest\")) {\r\n              return \"业务管理员\";\r\n            } else {\r\n              return \"未知类别\";\r\n            }\r\n          }\r\n        },\r\n        { field: \"NormalizedName\", title: \"用户名\", minWidth: 100 },\r\n        { field: \"Email\", title: \"邮箱\" },\r\n        { field: \"sex\", width: 80, title: \"性别\" },\r\n        {\r\n          field: \"CreateDate\",\r\n          title: \"创建日期\",\r\n          sort: true,\r\n          templet: function(d) {\r\n            return \"<div>\" + layui.util.toDateString(d.CreateDate) + \"</div>\";\r\n          }\r\n        },\r\n        {\r\n          field: \"锁定/解锁\",\r\n          title: \"锁定/解锁\",\r\n          templet: function(d) {\r\n            if (d.LockoutEnabled) {\r\n              return '<a class=\"layui-btn layui-btn-primary layui-btn-xs\" lay-event=\"unlock\">解锁</a>';\r\n            } else {\r\n              return '<a class=\"layui-btn layui-btn-normal layui-btn-xs\" lay-event=\"lock\">锁定</a>';\r\n            }\r\n          }\r\n        },\r\n        {\r\n          title: \"操作\",\r\n          width: 150,\r\n          align: \"center\",\r\n          fixed: \"right\",\r\n          toolbar: \"#table-useradmin-webuser\"\r\n        }\r\n      ]\r\n    ],\r\n    loading: true,\r\n    // page: {\r\n    //   jump: function(obj, first) {\r\n    //     console.log(obj, first, \"shusju\");\r\n    //   }\r\n    // },\r\n    limit: 10,\r\n    text: \"对不起，加载出现异常！\"\r\n  });\r\n\r\n  //分页\r\n  laypage.render({\r\n    elem: \"page\",\r\n    count: 70, //数据总数，从服务端得到\r\n    curr: location.hash.replace(\"#!fenye=\", \"\"), //获取起始页\r\n    hash: \"fenye\", //自定义hash值\r\n    layout: [\"prev\", \"page\", \"next\"],\r\n    jump: function(obj, first) {\r\n      //obj包含了当前分页的所有参数，比如：\r\n      //首次不执行\r\n      if (!first) {\r\n        table.reload(\"LAY-user-manage\", {\r\n          url:\r\n            layui.setter.baseUrl +\r\n            \"/api/User/query/group/normal/\" +\r\n            obj.curr +\r\n            \"/\" +\r\n            obj.limit\r\n        });\r\n      }\r\n    }\r\n  });\r\n\r\n  //服务交互\r\n  var userSeverEvent = {\r\n    lockUser: function(data) {\r\n      var str1 = JSON.stringify(dataBean);\r\n      var dataBean = layui.consts.basePostData();\r\n      dataBean.Data = data;\r\n      var str1 = JSON.stringify(dataBean);\r\n      common\r\n        .ajaxFun(\"put\", \"/api/User/lockout/active\", str1)\r\n        .then(function(res) {\r\n          if (common.appResult.isSucceeded(res)) {\r\n            layer.msg(\"用户状态修改成功!\", { icon: 6 });\r\n            layer.closeAll();\r\n            table.reload(\"LAY-user-manage\");\r\n          } else {\r\n            common.appResult.loadErrorText(res);\r\n          }\r\n        })\r\n        .fail(err => {\r\n          console.log(err);\r\n        });\r\n    },\r\n    unLockUser: function(data) {\r\n      common\r\n        .ajaxFun(\"put\", \"/api/User/lockout/cancel/\" + data.Id)\r\n        .then(function(res) {\r\n          if (common.appResult.isSucceeded(res)) {\r\n            table.reload(\"LAY-user-manage\"); //数据刷新\r\n            layer.msg(\"数据解锁成功\", { time: 4000, icon: 6 });\r\n          } else {\r\n            common.appResult.loadErrorText(res);\r\n          }\r\n        })\r\n        .fail(err => {\r\n          console.log(err);\r\n        });\r\n    },\r\n    delete: function(data) {\r\n      common\r\n        .ajaxFun(\"delete\")\r\n        .then(function(res) {\r\n          if (common.appResult.isSucceeded(res)) {\r\n            console.log(\"用户删除成功!\");\r\n          } else {\r\n            common.appResult.loadErrorText(res);\r\n          }\r\n        })\r\n        .fail(err => {\r\n          console.log(err);\r\n        });\r\n    },\r\n    edit: function(data) {\r\n      console.log(data);\r\n    }\r\n  };\r\n  //监听工具条\r\n  table.on(\"tool(LAY-user-manage)\", function(obj) {\r\n    var data = obj.data;\r\n    if (obj.event === \"del\") {\r\n      layer.close();\r\n      layer.confirm(\"确认删除该用户吗?\", { icon: 3, title: \"提示\" }, function(\r\n        index\r\n      ) {\r\n        userSeverEvent.delete(data);\r\n      });\r\n    } else if (obj.event === \"edit\") {\r\n      var tr = $(obj.tr);\r\n      layer.open({\r\n        type: 2,\r\n        title: \"编辑用户\",\r\n        content: \"../tpl/from/userFrom.html\",\r\n\r\n        maxmin: true,\r\n        area: [\"700px\", \"400px\"],\r\n        btn: [\"确定\", \"取消\"],\r\n        yes: function(index, layero) {\r\n          var iframeWindow = window[\"layui-layer-iframe\" + index],\r\n            submitID = \"LAY-user-front-submit\",\r\n            submit = layero\r\n              .find(\"iframe\")\r\n              .contents()\r\n              .find(\"#\" + submitID);\r\n          //监听提交\r\n          iframeWindow.layui.form.on(\"submit(\" + submitID + \")\", function(\r\n            data\r\n          ) {\r\n            var field = data.field; //获取提交的字段\r\n            //提交 Ajax 成功后，静态更新表格中的数据\r\n            //$.ajax({});\r\n            console.log(file, \"编辑\");\r\n            layer.close(index); //关闭弹层\r\n          });\r\n          submit.trigger(\"click\");\r\n        },\r\n        success: function(layero, index) {}\r\n      });\r\n    } else if (obj.event === \"lock\") {\r\n      layer.open({\r\n        type: 1,\r\n        title: \"锁定解锁\", //不显示标题\r\n        content: $(\"#lock-from\"),\r\n        area: [\"700px\"],\r\n        btn: [\"确认\", \"取消\"],\r\n        yes: function() {\r\n          var userinfo = {\r\n            Seconds: $(\"#Seconds\").val(),\r\n            IsLockForever: $(\"input[name='IsLockForever']:checked\").val(),\r\n            UserId: data.Id\r\n          };\r\n          var r = /^\\+?[0-9][0-9]*$/; //正整数\r\n          var flag = r.test(userinfo.Seconds);\r\n          if (!flag) {\r\n            layer.msg(\"请输入正确的秒数!\");\r\n            return;\r\n          }\r\n          userSeverEvent.lockUser(userinfo);\r\n        },\r\n        btn2: function(index, layero) {\r\n          console.log(\"取消锁定解锁1\");\r\n        }\r\n      });\r\n    } else if (obj.event === \"unlock\") {\r\n      layer.confirm(\"确认要解锁该用户吗?\", { icon: 3, title: \"提示\" }, function(\r\n        index\r\n      ) {\r\n        userSeverEvent.unLockUser(data);\r\n      });\r\n    }\r\n  });\r\n  exports(\"useradmin\", {});\r\n});\r\n"]}