/** layuiAdmin.std-v1.0.0 LPPL License By http://www.layui.com/admin/ */
 ;"use strict";layui.config({base:"../../../layuiadmin/"}).extend({index:"lib/index"}).use(["index","laydate","table","layer","tree","common","consts","z_treeConfig"],function(){var e=layui.$,a=layui.form,t=(layui.table,layui.layer);layui.tree,layui.z_treeConfig;common=layui.common,e("body").on("mousedown",".layui-tree a",function(){e(this).siblings("ul").length||(e(".layui-tree a cite").css("color","#333"),e(this).find("cite").css("color","red"))}),a.on("submit(DepartmentFrom)",function(e){return delete e.field.topName,o.baseData.editFalge?o.server.eidtOrgan(e.field,"/api/Navigation"):(o.server.addOrgan(e.field,"/api/Navigation"),console.log("执行添加命令")),!1});var o={init:function(){this.server.getTreeData(),this.server.ModulePermission(),this.render.showtips(),this.event()},baseData:{treeNode:{},id:"",nodeData:{},editFalge:!1,isSunNode:!1,treeObj:{}},event:function(){e("#refresh").click(function(){e("#treeOrgan").html(""),o.server.getTreeData(),e("#delet").addClass("layui-btn-disabled").attr("disabled","true"),o.baseData.editFalge=!1}),e("#showDepartment").click(function(){e("#formTitle").html("新增一级信息"),e("#topName").addClass("layui-hide"),e(".submit").html("立即提交"),o.render.renderFormData("clear"),o.baseData.editFalge=!1,o.baseData.isSunNode=!1}),e("#showPosition").click(function(){e("#formTitle").html("新增多级导航信息"),e("#topName").removeClass("layui-hide"),e(".submit").html("立即提交"),o.render.renderFormData("clear"),o.baseData.editFalge=!1,o.baseData.isSunNode=!0}),e("#lower").click(function(){o.server.moveNodeData(o.baseData.treeNode,!1),o.baseData.editFalge=!1}),e("#upper").click(function(){o.server.moveNodeData(o.baseData.treeNode,!0),o.baseData.editFalge=!1}),e("#delet").click(function(){o.render.openDeleteConfirm(o.baseData.treeNode)})},server:{getTreeData:function(){e.ajax({type:"get",url:layui.setter.baseUrl+"/api/Navigation/treeview/manager",dataType:"json",headers:{Accept:"application/json","Content-Type":"application/json"},success:function(e){if(t.closeAll("loading"),console.log(e),e.IsSucceed){var a=function i(e){if(e.length>0)for(var a=0;a<e.length;a++)e[a].name=e[a].Title,e[a].children=e[a].Children,e[a].Children.length>0&&i(e[a].Children);return e};console.log(e.Result.TreeNodes);var n=e.Result.TreeNodes,r=a(n);o.render.renderTree(r),o.render.renderFormData("clear")}else t.msg("获取数据失败"+e.Errors[0].Description,{icon:5})},error:function(e){t.closeAll(),t.msg("数据操作失败",{icon:5})}})},ModulePermission:function(){e.ajax({type:"get",url:layui.setter.baseUrl+"/api/Module/deep/permission",dataType:"json",headers:{Accept:"application/json","Content-Type":"application/json"},success:function(e){t.closeAll("loading"),console.log(e,"~~~"),e.IsSucceed?o.render.loadSelect(e.Result):t.msg("获取数据失败"+e,{icon:5})},error:function(e){t.closeAll(),t.msg("数据操作失败",{icon:5})}})},getNodedata:function(a,n){console.log("执行");var r="";"nav"===a&&(r="/api/Navigation/"+n,t.load(2),e.ajax({type:"get",url:layui.setter.baseUrl+r,dataType:"json",headers:{Accept:"application/json","Content-Type":"application/json"},success:function(e){if(t.closeAll(),console.log(e),e.IsSucceed){o.baseData.nodeData=e.Result;var n=e.Result;o.render.renderFormData(a,n)}},error:function(e){t.closeAll(),t.msg("数据操作失败",{icon:5})}}))},addOrgan:function(a,n,r){var i=layui.consts.basePostData("CreateNavigation");o.baseData.isSunNode&&(a.ParentId=o.baseData.id),a.AccessType="mvc",i.Data=a;var s=JSON.stringify(i);t.load(),e.ajax({type:"post",url:layui.setter.baseUrl+n,data:s,dataType:"json",headers:{Accept:"application/json","Content-Type":"application/json"},success:function(a){t.closeAll(),console.log(a),a.IsSucceed?(e("#treeOrgan").html(""),o.server.getTreeData(),t.msg("添加成功!",{icon:6})):t.msg("增加数据失败! "+a.Errors[0].Message,{icon:5})},error:function(e){t.closeAll(),t.msg("数据操作失败",{icon:5})}})},eidtOrgan:function(a,n){var r=layui.consts.basePostData();a.Id=o.baseData.id,r.Data=a;var i=JSON.stringify(r);t.load(),e.ajax({type:"put",url:layui.setter.baseUrl+n+"/"+o.baseData.id,data:i,dataType:"json",headers:{Accept:"application/json","Content-Type":"application/json"},success:function(a){t.closeAll(),console.log(a),a.IsSucceed?(e("#treeOrgan").html(""),o.server.getTreeData(),t.msg("修改成功!",{icon:6})):t.msg("增加数据失败! "+a.Errors[0].Message,{icon:5})},error:function(e){t.closeAll(),t.msg("数据操作失败",{icon:5})}})},moveNodeData:function(e,a){var o="";if("nav"===e.Flag)o="/api/Organ/department/"+e.Id+"/order/"+a;else{if("position"!==e.Flag)return;o="/api/Organ/position/"+e.Id+"/order/"+a}t.msg("暂未开放")},delet:function(a,n){t.load();var r="";"nav"===a&&(r="/api/Navigation/"+n),e.ajax({type:"DELETE",url:layui.setter.baseUrl+r,dataType:"json",headers:{Accept:"application/json","Content-Type":"application/json"},success:function(a){t.closeAll(),console.log(a),a.IsSucceed?(e("#treeOrgan").html(""),o.server.getTreeData(),t.alert("删除成功",{icon:1})):t.msg("获取节点数据失败! "+a.Errors[0].Description,{icon:5})},error:function(e){t.closeAll(),t.msg("数据操作失败",{icon:5})}})}},render:{renderTree:function(e){o.baseData.treeObj=layui.z_treeConfig.renderTree(e,"treeOrgan",{callback:{onClick:o.currData.treeOnClick}})},renderTitle:function(a,t){e("#formTitle").html("修改导航信息")},renderFormData:function(e,t){console.log(t,"待填充的数据信息"),"nav"===e?a.val("DepartmentFrom",{Name:t.Name,Code:t.Code,MenuLinkId:t.MenuLinkId,Description:t.Description}):"clear"==e&&a.val("DepartmentFrom",{Name:"",Code:"",MenuLinkId:"",Description:""})},disabledBtton:function(e){common.isDisableButton("#delet",!1),common.isDisableButton("#lower",!1),common.isDisableButton("#upper",!1),common.isDisableButton("#showPosition",!1)},loadSelect:function(t){console.log(t);for(var o="<option value=''></option>",n=0;n<t.length;n++){if(console.log(n),o+="<optgroup label='"+t[n].Name+"'>",t[n].Functions.length>0){var r=t[n].Functions;console.log(r);for(var i=0;i<r.length;i++)o+="<option value="+r[i].MenuLinkMvcId+">"+r[i].Name+"</option>"}o+="</optgroup>"}e("#MenuLinkId").html(o),a.render()},showtips:function(){common.showtips(".layui-btn-group button")},openDeleteConfirm:function(e){t.confirm("你确定要删除<span style='font-weight:bolder'>"+e.Title+"</span>的节点吗?",{btn:["确定","取消"],icon:3},function(){console.log("确认",e),o.server.delet(e.Flag,e.Id)},function(){console.log("取消")})}},currData:{getTreeNodeName:function(e,a){},treeOnClick:function(a,t,n){console.log(n),o.baseData.treeNode=n,o.baseData.id=n.Id,o.baseData.editFalge=!0,console.log(o.baseData.treeNode),o.server.getNodedata(n.Flag,n.Id),o.render.renderTitle(n.Flag),o.render.disabledBtton(n.Flag);var r=o.baseData.treeObj.getNodeByTId(n.parentTId);e(".topName").val(r.Title),e(".submit").html("立即修改")}}};o.init(),console.log("导航信息管理``````!!")});
//# sourceMappingURL=../src/maps/platform/navigation.js.map
