/** layuiAdmin.std-v1.0.0 LPPL License By http://www.layui.com/admin/ */
 ;"use strict";layui.config({base:"../../../layuiadmin/"}).extend({index:"lib/index"}).use(["index","laydate","table","layer","tree","common","consts","z_treeConfig"],function(){var e=layui.$,a=layui.form,t=(layui.table,layui.layer);layui.tree,layui.z_treeConfig;common=layui.common,e("body").on("mousedown",".layui-tree a",function(){e(this).siblings("ul").length||(e(".layui-tree a cite").css("color","#333"),e(this).find("cite").css("color","red"))}),a.on("submit(DepartmentFrom)",function(e){return delete e.field.topName,o.baseData.editFalge?o.server.eidtOrgan(e.field,"/api/Navigation"):(o.server.addOrgan(e.field,"/api/Navigation"),console.log("执行添加命令")),!1});var o={init:function(){this.server.getTreeData(),this.server.ModulePermission(),this.render.showtips(),this.event()},baseData:{treeNode:{},id:"",nodeData:{},editFalge:!1,isSunNode:!1,treeObj:{}},event:function(){e("#refresh").click(function(){e("#treeOrgan").html(""),o.server.getTreeData(),e("#delet").addClass("layui-btn-disabled").attr("disabled","true"),o.baseData.editFalge=!1}),e("#showDepartment").click(function(){e("#formTitle").html("新增一级信息"),e("#topName").addClass("layui-hide"),e(".submit").html("立即提交"),o.render.renderFormData("clear"),o.baseData.editFalge=!1,o.baseData.isSunNode=!1}),e("#showPosition").click(function(){e("#formTitle").html("新增多级导航信息"),e("#topName").removeClass("layui-hide"),e(".submit").html("立即提交"),o.render.renderFormData("clear"),o.baseData.editFalge=!1,o.baseData.isSunNode=!0}),e("#lower").click(function(){o.server.moveNodeData(o.baseData.treeNode,!1),o.baseData.editFalge=!1}),e("#upper").click(function(){o.server.moveNodeData(o.baseData.treeNode,!0),o.baseData.editFalge=!1}),e("#delet").click(function(){o.render.openDeleteConfirm(o.baseData.treeNode)})},server:{getTreeData:function(){common.ajaxFun("get","/api/Navigation/treeview/manager").then(function(e){if(common.appResult.isSucceeded(e)){var a=function i(e){if(e.length>0)for(var a=0;a<e.length;a++)e[a].name=e[a].Title,e[a].children=e[a].Children,e[a].Children.length>0&&i(e[a].Children);return e};console.log(e.Result.TreeNodes);var t=e.Result.TreeNodes,n=a(t);o.render.renderTree(n),o.render.renderFormData("clear")}else common.appResult.loadErrorText(e)}).fail(function(e){console.log(e)})},ModulePermission:function(){common.ajaxFun("get","/api/Module/deep/permission").then(function(e){common.appResult.isSucceeded(e)?o.render.loadSelect(e.Result):common.appResult.loadErrorText(e)}).fail(function(e){console.log(e)})},getNodedata:function(e,a){console.log("执行");var t="";"nav"===e&&(t="/api/Navigation/"+a,common.ajaxFun("get",t).then(function(a){if(common.appResult.isSucceeded(a)){o.baseData.nodeData=a.Result;var t=a.Result;o.render.renderFormData(e,t)}else common.appResult.loadErrorText(a)}).fail(function(e){console.log(e)}))},addOrgan:function(a,n,i){var r=layui.consts.basePostData("CreateNavigation");o.baseData.isSunNode&&(a.ParentId=o.baseData.id),a.AccessType="mvc",r.Data=a;var l=JSON.stringify(r);common.ajaxFun("post",n,l).then(function(a){common.appResult.isSucceeded(a)?(e("#treeOrgan").html(""),o.server.getTreeData(),t.msg("添加成功!",{icon:6})):common.appResult.loadErrorText(a)}).fail(function(e){console.log(e)})},eidtOrgan:function(a,n){var i=layui.consts.basePostData();a.Id=o.baseData.id,i.Data=a;var r=JSON.stringify(i);common.ajaxFun("put",n+"/"+o.baseData.id,r).then(function(a){common.appResult.isSucceeded(a)?(e("#treeOrgan").html(""),o.server.getTreeData(),t.msg("修改成功!",{icon:6})):common.appResult.loadErrorText(a)}).fail(function(e){console.log(e)})},moveNodeData:function(e,a){var o="";if("nav"===e.Flag)o="/api/Organ/department/"+e.Id+"/order/"+a;else{if("position"!==e.Flag)return;o="/api/Organ/position/"+e.Id+"/order/"+a}t.msg("暂未开放")},delet:function(a,n){t.load();var i="";"nav"===a&&(i="/api/Navigation/"+n),common.ajaxFun("DELETE",i).then(function(a){common.appResult.isSucceeded(a)?(e("#treeOrgan").html(""),o.server.getTreeData(),t.alert("删除成功",{icon:1})):common.appResult.loadErrorText(a)}).fail(function(e){console.log(e)})}},render:{renderTree:function(e){o.baseData.treeObj=layui.z_treeConfig.renderTree(e,"treeOrgan",{callback:{onClick:o.currData.treeOnClick}})},renderTitle:function(a,t){e("#formTitle").html("修改导航信息")},renderFormData:function(e,t){console.log(t,"待填充的数据信息"),"nav"===e?a.val("DepartmentFrom",{Name:t.Name,Code:t.Code,MenuLinkId:t.MenuLinkId,Description:t.Description}):"clear"==e&&a.val("DepartmentFrom",{Name:"",Code:"",MenuLinkId:"",Description:""})},disabledBtton:function(e){common.isDisableButton("#delet",!1),common.isDisableButton("#lower",!1),common.isDisableButton("#upper",!1),common.isDisableButton("#showPosition",!1)},loadSelect:function(t){console.log(t);for(var o="<option value=''></option>",n=0;n<t.length;n++){if(console.log(n),o+="<optgroup label='"+t[n].Name+"'>",t[n].Functions.length>0){var i=t[n].Functions;console.log(i);for(var r=0;r<i.length;r++)o+="<option value="+i[r].MenuLinkMvcId+">"+i[r].Name+"</option>"}o+="</optgroup>"}e("#MenuLinkId").html(o),a.render()},showtips:function(){common.showtips(".layui-btn-group button")},openDeleteConfirm:function(e){t.confirm("你确定要删除<span style='font-weight:bolder'>"+e.Title+"</span>的节点吗?",{btn:["确定","取消"],icon:3},function(){console.log("确认",e),o.server.delet(e.Flag,e.Id)},function(){console.log("取消")})}},currData:{getTreeNodeName:function(e,a){},treeOnClick:function(a,t,n){console.log(n),o.baseData.treeNode=n,o.baseData.id=n.Id,o.baseData.editFalge=!0,console.log(o.baseData.treeNode),o.server.getNodedata(n.Flag,n.Id),o.render.renderTitle(n.Flag),o.render.disabledBtton(n.Flag);var i=o.baseData.treeObj.getNodeByTId(n.parentTId);try{e(".topName").val(i.Title)}catch(r){console.log(r),e(".topName").val("暂无数据")}e(".submit").html("立即修改")}}};o.init(),console.log("导航信息管理``````!!")});
//# sourceMappingURL=../src/maps/platform/navigation.js.map
