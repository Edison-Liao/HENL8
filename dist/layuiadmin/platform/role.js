/** layuiAdmin.std-v1.0.0 LPPL License By http://www.layui.com/admin/ */
 ;"use strict";layui.config({base:"../../../layuiadmin/"}).extend({index:"lib/index"}).use(["index","table","layer","tree","common","consts"],function(){var e=layui.$,a=layui.form,t=(layui.table,layui.layer),o=(layui.tree,layui.common);e("body").on("mousedown",".layui-tree a",function(){e(this).siblings("ul").length||(e(".layui-tree a cite").css("color","#333"),e(this).find("cite").css("color","red"))}),a.on("submit(DepartmentFrom)",function(e){return console.log(e.field,"新增部门"),delete e.field.topName,r.baseData.editFalge?(console.log("执行编辑命令"),r.server.eidtOrgan(e.field,"/api/Role","department")):(r.server.addOrgan(e.field,"/api/Role","department"),console.log("执行添加命令")),!1}),a.on("submit(staffFrom)",function(e){return delete e.field.topName,r.baseData.editFalge?r.server.eidtOrgan(e.field,"/api/Role","staff"):r.server.addOrgan(e.field,"/api/Role","staff"),!1});var r={init:function(){this.server.getTreeData(),this.render.showtips(),this.event()},baseData:{treeNode:{},id:"",nodeData:{},editFalge:!1},event:function(){e("#refresh").click(function(){e("#treeOrgan").html(""),r.server.getTreeData(),r.baseData.editFalge=!1}),e("#showDepartment").click(function(){e("#formTitle").html("新增角色分组信息"),e(".submit").html("立即提交"),r.render.showForm("#DepartmentFrom"),a.val("DepartmentFrom",{topName:r.baseData.treeNode.name}),r.baseData.editFalge=!1}),e("#showStaff").click(function(){e("#formTitle").html("新增角色信息"),e(".submit").html("立即提交"),r.render.showForm("#staffFrom"),a.val("staffFrom",{topName:r.baseData.treeNode.name}),r.baseData.editFalge=!1}),e("#lower").click(function(){r.server.moveNodeData(r.baseData.treeNode,!1),r.baseData.editFalge=!1}),e("#upper").click(function(){r.server.moveNodeData(r.baseData.treeNode,!0),r.baseData.editFalge=!1}),e("#delet").click(function(){r.render.openDeleteConfirm(r.baseData.treeNode)})},server:{getTreeData:function(){e.ajax({type:"get",url:layui.setter.baseUrl+"/api/Role/treeview",dataType:"json",headers:{Accept:"application/json","Content-Type":"application/json"},success:function(e){if(t.closeAll("loading"),console.log(e),e.IsSucceed){var a=function s(e){if(e.length>0)for(var a=0;a<e.length;a++)e[a].name=e[a].Title,e[a].children=e[a].Children,e[a].Children.length>0&&s(e[a].Children);return e};console.log(e.Result.TreeNodes);var o=e.Result.TreeNodes,n=a(o);r.render.renderTree(n)}else t.msg("获取数据失败"+e,{icon:5})},error:function(e){t.closeAll(),t.msg("数据操作失败",{icon:5})}})},getNodedata:function(o,n){var s="";if("roleCatalog"===o)s="/api/Role/"+n,r.render.showForm("#DepartmentFrom");else{if("roleInfo"!==o)return;s="/api/Role/"+n,r.render.showForm("#staffFrom")}t.load(2),e.ajax({type:"get",url:layui.setter.baseUrl+s,dataType:"json",headers:{Accept:"application/json","Content-Type":"application/json"},success:function(e){if(t.closeAll(),console.log(e),e.IsSucceed){r.baseData.nodeData=e.Result;var n=e.Result;"roleCatalog"===o?a.val("DepartmentFrom",{Name:n.Name,Code:n.Code,Message:n.Message}):"roleInfo"===o&&a.val("staffFrom",{Name:n.Name,Code:n.Code,Message:n.Message})}else t.msg("获取节点数据失败! "+e.Errors[0].Message,{icon:5})},error:function(e){t.closeAll(),t.msg("数据操作失败",{icon:5})}})},addOrgan:function(a,o,n){var s=layui.consts.basePostData();"staff"===n&&(a.ParentId=r.baseData.id),s.Data=a,console.log(a);var l=JSON.stringify(s);t.load(),e.ajax({type:"post",url:layui.setter.baseUrl+o,data:l,dataType:"json",headers:{Accept:"application/json","Content-Type":"application/json"},success:function(a){t.closeAll(),console.log(a),a.IsSucceed?(e("#treeOrgan").html(""),r.server.getTreeData(),t.msg("添加成功!",{icon:6})):t.msg("增加数据失败! "+a.Errors[0].Message,{icon:5})},error:function(e){t.closeAll(),t.msg("数据操作失败",{icon:5})}})},eidtOrgan:function(a,o){var n=layui.consts.basePostData();a.Id=r.baseData.id,n.Data=a;var s=JSON.stringify(n);t.load(),e.ajax({type:"put",url:layui.setter.baseUrl+o+"/"+r.baseData.id,data:s,dataType:"json",headers:{Accept:"application/json","Content-Type":"application/json"},success:function(a){t.closeAll(),console.log(a),a.IsSucceed?(e("#treeOrgan").html(""),r.server.getTreeData(),t.msg("修改成功!",{icon:6})):t.msg("增加数据失败! "+a.Errors[0].Message,{icon:5})},error:function(e){t.closeAll(),t.msg("数据操作失败",{icon:5})}})},moveNodeData:function(a,o){var n="";"roleInfo"===a.Flag&&(n="/api/Role/"+a.Id+"/order/"+o,t.load(),e.ajax({type:"put",url:layui.setter.baseUrl+n,dataType:"json",headers:{Accept:"application/json","Content-Type":"application/json"},success:function(a){t.closeAll("loading"),console.log(a),a.IsSucceed?(e("#treeOrgan").html(""),r.server.getTreeData(),t.msg("数据移动成功",{icon:1})):t.msg("数据操作失败"+a.Errors[0].Message,{icon:5})},error:function(e){t.closeAll(),t.msg("数据操作失败",{icon:5})}}))},delet:function(a,o){t.load();var n="";return"roleInfo"!==a&&"roleCatalog"!==a?void t.closeAll():(n="/api/Role/"+o,void e.ajax({type:"DELETE",url:layui.setter.baseUrl+n,dataType:"json",headers:{Accept:"application/json","Content-Type":"application/json"},success:function(a){t.closeAll(),console.log(a),a.IsSucceed?(e("#treeOrgan").html(""),r.server.getTreeData(),t.alert("删除成功",{icon:1})):t.msg("获取节点数据失败! "+a.Errors[0].Message,{icon:5})},error:function(e){t.closeAll(),t.msg("数据操作失败",{icon:5})}}))}},render:{renderTree:function(e){layui.tree({elem:"#treeOrgan",target:"_blank",click:function(a){r.baseData.treeNode=a,r.baseData.id=a.Id,r.baseData.editFalge=!0,console.log(r.baseData.treeNode),r.render.renderTitle(a.Flag),r.server.getNodedata(a.Flag,a.Id),r.currData.getTreeNodeName(e,a.ParentId),r.render.disabledBtton(a.Flag)},nodes:e})},renderTitle:function(a){"roleCatalog"===a?e("#formTitle").html("编辑角色信息分组"):"roleInfo"===a&&e("#formTitle").html("编辑角色信息")},showForm:function(a){e("#DepartmentFrom").addClass("layui-hide"),e("#staffFrom").addClass("layui-hide"),e(a).show(),e(a).removeClass("layui-hide")},renderFormData:function(e){"roleCatalog"===e.Flag&&a.val("DepartmentFrom",{Name:e.Title})},disabledBtton:function(e){o.isDisableButton("#lower",!1),o.isDisableButton("#upper",!1),o.isDisableButton("#delet",!1),"roleCatalog"===e?(o.isDisableButton("#lower",!0),o.isDisableButton("#upper",!0),o.isDisableButton("#showDepartment",!1),o.isDisableButton("#showStaff",!1)):"roleInfo"===e&&(o.isDisableButton("#showDepartment",!0),o.isDisableButton("#showStaff",!0))},showtips:function(){o.showtips(".layui-btn-group button")},openDeleteConfirm:function(e){t.confirm("你确定要删除<span style='font-weight:bolder'>"+e.Title+"</span>的节点吗?",{btn:["确定","取消"],icon:3},function(){r.server.delet(e.Flag,e.Id)},function(){console.log("取消")})}},currData:{getTreeNodeName:function(a,t){var r=o.getTreeNodeName(a,t,"name");e(".topName").val(r),e(".submit").html("立即修改")}}};r.init()});
//# sourceMappingURL=../src/maps/platform/role.js.map
