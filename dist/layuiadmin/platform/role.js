/** layuiAdmin.std-v1.0.0 LPPL License By http://www.layui.com/admin/ */
 ;"use strict";layui.config({base:"../../../layuiadmin/"}).extend({index:"lib/index"}).use(["index","table","layer","tree","common","consts","z_treeConfig"],function(){var e=layui.$,t=layui.form,a=(layui.table,layui.layer),o=(layui.tree,layui.common);t.on("submit(DepartmentFrom)",function(e){return console.log(e.field,"新增部门"),delete e.field.topName,r.baseData.editFalge?(console.log("执行编辑命令"),r.server.eidtOrgan(e.field,"/api/Role","department")):(r.server.addOrgan(e.field,"/api/Role","department"),console.log("执行添加命令")),!1}),t.on("submit(staffFrom)",function(e){return delete e.field.topName,r.baseData.editFalge?r.server.eidtOrgan(e.field,"/api/Role","staff"):r.server.addOrgan(e.field,"/api/Role","staff"),!1});var r={init:function(){this.server.getTreeData(),this.render.showtips(),this.event()},baseData:{treeNode:{},id:"",nodeData:{},editFalge:!1},event:function(){e("#refresh").click(function(){e("#treeOrgan").html(""),r.server.getTreeData(),r.baseData.editFalge=!1}),e("#showDepartment").click(function(){e("#formTitle").html("新增角色分组信息"),e(".submit").html("立即提交"),r.render.showForm("#DepartmentFrom"),t.val("DepartmentFrom",{topName:r.baseData.treeNode.name}),r.baseData.editFalge=!1}),e("#showStaff").click(function(){e("#formTitle").html("新增角色信息"),e(".submit").html("立即提交"),r.render.showForm("#staffFrom"),t.val("staffFrom",{topName:r.baseData.treeNode.name}),r.baseData.editFalge=!1}),e("#lower").click(function(){r.server.moveNodeData(r.baseData.treeNode,!1),r.baseData.editFalge=!1}),e("#upper").click(function(){r.server.moveNodeData(r.baseData.treeNode,!0),r.baseData.editFalge=!1}),e("#delet").click(function(){r.render.openDeleteConfirm(r.baseData.treeNode)})},server:{getTreeData:function(){o.ajaxFun("get","/api/Role/treeview").then(function(e){if(o.appResult.isSucceeded(e)){var t=function n(e){if(e.length>0)for(var t=0;t<e.length;t++)e[t].name=e[t].Title,e[t].children=e[t].Children,e[t].Children.length>0&&n(e[t].Children);return e},a=e.Result.TreeNodes;t(a);r.render.renderTree(a)}else o.appResult.loadErrorText(e)}).fail(function(e){console.log(e)})},getNodedata:function(e,a){var n="";if("roleCatalog"===e)n="/api/Role/"+a,r.render.showForm("#DepartmentFrom");else{if("roleInfo"!==e)return;n="/api/Role/"+a,r.render.showForm("#staffFrom")}o.ajaxFun("get",n).then(function(a){if(o.appResult.isSucceeded(a)){r.baseData.nodeData=a.Result;var n=a.Result;"roleCatalog"===e?t.val("DepartmentFrom",{Name:n.Name,Code:n.Code,Message:n.Message}):"roleInfo"===e&&t.val("staffFrom",{Name:n.Name,Code:n.Code,Message:n.Message})}else o.appResult.loadErrorText(a)}).fail(function(e){console.log(e)})},addOrgan:function(t,n,l){var i=layui.consts.basePostData();"staff"===l&&(t.ParentId=r.baseData.id),i.Data=t,console.log(t);var s=JSON.stringify(i);o.ajaxFun("post",n,s).then(function(t){o.appResult.isSucceeded(t)?(e("#treeOrgan").html(""),r.server.getTreeData(),a.msg("添加成功!",{icon:6})):o.appResult.loadErrorText(t)}).fail(function(e){console.log(e)})},eidtOrgan:function(t,n){var l=layui.consts.basePostData();t.Id=r.baseData.id,l.Data=t;var i=JSON.stringify(l);o.ajaxFun("put",n+"/"+r.baseData.id,i).then(function(t){o.appResult.isSucceeded(t)?(e("#treeOrgan").html(""),r.server.getTreeData(),a.msg("修改成功!",{icon:6})):o.appResult.loadErrorText(t)}).fail(function(e){console.log(e)})},moveNodeData:function(t,n){var l="";"roleInfo"===t.Flag&&(l="/api/Role/"+t.Id+"/order/"+n,o.ajaxFun("put",l).then(function(t){o.appResult.isSucceeded(t)?(e("#treeOrgan").html(""),r.server.getTreeData(),a.msg("数据移动成功",{icon:1})):o.appResult.loadErrorText(t)}).fail(function(e){console.log(e)}))},delet:function(t,n){var l="";return"roleInfo"!==t&&"roleCatalog"!==t?void a.closeAll():(l="/api/Role/"+n,void o.ajaxFun("DELETE",l).then(function(t){o.appResult.isSucceeded(t)?(e("#treeOrgan").html(""),r.server.getTreeData(),a.alert("删除成功",{icon:1})):o.appResult.loadErrorText(t)}).fail(function(e){console.log(e)}))}},render:{renderTree:function(e){r.baseData.treeObj=layui.z_treeConfig.renderTree(e,"treeOrgan",{callback:{onClick:r.currData.treeOnClick}})},renderTitle:function(t){"roleCatalog"===t?e("#formTitle").html("编辑角色信息分组"):"roleInfo"===t&&e("#formTitle").html("编辑角色信息")},showForm:function(t){e("#DepartmentFrom").addClass("layui-hide"),e("#staffFrom").addClass("layui-hide"),e(t).show(),e(t).removeClass("layui-hide")},renderFormData:function(e){"roleCatalog"===e.Flag&&t.val("DepartmentFrom",{Name:e.Title})},disabledBtton:function(e){o.isDisableButton("#lower",!1),o.isDisableButton("#upper",!1),o.isDisableButton("#delet",!1),"roleCatalog"===e?(o.isDisableButton("#lower",!0),o.isDisableButton("#upper",!0),o.isDisableButton("#showDepartment",!1),o.isDisableButton("#showStaff",!1)):"roleInfo"===e&&(o.isDisableButton("#showDepartment",!0),o.isDisableButton("#showStaff",!0))},showtips:function(){o.showtips(".layui-btn-group button")},openDeleteConfirm:function(e){a.confirm("你确定要删除<span style='font-weight:bolder'>"+e.Title+"</span>的节点吗?",{btn:["确定","取消"],icon:3},function(){r.server.delet(e.Flag,e.Id)},function(){console.log("取消")})}},currData:{getTreeNodeName:function(t,a){var r=o.getTreeNodeName(t,a,"name");e(".topName").val(r),e(".submit").html("立即修改")},viewshowIcon:function(e,t){return"roleInfo"!==t.Flag},treeOnClick:function(t,a,o){console.log(o),r.baseData.treeNode=o,r.baseData.id=o.Id,r.baseData.editFalge=!0,r.render.renderTitle(o.Flag),r.server.getNodedata(o.Flag,o.Id),r.render.disabledBtton(o.Flag);var n=r.baseData.treeObj.getNodeByTId(o.parentTId);n&&(e("body .topName").val(n.Title),e(".submit").html("立即修改"))}}};r.init()});
//# sourceMappingURL=../src/maps/platform/role.js.map
