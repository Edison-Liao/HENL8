/** layuiAdmin.std-v1.0.0 LPPL License By http://www.layui.com/admin/ */
 ;"use strict";layui.config({base:"../../../layuiadmin/"}).extend({index:"lib/index"}).use(["index","layer","tree","common","consts","jquery_ztree_excheck"],function(){var e=layui.$,t=(layui.table,layui.layer),r=(layui.tree,layui.common);layui.ztree,layui.jquery_ztree_excheck;e("body").on("mousedown",".layui-tree a",function(){e(this).siblings("ul").length||(e(".layui-tree a cite").css("color","#333"),e(this).find("cite").css("color","red"))}),e("#formTitle").click(function(){console.log(1);layui.admin});var n={init:function(e,t){this.render.renderTree(e,t)},baseData:{zTreeObj:{}},treeSeting:{check:{enable:!0,chkboxType:{Y:"s",N:"ps"},nocheckInherit:!1},data:{simpleData:{enable:!0}},callback:{onCheck:function(e,t,r){console.log(r,"callback")}}},event:{},render:{renderTree:function(t,r){n.baseData.zTreeObj=layui.jquery_ztree.init(e("#"+r),n.treeSeting,t);var a=layui.jquery_ztree.getZTreeObj(r),s=a.getNodes();s.length>0&&a.expandNode(s[0],!0,!1,!0)}}},a={init:function(){this.server.getTreeData(),this.server.getAccessOrganTreeData(),this.server.getAccessRightTreeData(),this.event()},baseData:{treeNode:{},id:"",nodeData:{},editFalge:!1},event:function(){e("#accessOrganSub").click(function(){var e=layui.jquery_ztree.getZTreeObj("treeOrgan").getCheckedNodes(!0),t=a.currData.getArryNodeId(e,"Id"),r=a.baseData.id;a.server.putRoleAccessRight("Organ",t,r)}),e("#accessRightSub").click(function(){var e=layui.jquery_ztree.getZTreeObj("treeAccessRight").getCheckedNodes(!0),t=a.currData.getArryNodeId(e,"Id"),r=a.baseData.id;a.server.putRoleAccessRight("Right",t,r)}),e("#accessUserSub").click(function(){var e=layui.jquery_ztree.getZTreeObj("treeOrganUser").getCheckedNodes(!0),t=a.currData.getArryNodeId(e,"Id"),r=a.baseData.id;a.server.putRoleAccessRight("User",t,r)})},server:{getTreeData:function(){r.ajaxFun("get","/api/Role/treeview").then(function(e){if(r.appResult.isSucceeded(e)){var t=function i(e){if(e.length>0)for(var t=0;t<e.length;t++)e[t].name=e[t].Title,e[t].children=e[t].Children,e[t].Children.length>0&&i(e[t].Children);return e},n=e.Result.TreeNodes,s=t(n);a.render.renderTree(s,"tree_accessRight")}else r.appResult.loadErrorText(e)}).fail(function(e){console.log(e)})},getAccessOrganTreeData:function(){r.ajaxFun("get","/api/organ/treeview").then(function(t){if(r.appResult.isSucceeded(t)){var n=function u(e,t){if(e.length>0)for(var r=0;r<e.length;r++){if(e[r].name=e[r].Title,e[r].children=e[r].Children,t){var n="staff"!==e[r].Flag;e[r].nocheck=n,"staff"===e[r].Flag&&(delete e[r].Children,delete e[r].children)}e[r].Children&&e[r].Children.length>0&&u(e[r].Children,t)}return e};console.log(t.Result.TreeNodes);var s=t.Result.TreeNodes,i=e.extend(!0,[],s),o=e.extend(!0,[],s),c=n(i,!1),l=n(o,!0);a.render.renderAccessOrganTree(c),a.render.renderAccessOrganTreeUser(l)}else r.appResult.loadErrorText(t)}).fail(function(e){console.log(e)})},getAccessRightTreeData:function(){r.ajaxFun("get","/api/Module/deep/permission").then(function(e){if(r.appResult.isSucceeded(e)){var t=function i(e){if(e.length>0)for(var t=0;t<e.length;t++)e[t].name=e[t].Name,e[t].Functions&&e[t].Functions.length>0&&(e[t].children=e[t].Functions),e[t].Permissions&&e[t].Permissions.length>0&&(e[t].children=e[t].Permissions),e[t].children&&e[t].children.length>0&&i(e[t].children);return e},n=e.Result,s=t(n);a.render.renderAccessRightTree(s)}else r.appResult.loadErrorText(e)}).fail(function(e){console.log(e)})},getRoleAccessOrganNode:function(e,t){"roleInfo"===e&&(urlID="/api/Role/accessOrgan/"+t,r.ajaxFun("get","/api/Role/accessOrgan/"+t).then(function(e){r.appResult.isSucceeded(e)?a.render.setTreeNodeCheck(e.Result,"treeOrgan"):r.appResult.loadErrorText(e)}).fail(function(e){console.log(e)}))},getRoleAccessRightNode:function(e,n){var s="";"roleInfo"===e&&(s="/api/Role/accessRight/"+n,r.ajaxFun("get","/api/Role/accessRight/"+n).then(function(e){r.appResult.isSucceeded(e)?a.render.setTreeNodeCheck(e.Result,"treeAccessRight"):t.msg("获取功能访问权限数据失败! "+e.Errors[0].Message,{icon:5})}).fail(function(e){console.log(e)}))},getRoleUserRightNode:function(e,n){"roleInfo"===e&&(urlID="/api/Role/"+n+"/with/user",r.ajaxFun("get",urlID).then(function(e){r.appResult.isSucceeded(e)?a.render.setTreeNodeCheck(e.Result,"treeOrganUser"):t.msg("获取节点数据失败! "+e.Errors[0].Message,{icon:5})}).fail(function(e){console.log(e)}))},putRoleAccessRight:function(r,n,a){var s="";if("Organ"===r)s="/api/Role/accessOrgan/"+a;else if("Right"===r)s="/api/Role/accessRight/"+a;else{if("User"!==r)return t.msg("出错啦");s="/api/Role/"+a+"/with/user"}var i=layui.consts.basePostData();i.Data=n;var o=JSON.stringify(i);t.load(),e.ajax({type:"put",url:layui.setter.baseUrl+s,dataType:"json",data:o,headers:{Accept:"application/json","Content-Type":"application/json"},success:function(e){t.closeAll(),e.IsSucceed?(console.log(e.Result,"当前角色点"),t.msg("更新权限成功!",{icon:6})):t.msg("更新权限数据失败! "+e.Errors[0].Message,{icon:5})},error:function(e){t.closeAll(),t.msg("数据操作失败",{icon:5})}})},getNodedata:function(r,n){var s="";if("roleCatalog"===r)s="/api/Role/"+n;else{if("roleInfo"!==r)return;s="/api/Role/"+n}e.ajax({type:"get",url:layui.setter.baseUrl+s,dataType:"json",headers:{Accept:"application/json","Content-Type":"application/json"},success:function(e){if(t.closeAll(),console.log(e),e.IsSucceed){a.baseData.nodeData=e.Result;e.Result}else t.msg("获取节点数据失败! "+e.Errors[0].Message,{icon:5})},error:function(e){t.closeAll(),t.msg("数据操作失败",{icon:5})}})}},render:{renderTree:function(e){layui.tree({elem:"#treeRole",target:"_blank",click:function(e){a.baseData.treeNode=e,a.baseData.id=e.Id,a.baseData.editFalge=!0,a.server.getRoleAccessOrganNode(e.Flag,e.Id),a.server.getRoleAccessRightNode(e.Flag,e.Id),a.server.getRoleUserRightNode(e.Flag,e.Id),a.render.disabledBtton(e.Flag)},nodes:e})},renderAccessOrganTree:function(e){n.init(e,"treeOrgan")},renderAccessRightTree:function(e){n.init(e,"treeAccessRight")},renderAccessOrganTreeUser:function(e){n.init(e,"treeOrganUser")},openDeleteConfirm:function(e){console.log(e,"模态框")},disabledBtton:function(e){r.isDisableButton(".layui-btn",!1)},setTreeNodeCheck:function(e,t){var r=layui.jquery_ztree.getZTreeObj(t);if(console.log(e,t,"树形结构check填充参数"),null!=r){r.checkAllNodes(!1);var n=r.getNodes();if(n.length>0&&e.length>0)for(var a=0;a<e.length;a++){console.log(e[a],t);var s=r.getNodeByParam("Id",e[a],null);r.expandNode(s,!0,!0,!0,!1),s.checked=!0,r.updateNode(s,!1)}}}},currData:{getArryNodeId:function(e,t){for(var r=[],n=0;n<e.length;n++){var a=e[n][t];r.push(a)}return r}}};a.init()});
//# sourceMappingURL=../src/maps/platform/roleauth.js.map
