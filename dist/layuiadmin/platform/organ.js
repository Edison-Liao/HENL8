/** layuiAdmin.std-v1.0.0 LPPL License By http://www.layui.com/admin/ */
 ;"use strict";layui.config({base:"../../../layuiadmin/"}).extend({index:"lib/index"}).use(["index","laydate","layer","tree","common","consts","z_treeConfig"],function(){var e=layui.$,t=layui.form,a=layui.layer,o=(layui.tree,layui.laydate),i=layui.common;layui.consts;o.render({elem:"#Birthdate"}),t.on("submit(DepartmentFrom)",function(e){return console.log(e.field,"新增部门"),delete e.field.topName,n.baseData.editFalge?(console.log("执行编辑命令"),n.server.eidtOrgan(e.field,"/api/Organ/department","department")):(n.server.addOrgan(e.field,"/api/Organ/department","department"),console.log("执行添加命令")),!1}),t.on("submit(PositionFrom)",function(e){return console.log(e.field,"新增职位"),delete e.field.topName,n.baseData.editFalge?(console.log("执行编辑命令"),n.server.eidtOrgan(e.field,"/api/Organ/position","position")):(n.server.addOrgan(e.field,"/api/Organ/position","position"),console.log("执行添加命令")),!1}),t.on("submit(staffFrom)",function(e){delete e.field.topName,console.log(e.field,"提交的人员信息");var t={};return e.field.IsRegisterUser?(t.Name=e.field.Name,t.NormalizedName=e.field.Name,t.Code=e.field.Code,t.JobNumber=e.field.JobNumber,t.Gender=e.field.Gender,t.Birthdate=e.field.Birthdate,t.PositionId=e.field.PositionId,t.IsStaffMainPosition=e.field.IsStaffMainPosition,t.IsRegisterUser=e.field.IsRegisterUser,t.Description=e.field.Description,t.CreateUser={Password:e.field.Password,ConfirmPassword:e.field.ConfirmPassword,ProviderKey:e.field.ConfirmPassword,DisplayName:e.field.DisplayName,Email:e.field.Email,PhoneNumber:e.field.Email,Portrait:e.field.Portrait,Description:e.field.DescriptionIcc}):(t.Name=e.field.Name,t.NormalizedName=e.field.Name,t.Code=e.field.Code,t.JobNumber=e.field.JobNumber,t.Gender=e.field.Gender,t.Birthdate=e.field.Birthdate,t.PositionId=e.field.PositionId,t.IsStaffMainPosition=new Boolean(e.field.IsStaffMainPosition).toString(),t.IsRegisterUser=new Boolean(e.field.IsRegisterUser).toString(),t.Description=e.field.Description,t.CreateUser={}),console.log(t,"获取到的数据"),n.baseData.editFalge?n.server.eidtOrgan(t,"/api/Organ/staff","staff"):n.server.addOrgan(t,"/api/Organ/staff","staff"),!1}),t.on("switch(IsRegisterUser)",function(t){t.elem.checked?(console.log("执行验证信息"),e(".iccUserBox").slideDown(),e(".iccUserBox input").attr("lay-verify","required")):(e(".iccUserBox").slideUp(),e(".iccUserBox input").attr("lay-verify",""))});var n={init:function(){this.server.getOrganTreeData(),this.render.showtips(),this.event()},baseData:{treeNode:{},id:"",nodeData:{},editFalge:!1},event:function(){e("#refresh").click(function(){e("#treeOrgan").html(""),n.server.getOrganTreeData(),e("#delet").addClass("layui-btn-disabled").attr("disabled","true"),n.baseData.editFalge=!1}),e("#showDepartment").click(function(){e("#formTitle").html("新增部门信息"),e(".submit").html("立即提交"),n.render.showForm("#DepartmentFrom"),n.baseData.editFalge=!1}),e("#showPosition").click(function(){e("#formTitle").html("新增职位信息"),e(".submit").html("立即提交"),n.render.showForm("#PositionFrom"),n.baseData.editFalge=!1}),e("#showStaff").click(function(){e("#formTitle").html("新增员工信息"),e(".submit").html("立即提交"),n.render.showForm("#staffFrom"),n.baseData.editFalge=!1}),e("#showStaff").click(function(){e("#formTitle").html("新增员工信息"),e(".submit").html("立即提交"),n.render.showForm("#staffFrom"),t.val("staffFrom",{topName:n.baseData.treeNode.name}),n.baseData.editFalge=!1}),e("#lower").click(function(){n.server.moveNodeData(n.baseData.treeNode,!1),n.baseData.editFalge=!1}),e("#upper").click(function(){n.server.moveNodeData(n.baseData.treeNode,!0),n.baseData.editFalge=!1}),e("#delet").click(function(){n.render.openDeleteConfirm(n.baseData.treeNode)})},server:{getOrganTreeData:function(){e.ajax({type:"get",url:layui.setter.baseUrl+"/api/Organ/treeview",dataType:"json",headers:{Accept:"application/json","Content-Type":"application/json"},success:function(e){if(a.closeAll("loading"),console.log(e),e.IsSucceed){console.log(e.Result.TreeNodes);var t=e.Result.TreeNodes,o=n.currData.addIcon(t);n.render.renderTree(o)}else a.msg("获取数据失败"+e,{icon:5})},error:function(e){a.closeAll(),a.msg("数据操作失败",{icon:5})}})},getNodedata:function(o,i){var r="";if("department"===o)r="/api/Organ/department/"+i,n.render.showForm("#DepartmentFrom");else if("position"===o)r="/api/Organ/position/"+i,n.render.showForm("#PositionFrom");else{if("staff"!==o)return void n.render.showForm("#organFrom");r="/api/Organ/staff/"+i,n.render.showForm("#staffFrom")}a.load(2),e.ajax({type:"get",url:layui.setter.baseUrl+r,dataType:"json",headers:{Accept:"application/json","Content-Type":"application/json"},success:function(e){if(a.closeAll(),console.log(e),e.IsSucceed){n.baseData.nodeData=e.Result;var i=e.Result;if("department"===o)t.val("DepartmentFrom",{Name:i.Name,NormalizedName:i.NormalizedName,Code:i.Code,IsMainBody:i.IsMainBody,Description:e.Description});else if("position"===o)t.val("PositionFrom",{Name:i.Name,NormalizedName:i.NormalizedName,Code:i.Code,IsMainBody:i.IsMainBody,Description:e.Description});else if("staff"===o){var r=i.Birthdate;i.Birthdate.indexOf("T")>-1&&(r=i.Birthdate.substring(0,i.Birthdate.indexOf("T"))),t.val("staffFrom",{Name:i.Name,NormalizedName:i.NormalizedName,JobNumber:i.JobNumber,Birthdate:r,Code:i.Code,IsMainBody:i.IsMainBody,Description:i.Description})}}else a.msg("获取节点数据失败! "+e.Errors[0].Message,{icon:5})},error:function(e){a.closeAll(),a.msg("数据操作失败",{icon:5})}})},addOrgan:function(t,o,i){var r=layui.consts.basePostData("CreateStaff");"department"===i?t.ParentId=n.baseData.id:"position"===i?t.DepartmentId=n.baseData.id:"staff"===i&&(t.PositionId=n.baseData.id),r.Data=t,console.log(r);var s=JSON.stringify(r);a.load(),e.ajax({type:"post",url:layui.setter.baseUrl+o,data:s,dataType:"json",headers:{Accept:"application/json","Content-Type":"application/json"},success:function(t){a.closeAll(),console.log(t),t.IsSucceed?(e("#treeOrgan").html(""),n.server.getOrganTreeData(),a.msg("添加成功!",{icon:6})):a.msg("增加数据失败! "+t.Errors[0].Message,{icon:5})},error:function(e){a.closeAll(),a.msg("数据操作失败",{icon:5})}})},eidtOrgan:function(t,o,i){var r=layui.consts.basePostData();t.Id=n.baseData.id,r.Data=t;var s="";s="staff"===i?o:o+"/"+n.baseData.id,console.log(t);var l=JSON.stringify(r);a.load(),e.ajax({type:"put",url:layui.setter.baseUrl+s,data:l,dataType:"json",headers:{Accept:"application/json","Content-Type":"application/json"},success:function(t){a.closeAll(),console.log(t),t.IsSucceed?(e("#treeOrgan").html(""),n.server.getOrganTreeData(),a.msg("修改成功!",{icon:6})):a.msg("增加数据失败! "+t.Errors[0].Message,{icon:5})},error:function(e){a.closeAll(),a.msg("数据操作失败",{icon:5})}})},moveNodeData:function(t,o){var i="";if("department"===t.Flag)i="/api/Organ/department/"+t.Id+"/order/"+o;else{if("position"!==t.Flag)return void n.render.showForm("#organFrom");i="/api/Organ/position/"+t.Id+"/order/"+o}a.load(),e.ajax({type:"put",url:layui.setter.baseUrl+i,dataType:"json",headers:{Accept:"application/json","Content-Type":"application/json"},success:function(t){a.closeAll("loading"),console.log(t),t.IsSucceed?(e("#treeOrgan").html(""),n.server.getOrganTreeData(),a.msg("数据移动成功",{icon:1})):a.msg("数据操作失败"+t.Errors[0].Message,{icon:5})},error:function(e){a.closeAll(),a.msg("数据操作失败",{icon:5})}})},delet:function(t,o){a.load();var i="";if("department"===t)i="/api/Organ/department/"+o;else if("position"===t)i="/api/Organ/position/"+o;else{if("staff"!==t)return void a.closeAll();i="/api/Organ/staff/"+o}e.ajax({type:"DELETE",url:layui.setter.baseUrl+i,dataType:"json",headers:{Accept:"application/json","Content-Type":"application/json"},success:function(t){a.closeAll(),console.log(t),t.IsSucceed?(e("#treeOrgan").html(""),n.server.getOrganTreeData(),a.alert("删除成功",{icon:1})):a.msg("获取节点数据失败! "+t.Errors[0].Message,{icon:5})},error:function(e){a.closeAll(),a.msg("数据操作失败",{icon:5})}})}},render:{renderTree:function(e){n.baseData.treeObj=layui.z_treeConfig.renderTree(e,"treeOrgan",{callback:{onClick:n.currData.treeOnClick}})},renderTitle:function(t){console.log(t),"organ"===t?e("#formTitle").html("公司基础信息"):"department"===t?e("#formTitle").html("编辑部门信息"):"position"===t?e("#formTitle").html("编辑职位信息"):"staff"===t&&e("#formTitle").html("编辑人员信息")},showForm:function(t){e("#DepartmentFrom").addClass("layui-hide"),e("#PositionFrom").addClass("layui-hide"),e("#staffFrom").addClass("layui-hide"),e("#organFrom").addClass("layui-hide"),e(t).show(),e(t).removeClass("layui-hide")},renderFormData:function(e){"department"===e.Flag&&t.val("DepartmentFrom",{Name:e.Title})},disabledBtton:function(e){i.isDisableButton("#delet",!1),i.isDisableButton("#lower",!1),i.isDisableButton("#upper",!1),"organ"===e?(i.isDisableButton("#lower",!0),i.isDisableButton("#upper",!0),i.isDisableButton("#showDepartment",!1),i.isDisableButton("#showPosition",!0),i.isDisableButton("#showStaff",!0)):"department"===e?(i.isDisableButton("#showPosition",!1),i.isDisableButton("#showDepartment",!1),i.isDisableButton("#showStaff",!0)):"position"===e?(i.isDisableButton("#showPosition",!0),i.isDisableButton("#showDepartment",!0),i.isDisableButton("#showStaff",!1)):"staff"===e&&(i.isDisableButton("#showPosition",!0),i.isDisableButton("#showDepartment",!0),i.isDisableButton("#showStaff",!0),i.isDisableButton("#lower",!0),i.isDisableButton("#upper",!0))},showtips:function(){i.showtips(".layui-btn-group button")},openDeleteConfirm:function(e){a.confirm("你确定要删除<span style='font-weight:bolder'>"+e.Title+"</span>的节点吗?",{btn:["确定","取消"],icon:3},function(){console.log("确认",e),n.server.delet(e.Flag,e.Id)},function(){console.log("取消")})}},currData:{getTreeNodeName:function(t,a){var o=i.getTreeNodeName(t,a,"name");e(".topName").val(o),e(".submit").html("立即修改")},addIcon:function(e){if(e.length>0)for(var t=0;t<e.length;t++)"organ"===e[t].Flag?(e[t].icon="../../../layuiadmin/style/img/ztreeImg/company.png",e[t].iconOpen="../../../layuiadmin/style/img/ztreeImg/companyOp.png"):"department"===e[t].Flag?(e[t].icon="../../../layuiadmin/style/img/ztreeImg/department.png",e[t].iconOpen="../../../layuiadmin/style/img/ztreeImg/departmentOp.png"):"position"===e[t].Flag?(e[t].icon="../../../layuiadmin/style/img/ztreeImg/position.png",e[t].iconOpen="../../../layuiadmin/style/img/ztreeImg/positionOp.png"):"staff"===e[t].Flag&&(delete e[t].Children,e[t].icon="../../../layuiadmin/style/img/ztreeImg/staff.png",e[t].iconOpen="../../../layuiadmin/style/img/ztreeImg/staffOp.png"),e[t].Children&&e[t].Children.length>0&&n.currData.addIcon(e[t].Children);return e},treeOnClick:function(t,a,o){console.log(o),n.baseData.treeNode=o,n.baseData.id=o.Id,n.baseData.editFalge=!0,n.render.renderTitle(o.Flag),n.server.getNodedata(o.Flag,o.Id),n.render.disabledBtton(o.Flag);var i=n.baseData.treeObj.getNodeByTId(o.parentTId);i&&(e("body .topName").val(i.Title),e(".submit").html("立即修改"))}}};n.init()});
//# sourceMappingURL=../src/maps/platform/organ.js.map
