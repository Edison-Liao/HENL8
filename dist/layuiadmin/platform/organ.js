/** layuiAdmin.std-v1.0.0 LPPL License By http://www.layui.com/admin/ */
 ;"use strict";layui.config({base:"../../../layuiadmin/"}).extend({index:"lib/index"}).use(["index","laydate","layer","tree","common","consts","z_treeConfig"],function(){var e=layui.$,t=layui.form,a=layui.layer,i=(layui.tree,layui.laydate),o=layui.common;layui.consts;i.render({elem:"#Birthdate"}),t.on("submit(DepartmentFrom)",function(e){return console.log(e.field,"新增部门"),delete e.field.topName,r.baseData.editFalge?(console.log("执行编辑命令"),r.server.eidtOrgan(e.field,"/api/Organ/department","department")):(r.server.addOrgan(e.field,"/api/Organ/department","department"),console.log("执行添加命令")),!1}),t.on("submit(PositionFrom)",function(e){return console.log(e.field,"新增职位"),delete e.field.topName,r.baseData.editFalge?(console.log("执行编辑命令"),r.server.eidtOrgan(e.field,"/api/Organ/position","position")):(r.server.addOrgan(e.field,"/api/Organ/position","position"),console.log("执行添加命令")),!1}),t.on("submit(staffFrom)",function(e){delete e.field.topName,console.log(e.field,"提交的人员信息");var t={};return e.field.IsRegisterUser?(t.Name=e.field.Name,t.NormalizedName=e.field.Name,t.Code=e.field.Code,t.JobNumber=e.field.JobNumber,t.Gender=e.field.Gender,t.Birthdate=e.field.Birthdate,t.PositionId=e.field.PositionId,t.IsStaffMainPosition=e.field.IsStaffMainPosition,t.IsRegisterUser=e.field.IsRegisterUser,t.Description=e.field.Description,t.CreateUser={Password:e.field.Password,ConfirmPassword:e.field.ConfirmPassword,ProviderKey:e.field.ConfirmPassword,DisplayName:e.field.DisplayName,Email:e.field.Email,PhoneNumber:e.field.Email,Portrait:e.field.Portrait,Description:e.field.DescriptionIcc}):(t.Name=e.field.Name,t.NormalizedName=e.field.Name,t.Code=e.field.Code,t.JobNumber=e.field.JobNumber,t.Gender=e.field.Gender,t.Birthdate=e.field.Birthdate,t.PositionId=e.field.PositionId,t.IsStaffMainPosition=new Boolean(e.field.IsStaffMainPosition).toString(),t.IsRegisterUser=new Boolean(e.field.IsRegisterUser).toString(),t.Description=e.field.Description,t.CreateUser={}),console.log(t,"获取到的数据"),r.baseData.editFalge?r.server.eidtOrgan(t,"/api/Organ/staff","staff"):r.server.addOrgan(t,"/api/Organ/staff","staff"),!1}),t.on("switch(IsRegisterUser)",function(t){t.elem.checked?(console.log("执行验证信息"),e(".iccUserBox").slideDown(),e(".iccUserBox input").attr("lay-verify","required")):(e(".iccUserBox").slideUp(),e(".iccUserBox input").attr("lay-verify",""))});var r={init:function(){this.server.getOrganTreeData(),this.render.showtips(),this.event()},baseData:{treeNode:{},id:"",nodeData:{},editFalge:!1},event:function(){e("#refresh").click(function(){e("#treeOrgan").html(""),r.server.getOrganTreeData(),e("#delet").addClass("layui-btn-disabled").attr("disabled","true"),r.baseData.editFalge=!1}),e("#showDepartment").click(function(){e("#formTitle").html("新增部门信息"),e(".submit").html("立即提交"),r.render.showForm("#DepartmentFrom"),r.baseData.editFalge=!1}),e("#showPosition").click(function(){e("#formTitle").html("新增职位信息"),e(".submit").html("立即提交"),r.render.showForm("#PositionFrom"),r.baseData.editFalge=!1}),e("#showStaff").click(function(){e("#formTitle").html("新增员工信息"),e(".submit").html("立即提交"),r.render.showForm("#staffFrom"),r.baseData.editFalge=!1}),e("#lower").click(function(){r.server.moveNodeData(r.baseData.treeNode,!1),r.baseData.editFalge=!1}),e("#upper").click(function(){r.server.moveNodeData(r.baseData.treeNode,!0),r.baseData.editFalge=!1}),e("#delet").click(function(){r.render.openDeleteConfirm(r.baseData.treeNode)})},server:{getOrganTreeData:function(){o.ajaxFun("get","/api/Organ/treeview").then(function(e){if(o.appResult.isSucceeded(e)){console.log(e.Result.TreeNodes);var t=e.Result.TreeNodes,a=r.currData.addIcon(t);r.render.renderTree(a),r.render.renderCompanyInfo(a)}else o.appResult.loadErrorText(e)}).fail(function(e){console.log(e)})},getNodedata:function(e,a){var i="";if("department"===e)i="/api/Organ/department/"+a,r.render.showForm("#DepartmentFrom");else if("position"===e)i="/api/Organ/position/"+a,r.render.showForm("#PositionFrom");else{if("staff"!==e)return void r.render.showForm("#organFrom");i="/api/Organ/staff/"+a,r.render.showForm("#staffFrom")}o.ajaxFun("get",i).then(function(a){if(o.appResult.isSucceeded(a)){r.baseData.nodeData=a.Result;var i=a.Result;if("department"===e)t.val("DepartmentFrom",{Name:i.Name,NormalizedName:i.NormalizedName,Code:i.Code,IsMainBody:i.IsMainBody,Description:a.Description});else if("position"===e)t.val("PositionFrom",{Name:i.Name,NormalizedName:i.NormalizedName,Code:i.Code,IsMainBody:i.IsMainBody,Description:a.Description});else if("staff"===e){var n=i.Birthdate;i.Birthdate.indexOf("T")>-1&&(n=i.Birthdate.substring(0,i.Birthdate.indexOf("T"))),t.val("staffFrom",{Name:i.Name,NormalizedName:i.NormalizedName,JobNumber:i.JobNumber,Birthdate:n,Code:i.Code,IsMainBody:i.IsMainBody,Description:i.Description})}}else o.appResult.loadErrorText(a)}).fail(function(e){console.log(e)})},addOrgan:function(t,i,n){var s=layui.consts.basePostData("CreateStaff");"department"===n?t.ParentId=r.baseData.id:"position"===n?t.DepartmentId=r.baseData.id:"staff"===n&&(t.PositionId=r.baseData.id),s.Data=t,console.log(s);var l=JSON.stringify(s);o.ajaxFun("post",i,l).then(function(t){o.appResult.isSucceeded(t)?(e("#treeOrgan").html(""),r.server.getOrganTreeData(),a.msg("添加成功!",{icon:6})):o.appResult.loadErrorText(t)}).fail(function(e){console.log(e)})},eidtOrgan:function(t,i,n){var s=layui.consts.basePostData();t.Id=r.baseData.id,s.Data=t;var l="";l="staff"===n?i:i+"/"+r.baseData.id,console.log(t);var d=JSON.stringify(s);o.ajaxFun("put",l,d).then(function(t){o.appResult.isSucceeded(t)?(e("#treeOrgan").html(""),r.server.getOrganTreeData(),a.msg("修改成功!",{icon:6})):o.appResult.loadErrorText(t)}).fail(function(e){console.log(e)})},moveNodeData:function(t,i){var n="";if("department"===t.Flag)n="/api/Organ/department/"+t.Id+"/order/"+i;else{if("position"!==t.Flag)return void r.render.showForm("#organFrom");n="/api/Organ/position/"+t.Id+"/order/"+i}o.ajaxFun("put",n).then(function(t){o.appResult.isSucceeded(t)?(e("#treeOrgan").html(""),r.server.getOrganTreeData(),a.msg("数据移动成功",{icon:1})):o.appResult.loadErrorText(t)}).fail(function(e){console.log(e)})},delet:function(t,i){var n="";if("department"===t)n="/api/Organ/department/"+i;else if("position"===t)n="/api/Organ/position/"+i;else{if("staff"!==t)return void a.closeAll();n="/api/Organ/staff/"+i}o.ajaxFun("DELETE",n).then(function(t){o.appResult.isSucceeded(t)?(e("#treeOrgan").html(""),r.server.getOrganTreeData(),a.alert("删除成功",{icon:1})):o.appResult.loadErrorText(t)}).fail(function(e){console.log(e)})}},render:{renderTree:function(e){r.baseData.treeObj=layui.z_treeConfig.renderTree(e,"treeOrgan",{callback:{onClick:r.currData.treeOnClick}})},renderTitle:function(t){console.log(t),"organ"===t?e("#formTitle").html("公司基础信息"):"department"===t?e("#formTitle").html("编辑部门信息"):"position"===t?e("#formTitle").html("编辑职位信息"):"staff"===t&&e("#formTitle").html("编辑人员信息")},showForm:function(t){e("#DepartmentFrom").addClass("layui-hide"),e("#PositionFrom").addClass("layui-hide"),e("#staffFrom").addClass("layui-hide"),e("#organFrom").addClass("layui-hide"),e(t).show(),e(t).removeClass("layui-hide")},renderCompanyInfo:function(t){console.log(t,"数据"),e("#companyName").html(t[0].Title?t[0].Title:"四川海力"),e("#companyCode").html(t[0].Code?t[0].Code:"HENL")},renderFormData:function(e){"department"===e.Flag&&t.val("DepartmentFrom",{Name:e.Title})},disabledBtton:function(e){o.isDisableButton("#delet",!1),o.isDisableButton("#lower",!1),o.isDisableButton("#upper",!1),"organ"===e?(o.isDisableButton("#lower",!0),o.isDisableButton("#upper",!0),o.isDisableButton("#showDepartment",!1),o.isDisableButton("#showPosition",!0),o.isDisableButton("#showStaff",!0)):"department"===e?(o.isDisableButton("#showPosition",!1),o.isDisableButton("#showDepartment",!1),o.isDisableButton("#showStaff",!0)):"position"===e?(o.isDisableButton("#showPosition",!0),o.isDisableButton("#showDepartment",!0),o.isDisableButton("#showStaff",!1)):"staff"===e&&(o.isDisableButton("#showPosition",!0),o.isDisableButton("#showDepartment",!0),o.isDisableButton("#showStaff",!0),o.isDisableButton("#lower",!0),o.isDisableButton("#upper",!0))},showtips:function(){o.showtips(".layui-btn-group button")},openDeleteConfirm:function(e){a.confirm("你确定要删除<span style='font-weight:bolder'>"+e.Title+"</span>的节点吗?",{btn:["确定","取消"],icon:3},function(){console.log("确认",e),r.server.delet(e.Flag,e.Id)},function(){console.log("取消")})}},currData:{getTreeNodeName:function(t,a){var i=o.getTreeNodeName(t,a,"name");e(".topName").val(i),e(".submit").html("立即修改")},addIcon:function(e){if(e.length>0)for(var t=0;t<e.length;t++)"organ"===e[t].Flag?e[t].icon="../../../layuiadmin/style/img/ztreeImg/company.png":"department"===e[t].Flag?e[t].icon="../../../layuiadmin/style/img/ztreeImg/department.png":"position"===e[t].Flag?e[t].icon="../../../layuiadmin/style/img/ztreeImg/position.png":"staff"===e[t].Flag&&(delete e[t].Children,e[t].icon="../../../layuiadmin/style/img/ztreeImg/staff.png"),e[t].Children&&e[t].Children.length>0&&r.currData.addIcon(e[t].Children);return e},treeOnClick:function(t,a,i){console.log(i),r.baseData.treeNode=i,r.baseData.id=i.Id,r.baseData.editFalge=!0,r.render.renderTitle(i.Flag),r.server.getNodedata(i.Flag,i.Id),r.render.disabledBtton(i.Flag);var o=r.baseData.treeObj.getNodeByTId(i.parentTId);o&&(e("body .topName").val(o.Title),e(".submit").html("立即修改"))}}};r.init()});
//# sourceMappingURL=../src/maps/platform/organ.js.map
