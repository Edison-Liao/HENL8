/** layuiAdmin.std-v1.0.0 LPPL License By http://www.layui.com/admin/ */
 ;"use strict";layui.config({base:"../../../layuiadmin/"}).extend({index:"lib/index"}).use(["index","layer","tree","common","element","consts","jquery_ztree_excheck","table"],function(){var e=layui.$,r=layui.table,t=layui.layer,n=(layui.tree,layui.common);layui.consts;jquery_ztree=layui.jquery_ztree_excheck;r.render({elem:"#userAuthTable",url:layui.setter.baseUrl+"/api/User/query/group/normal/1/10",parseData:layui.setter.parseData,cols:[[{type:"radio"},{field:"NormalizedName",title:"用户名"},{field:"GroupClassify",title:"类别",templet:function(e){return(e.GroupClassify="normal")?"普通用户":(e.GroupClassify="manager")?"业务管理员":"未知类别"}},{field:"锁定/解锁",title:"锁定状态",templet:function(e){return e.LockoutEnabled?'<span class="layui-btn layui-btn-primary layui-btn-xs">解锁</span>':'<span class="layui-btn layui-btn-normal layui-btn-xs">锁定</span>'}}]],page:!0,loading:!0,limit:10,text:"对不起，加载出现异常！"});r.on("radio(userAuthTable)",function(e){console.log(e.checked),console.log(e.data),e.checked&&(n.isDisableButton(".layui-btn",!1),s.baseData.id=e.data.Id,s.server.getUserAccessOrganNode("userTable",e.data.Id),s.server.getUserAccessRightNode("userTable",e.data.Id),s.server.getRoleWidthUserRightNode("userTable",e.data.Id))});var a={init:function(e,r,t){this.render.renderTree(e,r,t)},baseData:{zTreeObj:{}},treeSeting:{check:{enable:!0,chkboxType:{Y:"s",N:"ps"},nocheckInherit:!1},data:{simpleData:{enable:!0}},callback:{onCheck:function(e,r,t){console.log(t,"callback")}}},treeSetingRiod:{check:{enable:!0,chkStyle:"radio",radioType:"all",chkboxType:{Y:"s",N:"ps"},nocheckInherit:!1},data:{simpleData:{enable:!0}},callback:{onCheck:function(e,r,t){s.baseData.id=t.Id,t.checked?(n.isDisableButton(".layui-btn",!1),s.server.getUserAccessOrganNode("userTable",t.Id),s.server.getUserAccessRightNode("userTable",t.Id),s.server.getRoleWidthUserRightNode("userTable",t.Id)):n.isDisableButton(".layui-btn",!0)}}},event:{},render:{renderTree:function(r,t,n){var s=n?a.treeSetingRiod:a.treeSeting;a.baseData.zTreeObj=layui.jquery_ztree.init(e("#"+t),s,r);var i=layui.jquery_ztree.getZTreeObj(t),l=i.getNodes();l.length>0&&i.expandNode(l[0],!0,!1,!0)}}},s={init:function(){this.server.getRoleTreeData(),this.server.getAccessOrganTreeData(),this.server.getAccessRightTreeData(),this.event()},baseData:{treeNode:{},id:"",nodeData:{},editFalge:!1},event:function(){e("#accessOrganSub").click(function(){var e=layui.jquery_ztree.getZTreeObj("treeOrgan").getCheckedNodes(!0),r=s.currData.getArryNodeId(e,"Id"),t=s.baseData.id;s.server.putRoleAccessRight("Organ",r,t)}),e("#accessRightSub").click(function(){var e=layui.jquery_ztree.getZTreeObj("treeAccessRight").getCheckedNodes(!0),r=s.currData.getArryNodeId(e,"Id"),t=s.baseData.id;s.server.putRoleAccessRight("Right",r,t)}),e("#accessRoleSub").click(function(){var e=layui.jquery_ztree.getZTreeObj("roleTree").getCheckedNodes(!0),r=s.currData.getArryNodeId(e,"Id"),t=s.baseData.id;s.server.putRoleAccessRight("User",r,t)})},server:{getRoleTreeData:function(){n.ajaxFun("get","/api/Role/treeview").then(function(e){if(n.appResult.isSucceeded(e)){var r=function i(e){if(e.length>0)for(var r=0;r<e.length;r++)e[r].name=e[r].Title,e[r].children=e[r].Children,"roleCatalog"==e[r].Flag&&(e[r].nocheck=!0),e[r].Children.length>0&&i(e[r].Children);return e},t=e.Result.TreeNodes,a=r(t);s.render.renderRoleTree(a)}else n.appResult.loadErrorText(e)}).fail(function(e){console.log(e)})},getAccessOrganTreeData:function(){n.ajaxFun("get","/api/organ/treeview").then(function(r){if(n.appResult.isSucceeded(r)){var t=function u(e,r){if(e.length>0)for(var t=0;t<e.length;t++){if(e[t].name=e[t].Title,e[t].children=e[t].Children,r){var n="staff"!==e[t].Flag;e[t].nocheck=n,"staff"===e[t].Flag&&(delete e[t].Children,delete e[t].children)}e[t].Children&&e[t].Children.length>0&&u(e[t].Children,r)}return e},a=r.Result.TreeNodes,i=e.extend(!0,[],a),l=e.extend(!0,[],a),c=t(i,!1),o=t(l,!0);s.render.renderAccessOrganTree(c),s.render.renderAccessOrganTreeUser(o)}else n.appResult.loadErrorText(r)}).fail(function(e){console.log(e)})},getAccessRightTreeData:function(){n.ajaxFun("get","/api/Module/deep/permission").then(function(e){if(n.appResult.isSucceeded(e)){var r=function i(e){if(e.length>0)for(var r=0;r<e.length;r++)e[r].name=e[r].Name,e[r].Functions&&e[r].Functions.length>0&&(e[r].children=e[r].Functions),e[r].Permissions&&e[r].Permissions.length>0&&(e[r].children=e[r].Permissions),e[r].children&&e[r].children.length>0&&i(e[r].children);return e},t=e.Result,a=r(t);s.render.renderAccessRightTree(a)}else n.appResult.loadErrorText(e)}).fail(function(e){console.log(e)})},getUserAccessOrganNode:function(e,r){"userTable"===e&&(urlID="/api/User/accessOrgan/"+r,n.ajaxFun("get","/api/Role/accessOrgan/"+r).then(function(e){n.appResult.isSucceeded(e)?s.render.setTreeNodeCheck(e.Result,"treeOrgan"):n.appResult.loadErrorText(e)}).fail(function(e){console.log(e)}))},getUserAccessRightNode:function(e,r){var a="";"userTable"===e&&(a="/api/User/accessRight/"+r,n.ajaxFun("get",a).then(function(e){n.appResult.isSucceeded(e)?s.render.setTreeNodeCheck(e.Result,"treeAccessRight"):t.msg("获取功能访问权限数据失败! "+e.Errors[0].Message,{icon:5})}).fail(function(e){console.log(e)}))},getRoleWidthUserRightNode:function(e,r){"userTable"===e&&(urlID="/api/Role/with/user/"+r,n.ajaxFun("get",urlID).then(function(e){n.appResult.isSucceeded(e)?s.render.setTreeNodeCheck(e.Result,"roleTree"):t.msg("获取节点数据失败! "+e.Errors[0].Message,{icon:5})}).fail(function(e){console.log(e)}))},putRoleAccessRight:function(e,r,a){var s="";if("Organ"===e)s="/api/Role/accessOrgan/"+a;else if("Right"===e)s="/api/Role/accessRight/"+a;else{if("User"!==e)return t.msg("出错啦");s="/api/Role/with/user/"+a}var i=layui.consts.basePostData();i.Data=r;var l=JSON.stringify(i);n.ajaxFun("put",s,l).then(function(e){n.appResult.isSucceeded(e)?(console.log(e.Result,"当前角色点"),t.msg("更新权限成功!",{icon:6})):t.msg("更新权限数据失败! "+e.Errors[0].Message,{icon:5})}).fail(function(e){console.log(e)})}},render:{renderRoleTree:function(e){a.init(e,"roleTree")},renderAccessOrganTree:function(e){a.init(e,"treeOrgan")},renderAccessRightTree:function(e){a.init(e,"treeAccessRight")},renderAccessOrganTreeUser:function(e){a.init(e,"treeOrganUser",!0)},openDeleteConfirm:function(e){console.log(e,"模态框")},setTreeNodeCheck:function(e,r){var t=layui.jquery_ztree.getZTreeObj(r);if(console.log(e,r,"被赋值的选项"),null!=t){t.checkAllNodes(!1);var n=t.getNodes();if(n.length>0&&e.length>0)for(var a=0;a<e.length;a++){var s=t.getNodeByParam("Id",e[a],null);if(t.expandNode(s,!0,!0,!0,!1),null===s)return;s.checked=!0,t.updateNode(s,!1)}}}},currData:{getArryNodeId:function(e,r){for(var t=[],n=0;n<e.length;n++){var a=e[n][r];t.push(a)}return t}}};s.init()});
//# sourceMappingURL=../src/maps/platform/userauth.js.map
