/** layuiAdmin.std-v1.0.0 LPPL License By http://www.layui.com/admin/ */
 ;"use strict";layui.config({base:"../../../layuiadmin/"}).extend({index:"lib/index"}).use(["index","layer","tree","common","element","consts","jquery_ztree_excheck","table"],function(){var e=layui.$,r=layui.table,t=layui.layer,s=(layui.tree,layui.common);layui.consts;jquery_ztree=layui.jquery_ztree_excheck;r.render({elem:"#userAuthTable",url:layui.setter.baseUrl+"/api/User/query/group/normal/1/10",parseData:layui.setter.parseData,cols:[[{type:"radio"},{field:"NormalizedName",title:"用户名"},{field:"GroupClassify",title:"类别",templet:function(e){return(e.GroupClassify="normal")?"普通用户":(e.GroupClassify="manager")?"业务管理员":"未知类别"}},{field:"锁定/解锁",title:"锁定状态",templet:function(e){return e.LockoutEnabled?'<span class="layui-btn layui-btn-primary layui-btn-xs">解锁</span>':'<span class="layui-btn layui-btn-normal layui-btn-xs">锁定</span>'}}]],page:!0,loading:!0,limit:10,text:"对不起，加载出现异常！"});r.on("radio(userAuthTable)",function(e){console.log(e.checked),console.log(e.data),e.checked&&(s.isDisableButton(".layui-btn",!1),n.baseData.id=e.data.Id,n.server.getUserAccessOrganNode("userTable",e.data.Id),n.server.getUserAccessRightNode("userTable",e.data.Id),n.server.getRoleWidthUserRightNode("userTable",e.data.Id))});var a={init:function(e,r,t){this.render.renderTree(e,r,t)},baseData:{zTreeObj:{}},treeSeting:{check:{enable:!0,chkboxType:{Y:"s",N:"ps"},nocheckInherit:!1},data:{simpleData:{enable:!0}},callback:{onCheck:function(e,r,t){console.log(t,"callback")}}},treeSetingRiod:{check:{enable:!0,chkStyle:"radio",radioType:"all",chkboxType:{Y:"s",N:"ps"},nocheckInherit:!1},data:{simpleData:{enable:!0}},callback:{onCheck:function(e,r,t){n.baseData.id=t.Id,t.checked?(s.isDisableButton(".layui-btn",!1),n.server.getUserAccessOrganNode("userTable",t.Id),n.server.getUserAccessRightNode("userTable",t.Id),n.server.getRoleWidthUserRightNode("userTable",t.Id)):s.isDisableButton(".layui-btn",!0)}}},event:{},render:{renderTree:function(r,t,s){var n=s?a.treeSetingRiod:a.treeSeting;a.baseData.zTreeObj=layui.jquery_ztree.init(e("#"+t),n,r);var i=layui.jquery_ztree.getZTreeObj(t),l=i.getNodes();l.length>0&&i.expandNode(l[0],!0,!1,!0)}}},n={init:function(){this.server.getRoleTreeData(),this.server.getAccessOrganTreeData(),this.server.getAccessRightTreeData(),this.event()},baseData:{treeNode:{},id:"",nodeData:{},editFalge:!1},event:function(){e("#accessOrganSub").click(function(){var e=layui.jquery_ztree.getZTreeObj("treeOrgan").getCheckedNodes(!0),r=n.currData.getArryNodeId(e,"Id"),t=n.baseData.id;n.server.putRoleAccessRight("Organ",r,t)}),e("#accessRightSub").click(function(){var e=layui.jquery_ztree.getZTreeObj("treeAccessRight").getCheckedNodes(!0),r=n.currData.getArryNodeId(e,"Id"),t=n.baseData.id;n.server.putRoleAccessRight("Right",r,t)}),e("#accessRoleSub").click(function(){var e=layui.jquery_ztree.getZTreeObj("roleTree").getCheckedNodes(!0),r=n.currData.getArryNodeId(e,"Id"),t=n.baseData.id;n.server.putRoleAccessRight("User",r,t)})},server:{getRoleTreeData:function(){e.ajax({type:"get",url:layui.setter.baseUrl+"/api/Role/treeview",dataType:"json",headers:{Accept:"application/json","Content-Type":"application/json"},success:function(e){if(t.closeAll("loading"),e.IsSucceed){var r=function i(e){if(e.length>0)for(var r=0;r<e.length;r++)e[r].name=e[r].Title,e[r].children=e[r].Children,"roleCatalog"==e[r].Flag&&(e[r].nocheck=!0),e[r].Children.length>0&&i(e[r].Children);return e};console.log(e.Result.TreeNodes);var s=e.Result.TreeNodes,a=r(s);n.render.renderRoleTree(a)}else t.msg("获取角色数据失败!"+e.Errors[0].Message,{icon:5})},error:function(e){t.closeAll(),t.msg("数据操作失败",{icon:5})}})},getAccessOrganTreeData:function(){e.ajax({type:"get",url:layui.setter.baseUrl+"/api/organ/treeview",dataType:"json",headers:{Accept:"application/json","Content-Type":"application/json"},success:function(r){if(t.closeAll("loading"),r.IsSucceed){var s=function u(e,r){if(e.length>0)for(var t=0;t<e.length;t++){if(e[t].name=e[t].Title,e[t].children=e[t].Children,r){var s="staff"!==e[t].Flag;e[t].nocheck=s,"staff"===e[t].Flag&&(delete e[t].Children,delete e[t].children)}e[t].Children&&e[t].Children.length>0&&u(e[t].Children,r)}return e};console.log(r.Result.TreeNodes);var a=r.Result.TreeNodes,i=e.extend(!0,[],a),l=e.extend(!0,[],a),c=s(i,!1),o=s(l,!0);n.render.renderAccessOrganTree(c),n.render.renderAccessOrganTreeUser(o)}else t.msg("获取数据失败"+r.Errors[0].Message,{icon:5})},error:function(e){t.closeAll(),t.msg("数据操作失败",{icon:5})}})},getAccessRightTreeData:function(){e.ajax({type:"get",url:layui.setter.baseUrl+"/api/Module/deep/permission",dataType:"json",headers:{Accept:"application/json","Content-Type":"application/json"},success:function(e){if(t.closeAll("loading"),e.IsSucceed){var r=function i(e){if(e.length>0)for(var r=0;r<e.length;r++)e[r].name=e[r].Name,e[r].Functions&&e[r].Functions.length>0&&(e[r].children=e[r].Functions),e[r].Permissions&&e[r].Permissions.length>0&&(e[r].children=e[r].Permissions),e[r].children&&e[r].children.length>0&&i(e[r].children);return e},s=e.Result,a=r(s);n.render.renderAccessRightTree(a)}else t.msg("获取数据失败"+e.Errors[0].Message,{icon:5})},error:function(e){t.closeAll(),t.msg("数据操作失败",{icon:5})}})},getUserAccessOrganNode:function(r,s){"userTable"===r&&(urlID="/api/User/accessOrgan/"+s,e.ajax({type:"get",url:layui.setter.baseUrl+"/api/Role/accessOrgan/"+s,dataType:"json",headers:{Accept:"application/json","Content-Type":"application/json"},success:function(e){t.closeAll(),e.IsSucceed?n.render.setTreeNodeCheck(e.Result,"treeOrgan"):t.msg("获取节点数据失败! "+e.Errors[0].Message,{icon:5})},error:function(e){t.closeAll(),t.msg("数据操作失败",{icon:5})}}))},getUserAccessRightNode:function(r,s){var a="";"userTable"===r&&(a="/api/User/accessRight/"+s,t.load(2),e.ajax({type:"get",url:layui.setter.baseUrl+a,dataType:"json",headers:{Accept:"application/json","Content-Type":"application/json"},success:function(e){t.closeAll(),e.IsSucceed?n.render.setTreeNodeCheck(e.Result,"treeAccessRight"):t.msg("获取功能访问权限数据失败! "+e.Errors[0].Message,{icon:5})},error:function(e){t.closeAll(),t.msg("数据操作失败",{icon:5})}}))},getRoleWidthUserRightNode:function(r,s){"userTable"===r&&(urlID="/api/Role/with/user/"+s,e.ajax({type:"get",url:layui.setter.baseUrl+urlID,dataType:"json",headers:{Accept:"application/json","Content-Type":"application/json"},success:function(e){t.closeAll(),e.IsSucceed?n.render.setTreeNodeCheck(e.Result,"roleTree"):t.msg("获取节点数据失败! "+e.Errors[0].Message,{icon:5})},error:function(e){t.closeAll(),t.msg("数据操作失败",{icon:5})}}))},putRoleAccessRight:function(r,s,a){var n="";if("Organ"===r)n="/api/Role/accessOrgan/"+a;else if("Right"===r)n="/api/Role/accessRight/"+a;else{if("User"!==r)return t.msg("出错啦");n="/api/Role/with/user/"+a}var i=layui.consts.basePostData();i.Data=s;var l=JSON.stringify(i);t.load(),e.ajax({type:"put",url:layui.setter.baseUrl+n,dataType:"json",data:l,headers:{Accept:"application/json","Content-Type":"application/json"},success:function(e){t.closeAll(),e.IsSucceed?(console.log(e.Result,"当前角色点"),t.msg("更新权限成功!",{icon:6})):t.msg("更新权限数据失败! "+e.Errors[0].Message,{icon:5})},error:function(e){t.closeAll(),t.msg("数据操作失败",{icon:5})}})}},render:{renderRoleTree:function(e){a.init(e,"roleTree")},renderAccessOrganTree:function(e){a.init(e,"treeOrgan")},renderAccessRightTree:function(e){a.init(e,"treeAccessRight")},renderAccessOrganTreeUser:function(e){a.init(e,"treeOrganUser",!0)},openDeleteConfirm:function(e){console.log(e,"模态框")},setTreeNodeCheck:function(e,r){var t=layui.jquery_ztree.getZTreeObj(r);if(console.log(e,r,"被赋值的选项"),null!=t){t.checkAllNodes(!1);var s=t.getNodes();if(s.length>0&&e.length>0)for(var a=0;a<e.length;a++){var n=t.getNodeByParam("Id",e[a],null);if(t.expandNode(n,!0,!0,!0,!1),null===n)return;n.checked=!0,t.updateNode(n,!1)}}}},currData:{getArryNodeId:function(e,r){for(var t=[],s=0;s<e.length;s++){var a=e[s][r];t.push(a)}return t}}};n.init()});
//# sourceMappingURL=../src/maps/platform/userauth.js.map
