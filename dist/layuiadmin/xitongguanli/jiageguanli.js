/** layuiAdmin.std-v1.0.0 LPPL License By http://www.layui.com/admin/ */
 ;"use strict";layui.config({base:"../../../layuiadmin/"}).extend({index:"lib/index"}).use(["index","table","layer","tree","common","consts","haderSerch","laydate"],function(){var e=layui.$,a=layui.form,t=layui.table,i=layui.layer,r=(layui.tree,layui.laydate),o=layui.common,n={};r.render({elem:"#LadderDatetime",range:!0}),r.render({elem:"#PriceDateTime",range:!0}),r.render({elem:"#PriceSurchargeStar"}),e("body").on("mousedown",".layui-tree a",function(){e(this).siblings("ul").length||(e(".layui-tree a cite").css("color","#333"),e(this).find("cite").css("color","red"))}),a.on("submit(DepartmentFrom)",function(e){return console.log(e.field,"新增部门"),delete e.field.topName,l.baseData.editFalge?(console.log("执行编辑命令"),l.server.eidtOrgan(e.field,"/api/Role","department")):(l.server.addOrgan(e.field,"/api/Role","department"),console.log("执行添加命令")),!1}),a.on("submit(staffFrom)",function(e){return delete e.field.topName,l.baseData.editFalge?l.server.eidtOrgan(e.field,"/api/Role","staff"):l.server.addOrgan(e.field,"/api/Role","staff"),!1}),t.on("tool()",function(t){var r=t.data,n=t.event;t.tr;"detail"===n&&(console.info(r),o.ajaxFun("get","/api/PriceDetail/query/"+r.Me.Id).then(function(t){if(o.appResult.isSucceeded(t)){console.info(t);var r=t.Result.Me;i.open({type:1,title:"查看价格版本详情",content:e("#lock-detail-from"),maxmin:!0,area:["800px","400px"],btn:["关闭"]}),console.info(r.PriceStartDateTime),console.info(r.PriceStartDateTime.substr(0,10)),a.val("lock-detail-from",{PriceVersion:r.PriceVersion,BasePrice:r.BasePrice,IsLadder:r.IsLadder,PriceLadderType:r.PriceLadderType,PriceLadderTypeName:r.PriceLadderTypeName,LadderCycleValue:r.LadderCycleValue,LadderDatetime:r.LadderStartDatetime.substr(0,10)+" - "+r.LadderEndDatetime.substr(0,10),IsSale:r.IsSale,LadderGas1:r.LadderGas1,LadderPrice1:r.LadderPrice1,LadderGas2:r.LadderGas2,LadderPrice2:r.LadderPrice2,LadderGas3:r.LadderGas3,LadderPrice3:r.LadderPrice3,LadderGas4:r.LadderGas4,LadderPrice4:r.LadderPrice4,BasePersonCount:r.BasePersonCount,PersonLadderAdd1:r.PersonLadderAdd1,PersonLadderAdd2:r.PersonLadderAdd2,PersonLadderAdd3:r.PersonLadderAdd3,PersonLadderAdd4:r.PersonLadderAdd4,IsSurcharge:r.IsSurcharge,priceSurcharge:r.priceSurcharge,priceSurchargeName:r.priceSurchargeName,PriceSurchargeStart:r.PriceSurchargeStart,PriceSurchargeStartName:r.PriceSurchargeStartName,PriceSurchargeValue:r.PriceSurchargeValue,PriceSurchargeDelayMonth:r.PriceSurchargeDelayMonth,PriceSurchargeDelayDay:r.PriceSurchargeDelayDay,PriceDateTime:r.PriceStartDateTime.substr(0,10)+" - "+r.PriceEndDateTime.substr(0,10),SortNum:r.SortNum,Description:r.Description})}else o.appResult.loadErrorText(t)}).fail(function(e){console.log(e)}))});var l={init:function(){this.server.getTreeData(),this.render.showtips(),this.event()},baseData:{treeNode:{},id:"",nodeData:{},editFalge:!1},event:function(){e("#refresh").click(function(){e("#treeOrgan").html(""),l.server.getTreeData(),l.baseData.editFalge=!1}),e("#addPriceType").click(function(){i.open({type:1,title:"添加价格类型",content:e("#lock-from"),maxmin:!0,area:["800px","400px"],btn:["确定","取消"],yes:function(t,i){var r=e("#LAY-jiageleixing-add-submit");a.on("submit(LAY-jiageleixing-add-submit)",function(e){var a=e.field;o.ajaxFun("get","/api/Common/GetInsertGuid").then(function(e){o.appResult.isSucceeded(e)?(a.Idd=e.Result,console.info(a),l.server.addType(a)):o.appResult.loadErrorText(e)}).fail(function(e){console.log(e)})}),r.trigger("click")}})}),e("#addPriceVersion").click(function(){console.info("addPriceVersion"),i.open({type:1,title:"添加价格版本",content:e("#lock-detail-from"),maxmin:!0,area:["800px","400px"],btn:["确定","取消"],yes:function(t,i){var r=e("#LAY-jiagebanben-add-submit");a.on("submit(LAY-jiagebanben-add-submit)",function(e){var a=e.field;a.PriceTypeID=n.Id,o.ajaxFun("get","/api/Common/GetInsertGuid").then(function(e){if(o.appResult.isSucceeded(e)){a.Idd=e.Result;var t=a.LadderDatetime.split(" "),i=a.PriceDateTime.split(" ");a.PriceStartDateTime=i[0],a.PriceEndDateTime=i[2],a.LadderStartDatetime=t[0],a.LadderEndDatetime=t[2],a.IsLadder="on"==a.IsLadder,a.IsSale="on"==a.IsSale,a.IsSurcharge="on"==a.IsSurcharge,delete a.PriceDateTime,delete a.LadderDatetime,l.server.addVer(a)}else o.appResult.loadErrorText(e)}).fail(function(e){console.log(e)})}),r.trigger("click")}})}),e("#edtPriceType").click(function(){return console.info(n),"{}"==JSON.stringify(n)?void i.msg("未选择价格类型，请选择后再进行修改操作",{icon:5}):(i.open({type:1,title:"修改用气类型",content:e("#lock-from"),maxmin:!0,area:["800px","400px"],btn:["确定","取消"],yes:function(t,i){var r=e("#LAY-jiageleixing-add-submit");a.on("submit(LAY-jiageleixing-add-submit)",function(e){var a=e.field;console.info(a),l.server.edit(a)}),r.trigger("click")}}),void a.val("lock-from",{Coding:n.Coding,Name:n.Name,CompanyCoding:n.CompanyCoding,Status:n.Status,MonthLimitGas:n.MonthLimitGas,YearLimitGas:n.YearLimitGas,SortNum:n.SortNum,Description:n.Description}))}),e("#delPriceType").click(function(){return console.info(n),"{}"==JSON.stringify(n)?void i.msg("未选择价格类型，请选择后再进行删除操作",{icon:5}):void i.confirm("真的删除行么",function(){console.info(n),l.server["delete"](n.Id)})}),e("#showStaff").click(function(){console.info("yes"),e("#formTitle").html("新增角色信息"),e(".submit").html("立即提交"),l.render.showForm("#staffFrom"),a.val("staffFrom",{topName:l.baseData.treeNode.name}),l.baseData.editFalge=!1}),e("#lower").click(function(){l.server.moveNodeData(l.baseData.treeNode,!1),l.baseData.editFalge=!1}),e("#upper").click(function(){l.server.moveNodeData(l.baseData.treeNode,!0),l.baseData.editFalge=!1}),e("#delet").click(function(){l.render.openDeleteConfirm(l.baseData.treeNode)})},server:{getTreeData:function(){var e=layui.consts.basePostData();e.Data={},e.Data.CompanyCoding="88888888",e.Data.PageIndex="1",e.Data.PageSize="100",e.Method="list",console.log(e);JSON.stringify(e);o.ajaxFun("get","/api/PriceType/query/list/?CompanyCoding="+e.Data.CompanyCoding+"&PageIndex="+e.Data.PageIndex+"&PageSize="+e.Data.PageSize).then(function(e){if(o.appResult.isSucceeded(e)){var a=function(e){if(e.length>0)for(var a=0;a<e.length;a++)e[a].name=e[a].Name;return e};console.log(e.Result);var t=e.Result.DataSource,i=a(t);l.render.renderTree(i)}else o.appResult.loadErrorText(e)}).fail(function(e){console.log(e)})},getNodedata:function(t,r){var o="";if("roleCatalog"===t)o="/api/Role/"+r,l.render.showForm("#DepartmentFrom");else{if("roleInfo"!==t)return;o="/api/Role/"+r,l.render.showForm("#staffFrom")}i.load(2),e.ajax({type:"get",url:layui.setter.baseUrl+o,dataType:"json",headers:{Accept:"application/json","Content-Type":"application/json"},success:function(e){if(i.closeAll(),console.log(e),e.IsSucceed){l.baseData.nodeData=e.Result;var r=e.Result;"roleCatalog"===t?a.val("DepartmentFrom",{Name:r.Name,Code:r.Code,Message:r.Message}):"roleInfo"===t&&a.val("staffFrom",{Name:r.Name,Code:r.Code,Message:r.Message})}else i.msg("获取节点数据失败! "+e.Errors[0].Message,{icon:5})},error:function(e){i.closeAll(),i.msg("数据操作失败",{icon:5})}})},addType:function(a,t,r){var n=layui.consts.basePostData();n.Data=a,n.Data.CompanyCoding="88888888",n.Data.CompanyName="88888888",n.Method="insert";var s=JSON.stringify(n);i.load(),o.ajaxFun("post","/api/PriceType/insert",s).then(function(a){o.appResult.isSucceeded(a)?(e("#lock-from").find("input[type=text],select,input[type=hidden]").each(function(){e(this).val("")}),e("#treeOrgan").html(""),l.server.getTreeData(),i.msg("数据添加成功!",{icon:6})):o.appResult.loadErrorText(a)}).fail(function(e){console.log(e)}),i.closeAll()},addVer:function(a,r,n){var l=layui.consts.basePostData();l.Data=a,l.Data.CompanyCoding="88888888",l.Data.CompanyName="88888888",l.Method="insert";var s=JSON.stringify(l);i.load(),o.ajaxFun("post","/api/PriceDetail/insert",s).then(function(a){o.appResult.isSucceeded(a)?(e("#lock-from").find("input[type=text],select,input[type=hidden]").each(function(){e(this).val("")}),t.reload("LAY-jiagebanbenTable"),i.msg("数据添加成功!",{icon:6})):o.appResult.loadErrorText(a)}).fail(function(e){console.log(e)}),i.closeAll()},edit:function(a,t){i.load();var r=layui.consts.basePostData();r.Data=a,r.Data.CompanyCoding="88888888",r.Data.CompanyName="88888888",r.Data.Id=n.Id,r.Method="update",console.log(a);var s=JSON.stringify(r);o.ajaxFun("put","/api/PriceType/update",s).then(function(a){o.appResult.isSucceeded(a)?(e("#lock-from").find("input[type=text],select,input[type=hidden]").each(function(){e(this).val("")}),e("#treeOrgan").html(""),l.server.getTreeData(),i.msg("数据修改成功!",{icon:6})):o.appResult.loadErrorText(a)}).fail(function(e){console.log(e)}),i.closeAll()},moveNodeData:function(a,t){var r="";"roleInfo"===a.Flag&&(r="/api/Role/"+a.Id+"/order/"+t,i.load(),e.ajax({type:"put",url:layui.setter.baseUrl+r,dataType:"json",headers:{Accept:"application/json","Content-Type":"application/json"},success:function(a){i.closeAll("loading"),console.log(a),a.IsSucceed?(e("#treeOrgan").html(""),l.server.getTreeData(),i.msg("数据移动成功",{icon:1})):i.msg("数据操作失败"+a.Errors[0].Message,{icon:5})},error:function(e){i.closeAll(),i.msg("数据操作失败",{icon:5})}}))},"delete":function(t){i.load();var r=layui.consts.basePostData();r.Data=t,r.Method="remove",console.log(r);var n=JSON.stringify(r);o.ajaxFun("delete","/api/PriceType/remove",n).then(function(t){o.appResult.isSucceeded(t)?(e("#treeOrgan").html(""),l.server.getTreeData(),i.msg("数据删除成功!",{icon:6}),a.val("PriceTypeFrom",{Coding:"",Name:"",CompanyCoding:"",Status:"",MonthLimitGas:"",YearLimitGas:"",SortNum:"",Description:""})):o.appResult.loadErrorText(t)}).fail(function(e){console.log(e)})}},render:{renderTree:function(e){layui.tree({elem:"#treeOrgan",target:"_blank",click:function(e){n=e,a.val("PriceTypeFrom",{Coding:n.Coding,Name:n.Name,CompanyCoding:n.CompanyCoding,Status:n.Status,MonthLimitGas:n.MonthLimitGas,YearLimitGas:n.YearLimitGas,SortNum:n.SortNum,Description:n.Description});t.render({elem:"#LAY-jiagebanbenTable",id:"LAY-jiagebanbenTable",url:layui.setter.baseUrl+"/api/PriceDetail/query/list",where:{CompanyCoding:"88888888",Method:"list"},parseData:layui.setter.parseData,request:{tokenName:!1,pageName:"PageIndex",limitName:"PageSize"},page:!0,cols:[[{field:"PriceVersion",title:"价格版本",templet:function(e){return e.Me.PriceVersion}},{field:"IsLadder",title:"是否有阶梯",templet:function(e){return e.Me.IsLadder?"是":"无"}},{field:"BasePrice",title:"基础价格",templet:function(e){return e.Me.BasePrice}},{field:"LadderStartDatetime",title:"阶梯开始时间",templet:function(e){return"<div>"+layui.util.toDateString(e.LadderStartDatetime)+"</div>"}},{field:"PriceStartDateTime",title:"价格开始时间",templet:function(e){return"<div>"+layui.util.toDateString(e.Me.PriceStartDateTime)+"</div>"}},{title:"操作",fixed:"right",align:"center",toolbar:"#LAY-jiagebanbenTable-barOperation"}]],loading:!0,limit:10,text:"对不起，加载出现异常！"})},nodes:e})},renderTitle:function(a){"roleCatalog"===a?e("#formTitle").html("编辑角色信息分组"):"roleInfo"===a&&e("#formTitle").html("编辑角色信息")},showForm:function(a){e("#DepartmentFrom").addClass("layui-hide"),e("#staffFrom").addClass("layui-hide"),e(a).show(),e(a).removeClass("layui-hide")},renderFormData:function(e){"roleCatalog"===e.Flag&&a.val("DepartmentFrom",{Name:e.Title})},disabledBtton:function(e){o.isDisableButton("#lower",!1),o.isDisableButton("#upper",!1),o.isDisableButton("#delet",!1),"roleCatalog"===e?(o.isDisableButton("#lower",!0),o.isDisableButton("#upper",!0),o.isDisableButton("#showDepartment",!1),o.isDisableButton("#showStaff",!1)):"roleInfo"===e&&(o.isDisableButton("#showDepartment",!0),o.isDisableButton("#showStaff",!0))},showtips:function(){o.showtips(".layui-btn-group button")},openDeleteConfirm:function(e){i.confirm("你确定要删除<span style='font-weight:bolder'>"+e.Title+"</span>的节点吗?",{btn:["确定","取消"],icon:3},function(){l.server.delet(e.Flag,e.Id)},function(){console.log("取消")})}},currData:{getTreeNodeName:function(a,t){var i=o.getTreeNodeName(a,t,"name");e(".topName").val(i),e(".submit").html("立即修改")}}};l.init()});
//# sourceMappingURL=../src/maps/xitongguanli/jiageguanli.js.map
