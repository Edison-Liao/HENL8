/** layuiAdmin.std-v1.0.0 LPPL License By http://www.layui.com/admin/ */
 ;"use strict";layui.config({base:"../../../layuiadmin/"}).extend({index:"lib/index"}).use(["index","table","form","consts","common","layer","laydate","element"],function(){var e=layui.$,t=layui.table,r=layui.form,i=layui.laydate,a=layui.element,l=layui.common,n=(layui.laypage,{baseUrl:layui.setter.revenueUrl}),d={},o={getMeterFireResult:function(e){l.ajaxFun("get","/api/Meter/MeterFireResult?Method=meterfireresult","",n).then(function(t){if(l.appResult.isSucceeded(t)){console.info("res",t),addType=t;var r={element:e,items:t.Result};s.renderSelect(r)}else l.appResult.loadErrorText(t)}).fail(function(e){console.log(e)})},getMeterCalculateType:function(e){l.ajaxFun("get","/api/Meter/MeterCalculateType?Method=metercalculatetype","",n).then(function(e){if(l.appResult.isSucceeded(e)){addType=e;var t={element:"CalculateType",items:e.Result};s.renderSelect(t)}else l.appResult.loadErrorText(e)}).fail(function(e){console.log(e)})},getGasDirection:function(e){l.ajaxFun("get","/api/Meter/MeterGasDirection?Method=metergasdirection","",n).then(function(e){if(l.appResult.isSucceeded(e)){addType=e;var t={element:"GasDirection",items:e.Result};s.renderSelect(t)}else l.appResult.loadErrorText(e)}).fail(function(e){console.log(e)})},getMeterStatus:function(e){l.ajaxFun("get","/api/Meter/MeterStatus?Method=meterstatus","",n).then(function(e){if(l.appResult.isSucceeded(e)){addType=e;var t={element:"MeterStatus",items:e.Result};s.renderSelect(t)}else l.appResult.loadErrorText(e)}).fail(function(e){console.log(e)})},getMeterPayMode:function(e){l.ajaxFun("get","/api/Meter/MeterPayMode?Method=meterpaymode","",n).then(function(e){if(l.appResult.isSucceeded(e)){addType=e;var t={element:"MeterPayMode",items:e.Result};s.renderSelect(t)}else l.appResult.loadErrorText(e)}).fail(function(e){console.log(e)})},getPriceType:function(e){l.ajaxFun("get","/api/PriceType/query/all?Method=all","",n).then(function(e){if(l.appResult.isSucceeded(e)){addType=e;var t={element:"PriceTypeId",items:e.Result};s.renderObjSelect(t)}else l.appResult.loadErrorText(e)}).fail(function(e){console.log(e)})},addMeter:function(e){layer.closeAll();var r=layui.consts.basePostData();r.Data=e,r.Method="insert";var i=JSON.stringify(r);l.ajaxFun("post","/api/Meter/insert",i,n).then(function(e){l.appResult.isSucceeded(e)?(t.reload("LAY-meterTable"),layer.msg("数据添加成功!",{icon:6})):l.appResult.loadErrorText(e)}).fail(function(e){console.log(e)})},detailMeter:function(t){layer.closeAll();var i=layui.consts.basePostData();i.Data=t,i.Method="insert";JSON.stringify(i);l.ajaxFun("get","/api/Meter/query/key?Data.Id="+t.Id+"&Method=key","",n).then(function(t){if(l.appResult.isSucceeded(t)){var t=t.Result;e("#lock-meterEditDetail-from").find("input[type=text],select,input[type=hidden],textarea").each(function(){e(this).attr("disabled","disabled")}),e("#LAY-edit-address-search-submit").attr("disabled","disabled"),e("#LAY-fire-add").attr("disabled","disabled"),e("#LAY-edit-address-search-submit").attr("class","layui-btn layui-btn-disabled"),e("#LAY-fire-add").attr("class","layui-btn layui-btn-disabled"),layer.open({type:1,title:"表具详情",content:e("#lock-meterEdit-from"),maxmin:!0,area:["800px","500px"]}),d.meterId=t.Me.MeterId,console.info("res",t),r.val("lock-meterEditDetail-from",{Address:t.Address.Address,EditMeterStatus:t.Me.MeterStatus,EditMeterPayMode:t.Me.MeterPayMode,StepFamilyMembers:t.Me.StepFamilyMembers,EditStepFamilyMemberEndDate:t.Me.StepFamilyMemberEndDate.substr(0,10),EditPriceTypeId:t.Me.PriceTypeId,MeterFactoryId:t.Me.MeterFactoryId,MeterTypeId:t.Me.MeterTypeId,MeterSize:t.Me.MeterSize,MeterCode:t.Me.MeterCode,BeginNum:t.Me.BeginNum,EditGasDirection:t.Me.GasDirection,MeterAddress:t.Me.MeterAddress,MeterDate:t.Me.MeterDate.substr(0,10),Pid:t.Me.Pid,EditCalculateType:t.Me.CalculateType,CalculateValue:t.Me.CalculateValue,OldNo:t.Me.OldNo,OldOtherInfo:t.Me.OldOtherInfo,SortNum:t.Me.SortNum,Description:t.Me.Description}),r.render("select"),s.renderMeterFireTable(t.Me.Id,!0)}else l.appResult.loadErrorText(t)}).fail(function(e){console.log(e)})},editMeter:function(i){l.ajaxFun("get","/api/Meter/query/key?Data.Id="+i.Id+"&Method=key","",n).then(function(i){if(l.appResult.isSucceeded(i)){var i=i.Result;e("#lock-meterEditDetail-from").find("input[type=text],select,input[type=hidden],textarea").each(function(){e(this).removeAttr("disabled")}),e("#LAY-edit-address-search-submit").removeAttr("disabled"),e("#LAY-fire-add").removeAttr("disabled"),e("#LAY-edit-address-search-submit").attr("class","layui-btn"),e("#LAY-fire-add").attr("class","layui-btn "),layer.open({type:1,title:"修改表具信息",content:e("#lock-meterEdit-from"),maxmin:!0,area:["800px","500px"],btn:["确定","取消"],yes:function(a,o){var s=e("#LAY-biaoju-Edit-submit");r.on("submit(LAY-biaoju-Edit-submit)",function(e){var r=e.field;r.AddressId=void 0==d.AddressId?i.Me.AddressId:d.AddressId,r.MeterStatus=r.EditMeterStatus,r.MeterPayMode=r.EditMeterPayMode,r.StepFamilyMemberEndDate=r.EditStepFamilyMemberEndDate,r.GasDirection=r.EditGasDirection,r.CalculateType=""==r.EditCalculateType?0:r.EditCalculateType,r.PriceTypeId=r.EditPriceTypeId,delete r.Address,delete r.EditMeterStatus,delete r.EditMeterPayMode,delete r.EditGasDirection,delete r.EditCalculateType,delete r.EditPriceTypeId,console.info(r);var o=layui.consts.basePostData();o.Data=r,o.Data.Id=d.MeterId,o.Method="update";var s=JSON.stringify(o);console.info("update",s),l.ajaxFun("put","/api/Meter/update",s,n).then(function(e){l.appResult.isSucceeded(e)?(t.reload("LAY-meterTable"),layer.close(a),layer.msg("数据更新成功!",{icon:6})):l.appResult.loadErrorText(e)}).fail(function(e){console.log(e)})}),s.trigger("click")}}),d.meterId=i.Me.MeterId,console.info("res",i),r.val("lock-meterEditDetail-from",{Address:i.Address.Address,EditMeterStatus:i.Me.MeterStatus,EditMeterPayMode:i.Me.MeterPayMode,StepFamilyMembers:i.Me.StepFamilyMembers,EditStepFamilyMemberEndDate:i.Me.StepFamilyMemberEndDate.substr(0,10),EditPriceTypeId:i.Me.PriceTypeId,MeterFactoryId:i.Me.MeterFactoryId,MeterTypeId:i.Me.MeterTypeId,MeterSize:i.Me.MeterSize,MeterCode:i.Me.MeterCode,BeginNum:i.Me.BeginNum,EditGasDirection:i.Me.GasDirection,MeterAddress:i.Me.MeterAddress,MeterDate:i.Me.MeterDate.substr(0,10),Pid:i.Me.Pid,EditCalculateType:i.Me.CalculateType,CalculateValue:i.Me.CalculateValue,OldNo:i.Me.OldNo,OldOtherInfo:i.Me.OldOtherInfo,SortNum:i.Me.SortNum,Description:i.Me.Description}),r.render("select"),s.renderMeterFireTable(i.Me.Id)}else l.appResult.loadErrorText(i)}).fail(function(e){console.log(e)})},deleteMeter:function(e){layer.closeAll(),layer.load(0,{shade:!1});var r=layui.consts.basePostData();console.info(e.Me),r.Data={Id:e.Me.Id},r.Method="remove";var i=JSON.stringify(r);console.info(i),l.ajaxFun("delete","/api/Meter/remove",i,n).then(function(e){l.appResult.isSucceeded(e)?(t.reload("LAY-meterTable"),layer.msg("数据删除成功!",{icon:6})):l.appResult.loadErrorText(e)}).fail(function(e){console.log(e)})},addMeterFire:function(r){layer.closeAll();var i=layui.consts.basePostData();i.Data=r,i.Method="insert";var a=JSON.stringify(i);l.ajaxFun("post","/api/MeterFire/insert",a,n).then(function(r){l.appResult.isSucceeded(r)?(t.reload("LAY-MeterFireTable"),e("#lock-meterFireAdd-from").find("input[type=text],select,input[type=hidden],textarea").each(function(){e(this).val("")}),layer.msg("数据添加成功!",{icon:6})):l.appResult.loadErrorText(r)}).fail(function(e){console.log(e)})},deleteMeterFire:function(e){var r=layui.consts.basePostData();console.info(e),r.Data={Id:e.Id},r.Method="remove";var i=JSON.stringify(r);console.info(i),l.ajaxFun("delete","/api/MeterFire/remove",i,n).then(function(e){l.appResult.isSucceeded(e)?(t.reload("LAY-MeterFireTable"),layer.msg("数据删除成功!",{icon:6})):l.appResult.loadErrorText(e)}).fail(function(e){console.log(e)})},editMeterFire:function(i){layui.consts.basePostData();l.ajaxFun("get","/api/MeterFire/query/key?Data.Id="+i.Id+"&Method=key","",n).then(function(a){if(l.appResult.isSucceeded(a)){var a=a.Result;layer.open({type:1,title:"修改点火信息",content:e("#lock-meterFireAdd-from"),maxmin:!0,area:["800px","500px"],btn:["确定","取消"],yes:function(a,d){var o=e("#LAY-fire-submit");r.on("submit(LAY-fire-submit)",function(r){var a=r.field;if("全部"==a.FireResult)layer.msg("请选择点火状态",{icon:5});else{var d=layui.consts.basePostData();a={MeterId:i.MeterId,Id:i.Id,FireResult:a.NewFireResult,FireDate:a.NewFireDate,FireMembers:a.FireMembers,SortNum:a.FireSortNum,Description:a.FireDescription},delete a.NewFireDate,delete a.NewFireDate,delete a.FireSortNum,delete a.FireDescription,d.Data=a,d.Method="update";var o=JSON.stringify(d);console.info("data",o),l.ajaxFun("put","/api/MeterFire/update",o,n).then(function(r){l.appResult.isSucceeded(r)?(t.reload("LAY-MeterFireTable"),e("#LAY-fire-submit").find("input[type=text],select,input[type=hidden],textarea").each(function(){e(this).val("")}),layer.msg("数据更新成功!",{icon:6})):l.appResult.loadErrorText(r)}).fail(function(e){console.log(e)})}}),layer.close(a),o.trigger("click")}}),console.info(a),d.meterId=a.Me.MeterId,r.val("lock-meterFireAdd-from",{NewFireDate:a.Me.FireDate.substr(0,10),FireMembers:a.Me.FireMembers,NewFireResult:a.Me.FireResult,FireSortNum:a.Me.SortNum,FireDescription:a.Me.Description})}else l.appResult.loadErrorText(a)}).fail(function(e){console.log(e)})}},s={renderObjSelect:function(t){e("#Edit"+t.element).html(""),e("#Edit"+t.element).append("<option selected>全部</option>"),e("#"+t.element).html(""),e("#"+t.element).append("<option selected>全部</option>");var i;for(var a in t.items)i+="<option  &nbsp; value="+t.items[a].Id+">"+t.items[a].Name+"</option>";e("#Edit"+t.element).append(i),e("#"+t.element).append(i),r.render("select")},renderSelect:function(t){e("#Edit"+t.element).html(""),e("#Edit"+t.element).append("<option selected>全部</option>"),e("#"+t.element).html(""),e("#"+t.element).append("<option selected>全部</option>");var i;for(var a in t.items)i+="<option  &nbsp; value="+t.items[a].Value+">"+t.items[a].Text+"</option>";e("#Edit"+t.element).append(i),e("#"+t.element).append(i),r.render("select")},renderAddTable:function(){t.render({elem:"#LAY-MeterAddressTable",id:"LAY-MeterAddressTable",url:layui.setter.revenueUrl+"/api/Address/query/list",where:{Method:"list"},parseData:layui.setter.parseData,request:layui.setter.request,page:!0,cols:[[{type:"radio",fixed:"left"},{field:"Area_Id_VillageName",title:"小区",width:120,templet:function(e){return e.Area_Id_VillageName}},{field:"Area_Id_BuildingName",title:"楼栋",width:120,templet:function(e){return e.Area_Id_BuildingName}},{field:"Address",title:"地址",width:120,templet:function(e){return e.Me.Address}},{field:"UnitNo",title:"单元",width:60,templet:function(e){return e.Me.UnitNo}},{field:"FloorNo",title:"楼层",width:60,templet:function(e){return e.Me.FloorNo}},{field:"RoomNo",title:"房号",width:60,templet:function(e){return e.Me.RoomNo}},{field:"AddressStatusName",title:"状态",width:80,templet:function(e){return e.AddressStatusName}},{field:"AddressTypeName",title:"类型",width:80,templet:function(e){return e.AddressTypeName}}]],loading:!0,limit:10,text:"对不起，加载出现异常！"})},renderMeterTable:function(){t.render({elem:"#LAY-meterTable",id:"LAY-meterTable",url:layui.setter.revenueUrl+"/api/Meter/query/list",where:{Method:"list"},parseData:layui.setter.parseData,request:layui.setter.request,page:!0,cols:[[{field:"MeterCode",title:"表编号",templet:function(e){return e.Me.MeterCode}},{field:"MeterFactoryName",title:"表厂家",templet:function(e){return e.MeterFactoryName}},{field:"MeterTypeName",title:"表类型",templet:function(e){return e.MeterTypeName}},{field:"MeterSizeName",title:"表规格",templet:function(e){return e.MeterSizeName}},{field:"Address",title:"地址",templet:function(e){return e.Address.Address}},{field:"UnitNo",title:"单元号",templet:function(e){return e.Address.UnitNo}},{field:"FloorNo",title:"楼层",templet:function(e){return e.Address.FloorNo}},{field:"RoomNo",title:"房号",templet:function(e){return e.Address.RoomNo}},{field:"Area_Id_BuildingName",title:"楼栋",templet:function(e){return e.Area_Id_BuildingName}},{field:"Area_Id_VillageName",title:"小区",templet:function(e){return e.Area_Id_VillageName}},{title:"操作",fixed:"right",align:"center",width:200,toolbar:"#LAY-meterTable-barOperation"}]],loading:!0,limit:10,text:"对不起，加载出现异常！"})},renderMeterFireTable:function(e,r){r?(console.info("flag",r),t.render({elem:"#LAY-MeterFireTable",id:"LAY-MeterFireTable",url:layui.setter.revenueUrl+"/api/MeterFire/query/list?&Data.MeterId="+e+"&Method=list",where:{Method:"list"},parseData:layui.setter.parseData,request:layui.setter.request,page:!0,cols:[[{field:"FireResult",title:"点火状态",templet:function(e){return e.FireResultName}},{field:"FireDate",title:"点火时间",templet:function(e){return e.Me.FireDate}},{field:"FireMembers",title:"点火人",templet:function(e){return e.Me.FireMembers}},{field:"SortNum",title:"排序号",templet:function(e){return e.Me.SortNum}},{field:"Description",title:"备注",templet:function(e){return e.Me.Description}}]],loading:!0,limit:10,text:"对不起，加载出现异常！"})):t.render({elem:"#LAY-MeterFireTable",id:"LAY-MeterFireTable",url:layui.setter.revenueUrl+"/api/MeterFire/query/list?&Data.MeterId="+e+"&Method=list",where:{Method:"list"},parseData:layui.setter.parseData,request:layui.setter.request,page:!0,cols:[[{field:"FireResult",title:"点火状态",templet:function(e){return e.FireResultName}},{field:"FireDate",title:"点火时间",templet:function(e){return e.Me.FireDate}},{field:"FireMembers",title:"点火人",templet:function(e){return e.Me.FireMembers}},{field:"SortNum",title:"排序号",templet:function(e){return e.Me.SortNum}},{field:"Description",title:"备注",templet:function(e){return e.Me.Description}},{title:"操作",fixed:"right",align:"center",width:200,toolbar:"#LAY-fireTable-barOperation"}]],loading:!0,limit:10,text:"对不起，加载出现异常！"})},renderMeterDate:function(){i.render({elem:"#MeterDate"})},renderFireDate:function(){i.render({elem:"#FireDate"})},renderNewFireDate:function(){i.render({elem:"#NewFireDate"})},renderStepFamilyMemberEndDate:function(){i.render({elem:"#StepFamilyMemberEndDate"}),i.render({elem:"#EditStepFamilyMemberEndDate"})},init:function(){o.getMeterStatus(),o.getMeterPayMode(),o.getGasDirection(),o.getMeterCalculateType(),o.getPriceType(),o.getMeterFireResult("NewFireResult"),o.getMeterFireResult("FireResult"),s.renderAddTable(),s.renderMeterTable(),s.renderMeterDate(),s.renderFireDate(),s.renderNewFireDate(),s.renderStepFamilyMemberEndDate()}};a.on("tab(meterAdd-tab)",function(){console.info(this.getAttribute("lay-id"))}),e(".layui-btn.layuiadmin-btn-meterAdd").on("click",function(){e("#lock-meterAddDetail-from").find("input[type=text],select,input[type=hidden],textarea").each(function(){e(this).val(""),e(this).removeAttr("disabled"),e(this).removeClass("layui-disabled")}),e("#lock-fireDetail-from").find("input[type=text],select,input[type=hidden],textarea").each(function(){e(this).val(""),e(this).removeAttr("disabled"),e(this).removeClass("layui-disabled")}),e("#LAY-address-search-submit").removeAttr("disabled"),r.render("select"),layer.open({type:1,title:"添加表具",content:e("#lock-meterAdd-from"),maxmin:!0,area:["800px","500px"],btn:["确定","取消"],yes:function(t,i){var a=e("#LAY-biaoju-submit");r.on("submit(LAY-biaoju-submit)",function(e){var t=e.field;""==t.Address?layer.msg("请查询并选择表具所在地址",{icon:5}):l.ajaxFun("get","/api/Common/GetInsertGuid","",n).then(function(e){l.appResult.isSucceeded(e)?(t.Idd=e.Result,t.FireResult?l.ajaxFun("get","/api/Common/GetInsertGuid","",n).then(function(e){l.appResult.isSucceeded(e)?(t.AddressId=d.AddressId,t.SortNum=""==t.SortNum?0:t.SortNum,t.MeterFireInfo=[{MeterId:t.Idd,Idd:e.Result,FireResult:t.FireResult,FireDate:t.FireDate,FireMembers:t.FireMembers,SortNum:t.FireSortNum,Description:t.FireDescription}],delete t.Address,delete t.FireDate,delete t.FireMembers,delete t.FireResult,delete t.FireSortNum,delete t.FireDescription,t.CalculateType="全部"==t.CalculateType||""==t.CalculateType?"0":t.CalculateType,console.info(t),o.addMeter(t)):l.appResult.loadErrorText(res)}).fail(function(e){console.log(e)}):(t.AddressId=d.AddressId,t.SortNum=""==t.SortNum?0:t.SortNum,t.MeterFireInfo=[],delete t.Address,t.CalculateType="全部"==t.CalculateType||""==t.CalculateType?"1":t.CalculateType,console.info(t),o.addMeter(t))):l.appResult.loadErrorText(res)}).fail(function(e){console.log(e)})}),a.trigger("click")}})}),e(".layui-btn.layuiadmin-btn-meterFireAdd").on("click",function(){layer.open({type:1,title:"添加点火信息",content:e("#lock-meterFireAdd-from"),maxmin:!0,area:["800px","500px"],btn:["确定","取消"],yes:function(t,i){var a=e("#LAY-fire-submit");r.on("submit(LAY-fire-submit)",function(e){var t=e.field;l.ajaxFun("get","/api/Common/GetInsertGuid","",n).then(function(e){l.appResult.isSucceeded(e)?(t.Idd=e.Result,l.ajaxFun("get","/api/Common/GetInsertGuid","",n).then(function(e){l.appResult.isSucceeded(e)?(t.FireSortNum=""==t.FireSortNum?0:t.FireSortNum,t.MeterFireInfo={MeterId:d.MeterId,Idd:t.Idd,FireResult:t.NewFireResult,FireDate:t.NewFireDate,FireMembers:t.FireMembers,SortNum:t.FireSortNum,Description:t.FireDescription},console.info(t.MeterFireInfo),o.addMeterFire(t.MeterFireInfo)):l.appResult.loadErrorText(res)}).fail(function(e){console.log(e)})):l.appResult.loadErrorText(res)}).fail(function(e){console.log(e)})}),a.trigger("click")}})}),t.on("radio(LAY-MeterAddressTable)",function(e){var t=e.data;d.AddressId=t.Me.Id,d.Address=t.Me.Address,console.info(d)}),e(".layui-btn.LAY-address-search-submit").on("click",function(t){console.info("LAY-address-search-submit"),layer.open({type:1,title:"查询地址",content:e("#lock-address-from"),maxmin:!0,offset:"auto",zIndex:999999999,area:["1000px","550px"],btn:["确定","取消"],yes:function(e,t){console.info(d.Address),r.val("lock-meterAddDetail-from",{Address:d.Address}),r.val("lock-meterEditDetail-from",{Address:d.Address}),layer.close(e)}})}),e(".layui-btn.LAY-edit-address-search-submit").on("click",function(t){console.info("LAY-address-search-submit"),layer.open({type:1,title:"查询地址",content:e("#lock-address-from"),maxmin:!0,offset:"auto",zIndex:999999999,area:["1000px","550px"],btn:["确定","取消"],yes:function(e,t){console.info(d.Address),r.val("lock-meterAddDetail-from",{Address:d.Address}),r.val("lock-meterEditDetail-from",{Address:d.Address}),layer.close(e)}})}),t.on("tool(LAY-meterTable)",function(e){var t=e.data,r=e.event;e.tr;"detail"===r?o.detailMeter(t.Me):"del"===r?layer.confirm("真的删除行么",function(e){o.deleteMeter(t),layer.close(e)}):"edit"===r&&(console.info(t.Me),d.MeterId=t.Me.Id,o.editMeter(t.Me))}),t.on("tool(LAY-MeterFireTable)",function(e){var t=e.data,r=e.event;e.tr;"fireEdit"===r?(console.info("editMeterFire"),o.editMeterFire(t.Me)):"fireDel"===r&&(console.info("deleteMeterFire"),o.deleteMeterFire(t.Me))}),r.verify({notNull:function(e){if(console.info(e),console.info(""==e),console.info(null==e),console.info(void 0==e),""==e||null==e||void 0==e)return"地址不能为空"},notDefault:function(e){if(new RegExp("^全部$").test(e)||""==e||null==e||void 0==e)return"下拉框不能为默认值"}}),s.init()});
//# sourceMappingURL=../src/maps/xitongguanli/biaojuguanli.js.map
