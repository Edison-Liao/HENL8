{"version":3,"sources":["platform/roleauth.js"],"names":["layui","config","base","extend","index","use","$","layer","table","common","tree","ztree","jquery_ztree_excheck","on","this","siblings","length","css","find","click","console","log","admin","z_tree","init","treeData","el","render","renderTree","baseData","zTreeObj","treeSeting","check","enable","chkboxType","Y","N","nocheckInherit","data","simpleData","callback","onCheck","e","treeId","treeNode","event","jquery_ztree","treeObj","getZTreeObj","nodes","getNodes","expandNode","auth","server","getTreeData","getAccessOrganTreeData","getAccessRightTreeData","id","nodeData","editFalge","nodeArry","getCheckedNodes","idArry","currData","getArryNodeId","roleId","putRoleAccessRight","ajax","type","url","setter","baseUrl","dataType","headers","Accept","Content-Type","success","closeAll","IsSucceed","i","name","Title","children","Children","Result","TreeNodes","nodeData1","msg","icon","error","err","userflage","nocheck","Flag","checkNode","checkUserNode","nodeData2","renderAccessOrganTree","renderAccessOrganTreeUser","Name","Functions","Permissions","renderAccessRightTree","getRoleAccessOrganNode","flage","urlID","setTreeNodeCheck","Errors","Message","getRoleAccessRightNode","load","getRoleUserRightNode","dataBean","consts","basePostData","Data","str1","JSON","stringify","getNodedata","elem","target","item","Id","disabledBtton","openDeleteConfirm","isDisableButton","dataNode","organTree","checkAllNodes","node","getNodeByParam","checked","updateNode","ArrayNode","arr","push"],"mappings":"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","file":"../../../platform/roleauth.js","sourcesContent":["layui\r\n  .config({\r\n    base: \"../../../layuiadmin/\"\r\n  })\r\n  .extend({\r\n    index: \"lib/index\" //主入口模块\r\n  })\r\n  .use(\r\n    [\"index\", \"layer\", \"tree\", \"common\", \"consts\", \"jquery_ztree_excheck\"],\r\n    function() {\r\n      var $ = layui.$,\r\n        table = layui.table,\r\n        layer = layui.layer,\r\n        tree = layui.tree,\r\n        common = layui.common,\r\n        ztree = layui.ztree,\r\n        jquery_ztree = layui.jquery_ztree_excheck;\r\n      $(\"body\").on(\"mousedown\", \".layui-tree a\", function() {\r\n        if (!$(this).siblings(\"ul\").length) {\r\n          $(\".layui-tree a cite\").css(\"color\", \"#333\");\r\n          $(this)\r\n            .find(\"cite\")\r\n            .css(\"color\", \"red\");\r\n        }\r\n      });\r\n      $(\"#formTitle\").click(function() {\r\n        console.log(1);\r\n        var admin = layui.admin;\r\n        // common\r\n        //   .ajaxFun(\"get\", \"/api/organ/treeview\", null, {\r\n        //     loading: true\r\n        //   })\r\n        //   .done(function(res) {\r\n        //     if (res.IsSucceed) {\r\n        //       console.log(res.Result, \"成功\");\r\n        //     } else {\r\n        //       common.appResult.loadErrorText(res);\r\n        //     }\r\n        //   })\r\n        //   .fail(function(err) {\r\n        //     console.log(err, \"错误处理\");\r\n        //   });\r\n        //auth.render.disabledBtton();\r\n      });\r\n      //z-tree\r\n      var z_tree = {\r\n        init: function(treeData, el) {\r\n          this.render.renderTree(treeData, el);\r\n        },\r\n        baseData: {\r\n          zTreeObj: {}\r\n        },\r\n        treeSeting: {\r\n          check: {\r\n            enable: true,\r\n            chkboxType: { Y: \"s\", N: \"ps\" },\r\n            nocheckInherit: false\r\n          },\r\n          data: {\r\n            simpleData: {\r\n              enable: true\r\n            }\r\n          },\r\n          callback: {\r\n            onCheck: function(e, treeId, treeNode) {\r\n              console.log(treeNode, \"callback\");\r\n            }\r\n          }\r\n        },\r\n        event: {},\r\n        render: {\r\n          renderTree: function(treeData, el) {\r\n            z_tree.baseData.zTreeObj = layui.jquery_ztree.init(\r\n              $(\"#\" + el),\r\n              z_tree.treeSeting,\r\n              treeData\r\n            );\r\n            var treeObj = layui.jquery_ztree.getZTreeObj(el);\r\n            var nodes = treeObj.getNodes();\r\n            if (nodes.length > 0) {\r\n              //自动展开第一项\r\n              treeObj.expandNode(nodes[0], true, false, true);\r\n            }\r\n          }\r\n        }\r\n      };\r\n\r\n      //auth\r\n      var auth = {\r\n        init: function() {\r\n          this.server.getTreeData();\r\n          this.server.getAccessOrganTreeData();\r\n          this.server.getAccessRightTreeData();\r\n          this.event();\r\n        },\r\n        baseData: {\r\n          treeNode: {},\r\n          id: \"\",\r\n          nodeData: {},\r\n          editFalge: false\r\n        },\r\n        event: function() {\r\n          $(\"#accessOrganSub\").click(function() {\r\n            var nodeArry = layui.jquery_ztree\r\n              .getZTreeObj(\"treeOrgan\")\r\n              .getCheckedNodes(true);\r\n            var idArry = auth.currData.getArryNodeId(nodeArry, \"Id\");\r\n            var roleId = auth.baseData.id;\r\n            auth.server.putRoleAccessRight(\"Organ\", idArry, roleId);\r\n          });\r\n          $(\"#accessRightSub\").click(function() {\r\n            var nodeArry = layui.jquery_ztree\r\n              .getZTreeObj(\"treeAccessRight\")\r\n              .getCheckedNodes(true);\r\n            var idArry = auth.currData.getArryNodeId(nodeArry, \"Id\");\r\n            var roleId = auth.baseData.id;\r\n            auth.server.putRoleAccessRight(\"Right\", idArry, roleId);\r\n          });\r\n          $(\"#accessUserSub\").click(function() {\r\n            var nodeArry = layui.jquery_ztree\r\n              .getZTreeObj(\"treeOrganUser\")\r\n              .getCheckedNodes(true);\r\n            var idArry = auth.currData.getArryNodeId(nodeArry, \"Id\");\r\n            var roleId = auth.baseData.id;\r\n\r\n            auth.server.putRoleAccessRight(\"User\", idArry, roleId);\r\n          });\r\n        },\r\n        server: {\r\n          getTreeData: function() {\r\n            $.ajax({\r\n              type: \"get\",\r\n              url: layui.setter.baseUrl + \"/api/Role/treeview\",\r\n              dataType: \"json\",\r\n              headers: {\r\n                Accept: \"application/json\",\r\n                \"Content-Type\": \"application/json\"\r\n              },\r\n              success: function(data) {\r\n                layer.closeAll(\"loading\");\r\n                if (data.IsSucceed) {\r\n                  console.log(data.Result.TreeNodes);\r\n                  var nodeData = data.Result.TreeNodes;\r\n                  function currData(data) {\r\n                    if (data.length > 0) {\r\n                      for (var i = 0; i < data.length; i++) {\r\n                        data[i].name = data[i].Title;\r\n                        data[i].children = data[i].Children;\r\n                        if (data[i].Children.length > 0) {\r\n                          currData(data[i].Children);\r\n                        }\r\n                      }\r\n                    }\r\n                    return data;\r\n                  }\r\n                  var nodeData1 = currData(nodeData);\r\n                  //z-tree树形结构渲染 数据,domID\r\n                  auth.render.renderTree(nodeData1, \"tree_accessRight\");\r\n                } else {\r\n                  layer.msg(\"获取角色数据失败!\" + data, { icon: 5 });\r\n                }\r\n              },\r\n              error: function(err) {\r\n                layer.closeAll();\r\n                layer.msg(\"数据操作失败\", { icon: 5 });\r\n              }\r\n            });\r\n          },\r\n          getAccessOrganTreeData: function() {\r\n            $.ajax({\r\n              type: \"get\",\r\n              url: layui.setter.baseUrl + \"/api/organ/treeview\",\r\n              dataType: \"json\",\r\n              headers: {\r\n                Accept: \"application/json\",\r\n                \"Content-Type\": \"application/json\"\r\n              },\r\n              success: function(data) {\r\n                layer.closeAll(\"loading\");\r\n                if (data.IsSucceed) {\r\n                  console.log(data.Result.TreeNodes);\r\n                  var nodeData = data.Result.TreeNodes;\r\n\r\n                  function currData(data, userflage) {\r\n                    if (data.length > 0) {\r\n                      for (var i = 0; i < data.length; i++) {\r\n                        data[i].name = data[i].Title;\r\n                        data[i].children = data[i].Children;\r\n                        if (userflage) {\r\n                          var nocheck = data[i].Flag === \"staff\" ? false : true;\r\n                          data[i].nocheck = nocheck;\r\n                          if (data[i].Flag === \"staff\") {\r\n                            delete data[i].Children;\r\n                            delete data[i].children;\r\n                          }\r\n                        }\r\n                        if (data[i].Children && data[i].Children.length > 0) {\r\n                          currData(data[i].Children, userflage);\r\n                        }\r\n                      }\r\n                    }\r\n                    return data;\r\n                  }\r\n                  //深拷贝数据\r\n                  var checkNode = $.extend(true, [], nodeData);\r\n                  var checkUserNode = $.extend(true, [], nodeData);\r\n\r\n                  var nodeData1 = currData(checkNode, false);\r\n                  var nodeData2 = currData(checkUserNode, true);\r\n\r\n                  auth.render.renderAccessOrganTree(nodeData1);\r\n                  auth.render.renderAccessOrganTreeUser(nodeData2);\r\n                } else {\r\n                  layer.msg(\"获取数据失败\" + data, { icon: 5 });\r\n                }\r\n              },\r\n              error: function(err) {\r\n                layer.closeAll();\r\n                layer.msg(\"数据操作失败\", { icon: 5 });\r\n              }\r\n            });\r\n          },\r\n          getAccessRightTreeData: function() {\r\n            $.ajax({\r\n              type: \"get\",\r\n              url: layui.setter.baseUrl + \"/api/Module/deep/permission\",\r\n              dataType: \"json\",\r\n              headers: {\r\n                Accept: \"application/json\",\r\n                \"Content-Type\": \"application/json\"\r\n              },\r\n              success: function(data) {\r\n                layer.closeAll(\"loading\");\r\n                if (data.IsSucceed) {\r\n                  var nodeData = data.Result;\r\n                  function currData(data) {\r\n                    if (data.length > 0) {\r\n                      for (var i = 0; i < data.length; i++) {\r\n                        data[i].name = data[i].Name;\r\n                        if (data[i].Functions && data[i].Functions.length > 0) {\r\n                          data[i].children = data[i].Functions;\r\n                        }\r\n                        if (\r\n                          data[i].Permissions &&\r\n                          data[i].Permissions.length > 0\r\n                        ) {\r\n                          data[i].children = data[i].Permissions;\r\n                        }\r\n                        if (data[i].children && data[i].children.length > 0) {\r\n                          currData(data[i].children);\r\n                        }\r\n                      }\r\n                    }\r\n                    return data;\r\n                  }\r\n                  var nodeData1 = currData(nodeData);\r\n\r\n                  auth.render.renderAccessRightTree(nodeData1);\r\n                } else {\r\n                  layer.msg(\"获取数据失败\" + data, { icon: 5 });\r\n                }\r\n              },\r\n              error: function(err) {\r\n                layer.closeAll();\r\n                layer.msg(\"数据操作失败\", { icon: 5 });\r\n              }\r\n            });\r\n          },\r\n          getRoleAccessOrganNode: function(flage, id) {\r\n            if (flage === \"roleInfo\") {\r\n              urlID = \"/api/Role/accessOrgan/\" + id;\r\n            } else {\r\n              return;\r\n            }\r\n            $.ajax({\r\n              type: \"get\",\r\n              url: layui.setter.baseUrl + \"/api/Role/accessOrgan/\" + id,\r\n              dataType: \"json\",\r\n              headers: {\r\n                Accept: \"application/json\",\r\n                \"Content-Type\": \"application/json\"\r\n              },\r\n              success: function(data) {\r\n                console.log(data, \"accessOrgan\");\r\n                layer.closeAll();\r\n                if (data.IsSucceed) {\r\n                  auth.render.setTreeNodeCheck(data.Result, \"treeOrgan\");\r\n                } else {\r\n                  layer.msg(\"获取节点数据失败! \" + data.Errors[0].Message, {\r\n                    icon: 5\r\n                  });\r\n                }\r\n              },\r\n              error: function(err) {\r\n                layer.closeAll();\r\n                layer.msg(\"数据操作失败\", { icon: 5 });\r\n              }\r\n            });\r\n          },\r\n          getRoleAccessRightNode: function(flage, id) {\r\n            var urlID = \"\";\r\n            if (flage === \"roleInfo\") {\r\n              urlID = \"/api/Role/accessRight/\" + id;\r\n            } else {\r\n              return;\r\n            }\r\n            layer.load(2);\r\n            $.ajax({\r\n              type: \"get\",\r\n              url: layui.setter.baseUrl + urlID,\r\n              dataType: \"json\",\r\n              headers: {\r\n                Accept: \"application/json\",\r\n                \"Content-Type\": \"application/json\"\r\n              },\r\n              success: function(data) {\r\n                console.log(data, \"accessRight\");\r\n                layer.closeAll();\r\n                if (data.IsSucceed) {\r\n                  auth.render.setTreeNodeCheck(data.Result, \"treeAccessRight\");\r\n                } else {\r\n                  layer.msg(\r\n                    \"获取功能访问权限数据失败! \" + data.Errors[0].Message,\r\n                    {\r\n                      icon: 5\r\n                    }\r\n                  );\r\n                }\r\n              },\r\n              error: function(err) {\r\n                layer.closeAll();\r\n                layer.msg(\"数据操作失败\", { icon: 5 });\r\n              }\r\n            });\r\n          },\r\n          getRoleUserRightNode: function(flage, id) {\r\n            if (flage === \"roleInfo\") {\r\n              urlID = \"/api/Role/\" + id + \"/with/user\";\r\n            } else {\r\n              return;\r\n            }\r\n            $.ajax({\r\n              type: \"get\",\r\n              url: layui.setter.baseUrl + urlID,\r\n              dataType: \"json\",\r\n              headers: {\r\n                Accept: \"application/json\",\r\n                \"Content-Type\": \"application/json\"\r\n              },\r\n              success: function(data) {\r\n                layer.closeAll();\r\n                if (data.IsSucceed) {\r\n                  auth.render.setTreeNodeCheck(data.Result, \"treeOrganUser\");\r\n                } else {\r\n                  layer.msg(\"获取节点数据失败! \" + data.Errors[0].Message, {\r\n                    icon: 5\r\n                  });\r\n                }\r\n              },\r\n              error: function(err) {\r\n                layer.closeAll();\r\n                layer.msg(\"数据操作失败\", { icon: 5 });\r\n              }\r\n            });\r\n          },\r\n          putRoleAccessRight: function(flage, data, roleId) {\r\n            var urlID = \"\";\r\n            if (flage === \"Organ\") {\r\n              urlID = \"/api/Role/accessOrgan/\" + roleId;\r\n            } else if (flage === \"Right\") {\r\n              urlID = \"/api/Role/accessRight/\" + roleId;\r\n            } else if (flage === \"User\") {\r\n              urlID = \"/api/Role/\" + roleId + \"/with/user\";\r\n            } else {\r\n              return layer.msg(\"出错啦\");\r\n            }\r\n            var dataBean = layui.consts.basePostData();\r\n            dataBean.Data = data;\r\n            var str1 = JSON.stringify(dataBean);\r\n            layer.load();\r\n            $.ajax({\r\n              type: \"put\",\r\n              url: layui.setter.baseUrl + urlID,\r\n              dataType: \"json\",\r\n              data: str1,\r\n              headers: {\r\n                Accept: \"application/json\",\r\n                \"Content-Type\": \"application/json\"\r\n              },\r\n              success: function(data) {\r\n                layer.closeAll();\r\n                if (data.IsSucceed) {\r\n                  console.log(data.Result, \"当前角色点\");\r\n                  layer.msg(\"更新权限成功!\", { icon: 6 });\r\n                } else {\r\n                  layer.msg(\"更新权限数据失败! \" + data.Errors[0].Message, {\r\n                    icon: 5\r\n                  });\r\n                }\r\n              },\r\n              error: function(err) {\r\n                layer.closeAll();\r\n                layer.msg(\"数据操作失败\", { icon: 5 });\r\n              }\r\n            });\r\n          },\r\n          getNodedata: function(flage, id) {\r\n            var urlID = \"\";\r\n            if (flage === \"roleCatalog\") {\r\n              urlID = \"/api/Role/\" + id;\r\n            } else if (flage === \"roleInfo\") {\r\n              urlID = \"/api/Role/\" + id;\r\n            } else {\r\n              return;\r\n            }\r\n\r\n            $.ajax({\r\n              type: \"get\",\r\n              url: layui.setter.baseUrl + urlID,\r\n              dataType: \"json\",\r\n              headers: {\r\n                Accept: \"application/json\",\r\n                \"Content-Type\": \"application/json\"\r\n              },\r\n              success: function(data) {\r\n                layer.closeAll();\r\n                console.log(data);\r\n                if (data.IsSucceed) {\r\n                  auth.baseData.nodeData = data.Result;\r\n                  var dataNode = data.Result;\r\n                } else {\r\n                  layer.msg(\"获取节点数据失败! \" + data.Errors[0].Message, {\r\n                    icon: 5\r\n                  });\r\n                }\r\n              },\r\n              error: function(err) {\r\n                layer.closeAll();\r\n                layer.msg(\"数据操作失败\", { icon: 5 });\r\n              }\r\n            });\r\n          }\r\n        },\r\n        render: {\r\n          renderTree: function(data) {\r\n            //树形渲染\r\n            layui.tree({\r\n              elem: \"#treeRole\", //指定元素\r\n              target: \"_blank\", //是否新选项卡打开（比如节点返回href才有效）\r\n              click: function(item) {\r\n                //点击节点回调\r\n                auth.baseData.treeNode = item;\r\n                auth.baseData.id = item.Id;\r\n                auth.baseData.editFalge = true;\r\n                //auth.server.getNodedata(item.Flag, item.Id);\r\n                auth.server.getRoleAccessOrganNode(item.Flag, item.Id);\r\n                auth.server.getRoleAccessRightNode(item.Flag, item.Id);\r\n                auth.server.getRoleUserRightNode(item.Flag, item.Id);\r\n                auth.render.disabledBtton(item.Flag);\r\n              },\r\n              nodes: data\r\n            });\r\n          },\r\n          renderAccessOrganTree: function(data) {\r\n            z_tree.init(data, \"treeOrgan\");\r\n          },\r\n          renderAccessRightTree: function(data) {\r\n            z_tree.init(data, \"treeAccessRight\");\r\n          },\r\n          renderAccessOrganTreeUser: function(data) {\r\n            z_tree.init(data, \"treeOrganUser\");\r\n          },\r\n          openDeleteConfirm: function(data) {\r\n            console.log(data, \"模态框\");\r\n          },\r\n          disabledBtton: function(data) {\r\n            //\r\n            common.isDisableButton(\".layui-btn\", false);\r\n          },\r\n          setTreeNodeCheck: function(dataNode, el) {\r\n            //获取树的实例\r\n            var organTree = layui.jquery_ztree.getZTreeObj(el);\r\n            //全部取消之前的选定\r\n            console.log(dataNode, el, \"树形结构check填充参数\");\r\n            if (organTree == null) {\r\n              return;\r\n            }\r\n            organTree.checkAllNodes(false);\r\n            var nodes = organTree.getNodes();\r\n            if (nodes.length > 0 && dataNode.length > 0) {\r\n              //挨个赋值选定\r\n              for (var i = 0; i < dataNode.length; i++) {\r\n                var node = organTree.getNodeByParam(\"Id\", dataNode[i], null);\r\n                organTree.expandNode(node, true, true, true, false);\r\n                node.checked = true;\r\n                organTree.updateNode(node, false);\r\n              }\r\n            }\r\n          }\r\n        },\r\n        currData: {\r\n          getArryNodeId: function(ArrayNode, item) {\r\n            var arr = [];\r\n            for (var i = 0; i < ArrayNode.length; i++) {\r\n              var id = ArrayNode[i][item];\r\n              arr.push(id);\r\n            }\r\n            return arr;\r\n          }\r\n        }\r\n      };\r\n      auth.init();\r\n    }\r\n  );\r\n"]}