{"version":3,"sources":["platform/roleauth.js"],"names":["layui","config","base","extend","index","use","$","layer","table","common","tree","ztree","jquery_ztree_excheck","on","this","siblings","length","css","find","click","console","log","admin","z_tree","init","treeData","el","render","renderTree","baseData","zTreeObj","treeSeting","check","enable","chkboxType","Y","N","nocheckInherit","data","simpleData","callback","onCheck","e","treeId","treeNode","event","jquery_ztree","treeObj","getZTreeObj","nodes","getNodes","expandNode","auth","server","getTreeData","getAccessOrganTreeData","getAccessRightTreeData","id","nodeData","editFalge","nodeArry","getCheckedNodes","idArry","currData","getArryNodeId","roleId","putRoleAccessRight","ajaxFun","then","appResult","isSucceeded","i","name","Title","children","Children","Result","TreeNodes","nodeData1","loadErrorText","fail","err","userflage","nocheck","Flag","checkNode","checkUserNode","nodeData2","renderAccessOrganTree","renderAccessOrganTreeUser","Name","Functions","Permissions","renderAccessRightTree","getRoleAccessOrganNode","flage","urlID","setTreeNodeCheck","getRoleAccessRightNode","msg","Errors","Message","icon","getRoleUserRightNode","dataBean","consts","basePostData","Data","str1","JSON","stringify","getNodedata","elem","target","item","Id","disabledBtton","openDeleteConfirm","isDisableButton","dataNode","organTree","checkAllNodes","node","getNodeByParam","checked","updateNode","ArrayNode","arr","push"],"mappings":"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","file":"../../../platform/roleauth.js","sourcesContent":["layui\r\n  .config({\r\n    base: \"../../../layuiadmin/\"\r\n  })\r\n  .extend({\r\n    index: \"lib/index\" //主入口模块\r\n  })\r\n  .use(\r\n    [\"index\", \"layer\", \"tree\", \"common\", \"consts\", \"jquery_ztree_excheck\"],\r\n    function() {\r\n      var $ = layui.$,\r\n        table = layui.table,\r\n        layer = layui.layer,\r\n        tree = layui.tree,\r\n        common = layui.common,\r\n        ztree = layui.ztree,\r\n        jquery_ztree = layui.jquery_ztree_excheck;\r\n      $(\"body\").on(\"mousedown\", \".layui-tree a\", function() {\r\n        if (!$(this).siblings(\"ul\").length) {\r\n          $(\".layui-tree a cite\").css(\"color\", \"#333\");\r\n          $(this)\r\n            .find(\"cite\")\r\n            .css(\"color\", \"red\");\r\n        }\r\n      });\r\n      $(\"#formTitle\").click(function() {\r\n        console.log(1);\r\n        var admin = layui.admin;\r\n        // common\r\n        //   .ajaxFun(\"get\", \"/api/organ/treeview\", null, {\r\n        //     loading: true\r\n        //   })\r\n        //   .done(function(res) {\r\n        //     if (res.IsSucceed) {\r\n        //       console.log(res.Result, \"成功\");\r\n        //     } else {\r\n        //       common.appResult.loadErrorText(res);\r\n        //     }\r\n        //   })\r\n        //   .fail(function(err) {\r\n        //     console.log(err, \"错误处理\");\r\n        //   });\r\n        //auth.render.disabledBtton();\r\n      });\r\n      //z-tree\r\n      var z_tree = {\r\n        init: function(treeData, el) {\r\n          this.render.renderTree(treeData, el);\r\n        },\r\n        baseData: {\r\n          zTreeObj: {}\r\n        },\r\n        treeSeting: {\r\n          check: {\r\n            enable: true,\r\n            chkboxType: { Y: \"s\", N: \"ps\" },\r\n            nocheckInherit: false\r\n          },\r\n          data: {\r\n            simpleData: {\r\n              enable: true\r\n            }\r\n          },\r\n          callback: {\r\n            onCheck: function(e, treeId, treeNode) {\r\n              console.log(treeNode, \"callback\");\r\n            }\r\n          }\r\n        },\r\n        event: {},\r\n        render: {\r\n          renderTree: function(treeData, el) {\r\n            z_tree.baseData.zTreeObj = layui.jquery_ztree.init(\r\n              $(\"#\" + el),\r\n              z_tree.treeSeting,\r\n              treeData\r\n            );\r\n            var treeObj = layui.jquery_ztree.getZTreeObj(el);\r\n            var nodes = treeObj.getNodes();\r\n            if (nodes.length > 0) {\r\n              //自动展开第一项\r\n              treeObj.expandNode(nodes[0], true, false, true);\r\n            }\r\n          }\r\n        }\r\n      };\r\n\r\n      //auth\r\n      var auth = {\r\n        init: function() {\r\n          this.server.getTreeData();\r\n          this.server.getAccessOrganTreeData();\r\n          this.server.getAccessRightTreeData();\r\n          this.event();\r\n        },\r\n        baseData: {\r\n          treeNode: {},\r\n          id: \"\",\r\n          nodeData: {},\r\n          editFalge: false\r\n        },\r\n        event: function() {\r\n          $(\"#accessOrganSub\").click(function() {\r\n            var nodeArry = layui.jquery_ztree\r\n              .getZTreeObj(\"treeOrgan\")\r\n              .getCheckedNodes(true);\r\n            var idArry = auth.currData.getArryNodeId(nodeArry, \"Id\");\r\n            var roleId = auth.baseData.id;\r\n            auth.server.putRoleAccessRight(\"Organ\", idArry, roleId);\r\n          });\r\n          $(\"#accessRightSub\").click(function() {\r\n            var nodeArry = layui.jquery_ztree\r\n              .getZTreeObj(\"treeAccessRight\")\r\n              .getCheckedNodes(true);\r\n            var idArry = auth.currData.getArryNodeId(nodeArry, \"Id\");\r\n            var roleId = auth.baseData.id;\r\n            auth.server.putRoleAccessRight(\"Right\", idArry, roleId);\r\n          });\r\n          $(\"#accessUserSub\").click(function() {\r\n            var nodeArry = layui.jquery_ztree\r\n              .getZTreeObj(\"treeOrganUser\")\r\n              .getCheckedNodes(true);\r\n            var idArry = auth.currData.getArryNodeId(nodeArry, \"Id\");\r\n            var roleId = auth.baseData.id;\r\n\r\n            auth.server.putRoleAccessRight(\"User\", idArry, roleId);\r\n          });\r\n        },\r\n        server: {\r\n          getTreeData: function() {\r\n            common\r\n              .ajaxFun(\"get\", \"/api/Role/treeview\")\r\n              .then(function(data) {\r\n                if (common.appResult.isSucceeded(data)) {\r\n                  //渲染树\r\n                  var nodeData = data.Result.TreeNodes;\r\n                  function currData(data) {\r\n                    if (data.length > 0) {\r\n                      for (var i = 0; i < data.length; i++) {\r\n                        data[i].name = data[i].Title;\r\n                        data[i].children = data[i].Children;\r\n                        if (data[i].Children.length > 0) {\r\n                          currData(data[i].Children);\r\n                        }\r\n                      }\r\n                    }\r\n                    return data;\r\n                  }\r\n                  var nodeData1 = currData(nodeData);\r\n                  //z-tree树形结构渲染 数据,domID\r\n                  auth.render.renderTree(nodeData1, \"tree_accessRight\");\r\n                } else {\r\n                  common.appResult.loadErrorText(data);\r\n                }\r\n              })\r\n              .fail(err => {\r\n                console.log(err);\r\n              });\r\n          },\r\n          getAccessOrganTreeData: function() {\r\n            common\r\n              .ajaxFun(\"get\", \"/api/organ/treeview\")\r\n              .then(function(data) {\r\n                if (common.appResult.isSucceeded(data)) {\r\n                  //渲染树\r\n\r\n                  var nodeData = data.Result.TreeNodes;\r\n\r\n                  function currData(data, userflage) {\r\n                    if (data.length > 0) {\r\n                      for (var i = 0; i < data.length; i++) {\r\n                        data[i].name = data[i].Title;\r\n                        data[i].children = data[i].Children;\r\n                        if (userflage) {\r\n                          var nocheck = data[i].Flag === \"staff\" ? false : true;\r\n                          data[i].nocheck = nocheck;\r\n                          if (data[i].Flag === \"staff\") {\r\n                            delete data[i].Children;\r\n                            delete data[i].children;\r\n                          }\r\n                        }\r\n                        if (data[i].Children && data[i].Children.length > 0) {\r\n                          currData(data[i].Children, userflage);\r\n                        }\r\n                      }\r\n                    }\r\n                    return data;\r\n                  }\r\n                  //深拷贝数据\r\n                  var checkNode = $.extend(true, [], nodeData);\r\n                  var checkUserNode = $.extend(true, [], nodeData);\r\n\r\n                  var nodeData1 = currData(checkNode, false);\r\n                  var nodeData2 = currData(checkUserNode, true);\r\n\r\n                  auth.render.renderAccessOrganTree(nodeData1);\r\n                  auth.render.renderAccessOrganTreeUser(nodeData2);\r\n                } else {\r\n                  common.appResult.loadErrorText(data);\r\n                }\r\n              })\r\n              .fail(err => {\r\n                console.log(err);\r\n              });\r\n          },\r\n          getAccessRightTreeData: function() {\r\n            common\r\n              .ajaxFun(\"get\", \"/api/Module/deep/permission\")\r\n              .then(function(data) {\r\n                if (common.appResult.isSucceeded(data)) {\r\n                  var nodeData = data.Result;\r\n                  function currData(data) {\r\n                    if (data.length > 0) {\r\n                      for (var i = 0; i < data.length; i++) {\r\n                        data[i].name = data[i].Name;\r\n                        if (data[i].Functions && data[i].Functions.length > 0) {\r\n                          data[i].children = data[i].Functions;\r\n                        }\r\n                        if (\r\n                          data[i].Permissions &&\r\n                          data[i].Permissions.length > 0\r\n                        ) {\r\n                          data[i].children = data[i].Permissions;\r\n                        }\r\n                        if (data[i].children && data[i].children.length > 0) {\r\n                          currData(data[i].children);\r\n                        }\r\n                      }\r\n                    }\r\n                    return data;\r\n                  }\r\n                  var nodeData1 = currData(nodeData);\r\n\r\n                  auth.render.renderAccessRightTree(nodeData1);\r\n                } else {\r\n                  common.appResult.loadErrorText(data);\r\n                }\r\n              })\r\n              .fail(err => {\r\n                console.log(err);\r\n              });\r\n          },\r\n          getRoleAccessOrganNode: function(flage, id) {\r\n            if (flage === \"roleInfo\") {\r\n              urlID = \"/api/Role/accessOrgan/\" + id;\r\n            } else {\r\n              return;\r\n            }\r\n            //获取数据访问授权\r\n            common\r\n              .ajaxFun(\"get\", \"/api/Role/accessOrgan/\" + id)\r\n              .then(function(data) {\r\n                if (common.appResult.isSucceeded(data)) {\r\n                  auth.render.setTreeNodeCheck(data.Result, \"treeOrgan\");\r\n                } else {\r\n                  common.appResult.loadErrorText(data);\r\n                }\r\n              })\r\n              .fail(err => {\r\n                console.log(err);\r\n              });\r\n          },\r\n          getRoleAccessRightNode: function(flage, id) {\r\n            var urlID = \"\";\r\n            if (flage === \"roleInfo\") {\r\n              urlID = \"/api/Role/accessRight/\" + id;\r\n            } else {\r\n              return;\r\n            }\r\n            //获取功能访问授权\r\n            common\r\n              .ajaxFun(\"get\", \"/api/Role/accessRight/\" + id)\r\n              .then(function(data) {\r\n                if (common.appResult.isSucceeded(data)) {\r\n                  auth.render.setTreeNodeCheck(data.Result, \"treeAccessRight\");\r\n                } else {\r\n                  layer.msg(\r\n                    \"获取功能访问权限数据失败! \" + data.Errors[0].Message,\r\n                    {\r\n                      icon: 5\r\n                    }\r\n                  );\r\n                }\r\n              })\r\n              .fail(err => {\r\n                console.log(err);\r\n              });\r\n          },\r\n          getRoleUserRightNode: function(flage, id) {\r\n            if (flage === \"roleInfo\") {\r\n              urlID = \"/api/Role/\" + id + \"/with/user\";\r\n            } else {\r\n              return;\r\n            }\r\n            //获取角色用户特定关系\r\n            common\r\n              .ajaxFun(\"get\", urlID)\r\n              .then(function(data) {\r\n                if (common.appResult.isSucceeded(data)) {\r\n                  auth.render.setTreeNodeCheck(data.Result, \"treeOrganUser\");\r\n                } else {\r\n                  layer.msg(\"获取节点数据失败! \" + data.Errors[0].Message, {\r\n                    icon: 5\r\n                  });\r\n                }\r\n              })\r\n              .fail(err => {\r\n                console.log(err);\r\n              });\r\n          },\r\n          putRoleAccessRight: function(flage, data, roleId) {\r\n            var urlID = \"\";\r\n            if (flage === \"Organ\") {\r\n              urlID = \"/api/Role/accessOrgan/\" + roleId;\r\n            } else if (flage === \"Right\") {\r\n              urlID = \"/api/Role/accessRight/\" + roleId;\r\n            } else if (flage === \"User\") {\r\n              urlID = \"/api/Role/\" + roleId + \"/with/user\";\r\n            } else {\r\n              return layer.msg(\"出错啦\");\r\n            }\r\n            var dataBean = layui.consts.basePostData();\r\n            dataBean.Data = data;\r\n            var str1 = JSON.stringify(dataBean);\r\n\r\n            common\r\n              .ajaxFun(\"get\", urlID, str1)\r\n              .then(function(data) {\r\n                if (common.appResult.isSucceeded(data)) {\r\n                  layer.msg(\"更新权限成功!\", { icon: 6 });\r\n                } else {\r\n                  layer.msg(\"更新权限数据失败! \" + data.Errors[0].Message, {\r\n                    icon: 5\r\n                  });\r\n                }\r\n              })\r\n              .fail(err => {\r\n                console.log(err);\r\n              });\r\n          },\r\n          getNodedata: function(flage, id) {\r\n            var urlID = \"\";\r\n            if (flage === \"roleCatalog\") {\r\n              urlID = \"/api/Role/\" + id;\r\n            } else if (flage === \"roleInfo\") {\r\n              urlID = \"/api/Role/\" + id;\r\n            } else {\r\n              return;\r\n            }\r\n            common\r\n              .ajaxFun(\"get\", urlID)\r\n              .then(function(data) {\r\n                if (common.appResult.isSucceeded(data)) {\r\n                  auth.baseData.nodeData = data.Result;\r\n                  var dataNode = data.Result;\r\n                } else {\r\n                  layer.msg(\"获取节点数据失败! \" + data.Errors[0].Message, {\r\n                    icon: 5\r\n                  });\r\n                }\r\n              })\r\n              .fail(err => {\r\n                console.log(err);\r\n              });\r\n          }\r\n        },\r\n        render: {\r\n          renderTree: function(data) {\r\n            //树形渲染\r\n            layui.tree({\r\n              elem: \"#treeRole\", //指定元素\r\n              target: \"_blank\", //是否新选项卡打开（比如节点返回href才有效）\r\n              click: function(item) {\r\n                //点击节点回调\r\n                auth.baseData.treeNode = item;\r\n                auth.baseData.id = item.Id;\r\n                auth.baseData.editFalge = true;\r\n                //auth.server.getNodedata(item.Flag, item.Id);\r\n                auth.server.getRoleAccessOrganNode(item.Flag, item.Id);\r\n                auth.server.getRoleAccessRightNode(item.Flag, item.Id);\r\n                auth.server.getRoleUserRightNode(item.Flag, item.Id);\r\n                auth.render.disabledBtton(item.Flag);\r\n              },\r\n              nodes: data\r\n            });\r\n          },\r\n          renderAccessOrganTree: function(data) {\r\n            z_tree.init(data, \"treeOrgan\");\r\n          },\r\n          renderAccessRightTree: function(data) {\r\n            z_tree.init(data, \"treeAccessRight\");\r\n          },\r\n          renderAccessOrganTreeUser: function(data) {\r\n            z_tree.init(data, \"treeOrganUser\");\r\n          },\r\n          openDeleteConfirm: function(data) {\r\n            console.log(data, \"模态框\");\r\n          },\r\n          disabledBtton: function(data) {\r\n            //\r\n            common.isDisableButton(\".layui-btn\", false);\r\n          },\r\n          setTreeNodeCheck: function(dataNode, el) {\r\n            //获取树的实例\r\n            var organTree = layui.jquery_ztree.getZTreeObj(el);\r\n            //全部取消之前的选定\r\n            console.log(dataNode, el, \"树形结构check填充参数\");\r\n            if (organTree == null) {\r\n              return;\r\n            }\r\n            organTree.checkAllNodes(false);\r\n            var nodes = organTree.getNodes();\r\n            if (nodes.length > 0 && dataNode.length > 0) {\r\n              //挨个赋值选定\r\n              for (var i = 0; i < dataNode.length; i++) {\r\n                console.log(dataNode[i], el);\r\n                var node = organTree.getNodeByParam(\"Id\", dataNode[i], null);\r\n                organTree.expandNode(node, true, true, true, false);\r\n                node.checked = true;\r\n                organTree.updateNode(node, false);\r\n              }\r\n            }\r\n          }\r\n        },\r\n        currData: {\r\n          getArryNodeId: function(ArrayNode, item) {\r\n            var arr = [];\r\n            for (var i = 0; i < ArrayNode.length; i++) {\r\n              var id = ArrayNode[i][item];\r\n              arr.push(id);\r\n            }\r\n            return arr;\r\n          }\r\n        }\r\n      };\r\n      auth.init();\r\n    }\r\n  );\r\n"]}