{"version":3,"sources":["platform/region.js"],"names":["layui","config","base","extend","index","use","$","form","layer","table","common","tree","z_treeConfig","on","data","console","log","field","topName","region","baseData","editFalge","server","eidtOrgan","addOrgan","init","this","getTreeData","render","showtips","event","treeObj","id","nodeData","sunNodeFalge","click","html","isDisableButton","val","Title","openDeleteConfirm","ajaxFun","then","res","appResult","isSucceeded","renderTree","Result","TreeNodes","loadErrorText","fail","err","getNodedata","flage","urlID","showForm","load","ajax","type","url","setter","baseUrl","dataType","headers","Accept","Content-Type","success","closeAll","IsSucceed","dataNode","Name","Code","Message","msg","Errors","icon","error","dataBean","consts","basePostData","ParentId","Id","Data","str1","JSON","stringify","delet","callback","onClick","currData","treeOnClick","addClass","show","removeClass","renderFormData","Flag","disabledBtton","confirm","btn","getTreeNodeName","treeData","title","e","node"],"mappings":"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","file":"../../../platform/region.js","sourcesContent":["layui\r\n  .config({\r\n    base: \"../../../layuiadmin/\"\r\n  })\r\n  .extend({\r\n    index: \"lib/index\" //主入口模块\r\n  })\r\n  .use(\r\n    [\"index\", \"table\", \"layer\", \"common\", \"consts\", \"z_treeConfig\"],\r\n    function() {\r\n      var $ = layui.$,\r\n        form = layui.form,\r\n        table = layui.table,\r\n        layer = layui.layer,\r\n        tree = layui.tree,\r\n        common = layui.common,\r\n        z_treeConfig = layui.z_treeConfig;\r\n      //数据表单监听(部门)\r\n      form.on(\"submit(DepartmentFrom)\", function(data) {\r\n        console.log(data.field, \"新增部门\");\r\n        delete data.field.topName;\r\n        if (region.baseData.editFalge) {\r\n          console.log(\"执行编辑命令\");\r\n          region.server.eidtOrgan(data.field, \"/api/Role\", \"department\");\r\n        } else {\r\n          region.server.addOrgan(data.field, \"/api/Role\", \"department\");\r\n          console.log(\"执行添加命令\");\r\n        }\r\n        return false;\r\n      });\r\n      //数据表单监听(角色)\r\n      form.on(\"submit(staffFrom)\", function(data) {\r\n        delete data.field.topName;\r\n        console.log(\"新增\");\r\n        if (region.baseData.editFalge) {\r\n          region.server.eidtOrgan(data.field, \"/api/Role\", \"staff\");\r\n        } else {\r\n          region.server.addOrgan(data.field, \"/api/Role\", \"staff\");\r\n        }\r\n        return false;\r\n      });\r\n      //region\r\n      var region = {\r\n        init: function() {\r\n          this.server.getTreeData();\r\n          this.render.showtips();\r\n          this.event();\r\n        },\r\n        baseData: {\r\n          treeObj: {},\r\n          id: \"\",\r\n          nodeData: {},\r\n          sunNodeFalge: false,\r\n          editFalge: false\r\n        },\r\n        event: function() {\r\n          $(\"#refresh\").click(function() {\r\n            $(\"#treeOrgan\").html(\"\");\r\n            region.server.getTreeData();\r\n            region.baseData.editFalge = false;\r\n            region.baseData.sunNodeFalge = false;\r\n            common.isDisableButton(\"#delet\", true);\r\n            common.isDisableButton(\"#delet\", true);\r\n          });\r\n          $(\"#showDepartment\").click(function() {\r\n            $(\"#formTitle\").html(\"新增区域信息\");\r\n            $(\".submit\").html(\"立即提交\");\r\n            form.val(\"DepartmentFrom\", {\r\n              topName: region.baseData.nodeData.Title\r\n            });\r\n            region.baseData.editFalge = false;\r\n            region.baseData.sunNodeFalge = false;\r\n          });\r\n          $(\"#showStaff\").click(function() {\r\n            $(\"#formTitle\").html(\"新增子域信息\");\r\n            $(\".submit\").html(\"立即提交\");\r\n            region.baseData.sunNodeFalge = true;\r\n            region.baseData.editFalge = false;\r\n          });\r\n          $(\"#delet\").click(function() {\r\n            region.render.openDeleteConfirm(region.baseData.nodeData);\r\n          });\r\n        },\r\n        server: {\r\n          getTreeData: function() {\r\n            common\r\n              .ajaxFun(\"get\", \"/api/Region/tree\")\r\n              .then(function(res) {\r\n                if (common.appResult.isSucceeded(res)) {\r\n                  //渲染树\r\n                  region.render.renderTree(res.Result.TreeNodes);\r\n                } else {\r\n                  common.appResult.loadErrorText(res);\r\n                }\r\n              })\r\n              .fail(err => {\r\n                console.log(err);\r\n              });\r\n          },\r\n          getNodedata: function(flage, id) {\r\n            var urlID = \"\";\r\n            if (flage === \"roleCatalog\") {\r\n              urlID = \"/api/Role/\" + id;\r\n              region.render.showForm(\"#DepartmentFrom\");\r\n            } else if (flage === \"roleInfo\") {\r\n              urlID = \"/api/Role/\" + id;\r\n              region.render.showForm(\"#staffFrom\");\r\n            } else {\r\n              return;\r\n            }\r\n            layer.load(2);\r\n            $.ajax({\r\n              type: \"get\",\r\n              url: layui.setter.baseUrl + urlID,\r\n              dataType: \"json\",\r\n              headers: {\r\n                Accept: \"application/json\",\r\n                \"Content-Type\": \"application/json\"\r\n              },\r\n              success: function(data) {\r\n                layer.closeAll();\r\n                console.log(data);\r\n                if (data.IsSucceed) {\r\n                  region.baseData.nodeData = data.Result;\r\n                  var dataNode = data.Result;\r\n                  if (flage === \"roleCatalog\") {\r\n                    form.val(\"DepartmentFrom\", {\r\n                      Name: dataNode.Name,\r\n                      Code: dataNode.Code,\r\n                      Message: dataNode.Message\r\n                    });\r\n                  } else if (flage === \"roleInfo\") {\r\n                    form.val(\"staffFrom\", {\r\n                      Name: dataNode.Name,\r\n                      Code: dataNode.Code,\r\n                      Message: dataNode.Message\r\n                    });\r\n                  }\r\n                } else {\r\n                  layer.msg(\"获取节点数据失败! \" + data.Errors[0].Message, {\r\n                    icon: 5\r\n                  });\r\n                }\r\n              },\r\n              error: function(err) {\r\n                layer.closeAll();\r\n                layer.msg(\"数据操作失败\", { icon: 5 });\r\n              }\r\n            });\r\n          },\r\n          addOrgan: function(data, url, flage) {\r\n            var dataBean = layui.consts.basePostData();\r\n            if (region.baseData.sunNodeFalge) {\r\n              data.ParentId = region.baseData.nodeData.Id;\r\n            } else {\r\n              data.ParentId = \"\";\r\n            }\r\n            dataBean.Data = data;\r\n            console.log(data);\r\n            var str1 = JSON.stringify(dataBean);\r\n            common\r\n              .ajaxFun(\"post\", \"/api/Region/info\", str1)\r\n              .then(function(res) {\r\n                if (common.appResult.isSucceeded(res)) {\r\n                  region.server.getTreeData();\r\n                  layer.msg(\"数据添加成功!\", { icon: 6 });\r\n                } else {\r\n                  common.appResult.loadErrorText(res);\r\n                }\r\n              })\r\n              .fail(err => {\r\n                console.log(err);\r\n              });\r\n          },\r\n          eidtOrgan: function(data, url) {\r\n            var dataBean = layui.consts.basePostData();\r\n            data.Id = region.baseData.id;\r\n            dataBean.Data = data;\r\n\r\n            var str1 = JSON.stringify(dataBean);\r\n            var dataBean = layui.consts.basePostData();\r\n            if (flage === \"staff\") {\r\n              data.ParentId = region.baseData.id;\r\n            }\r\n            data.ParentId = \"\";\r\n            dataBean.Data = data;\r\n            var str1 = JSON.stringify(dataBean);\r\n            common\r\n              .ajaxFun(\"put\", \"/api/Region/info\", str1)\r\n              .then(function(res) {\r\n                if (common.appResult.isSucceeded(res)) {\r\n                  console.log(\"数据添加成功\");\r\n                } else {\r\n                  common.appResult.loadErrorText(res);\r\n                }\r\n              })\r\n              .fail(err => {\r\n                console.log(err);\r\n              });\r\n          },\r\n          delet: function(flage, id) {\r\n            console.log(flage, id, \"id信息\");\r\n            var urlID = \"\";\r\n            if (flage === \"regionInfo\") {\r\n              urlID = \"/api/Region/info/\" + id;\r\n            } else {\r\n              return;\r\n            }\r\n            common\r\n              .ajaxFun(\"DELETE\", urlID)\r\n              .then(function(res) {\r\n                if (common.appResult.isSucceeded(res)) {\r\n                  region.server.getTreeData();\r\n                  layer.msg(\"数据删除成功!\", { icon: 6 });\r\n                } else {\r\n                  common.appResult.loadErrorText(res);\r\n                }\r\n              })\r\n              .fail(err => {\r\n                console.log(err);\r\n              });\r\n          }\r\n        },\r\n        render: {\r\n          renderTree: function(data) {\r\n            //渲染树 1.数据 2.DOM节点 3.配置项目\r\n            region.baseData.treeObj = layui.z_treeConfig.renderTree(\r\n              data,\r\n              \"treeRegion\",\r\n              {\r\n                callback: {\r\n                  onClick: region.currData.treeOnClick\r\n                }\r\n              }\r\n            );\r\n          },\r\n          showForm: function(id) {\r\n            $(\"#DepartmentFrom\").addClass(\"layui-hide\");\r\n            $(\"#staffFrom\").addClass(\"layui-hide\");\r\n            $(id).show();\r\n            $(id).removeClass(\"layui-hide\");\r\n          },\r\n          renderFormData: function(data) {\r\n            if (data.Flag === \"roleCatalog\") {\r\n              form.val(\"DepartmentFrom\", {\r\n                Name: data.Title\r\n              });\r\n            }\r\n          },\r\n          disabledBtton: function(flage) {\r\n            common.isDisableButton(\"#lower\", false);\r\n            common.isDisableButton(\"#upper\", false);\r\n            common.isDisableButton(\"#delet\", false);\r\n            if (flage === \"roleCatalog\") {\r\n              common.isDisableButton(\"#lower\", true);\r\n              common.isDisableButton(\"#upper\", true);\r\n              common.isDisableButton(\"#showDepartment\", false);\r\n              common.isDisableButton(\"#showStaff\", false);\r\n            } else if (flage === \"roleInfo\") {\r\n              common.isDisableButton(\"#showDepartment\", true);\r\n              common.isDisableButton(\"#showStaff\", true);\r\n            }\r\n          },\r\n          showtips: function() {\r\n            common.showtips(\".layui-btn-group button\");\r\n          },\r\n          openDeleteConfirm: function(data) {\r\n            layer.confirm(\r\n              \"你确定要删除<span style='font-weight:bolder'>\" +\r\n                data.Title +\r\n                \"</span>的节点吗?\",\r\n              {\r\n                btn: [\"确定\", \"取消\"], //按钮\r\n                icon: 3\r\n              },\r\n              function() {\r\n                region.server.delet(data.Flag, data.Id);\r\n              },\r\n              function() {\r\n                console.log(\"取消\");\r\n              }\r\n            );\r\n          }\r\n        },\r\n        currData: {\r\n          getTreeNodeName: function(treeData, id) {\r\n            var title = common.getTreeNodeName(treeData, id, \"name\");\r\n            $(\".topName\").val(title);\r\n            $(\".submit\").html(\"立即修改\");\r\n          },\r\n          treeOnClick: function(e, id, node) {\r\n            console.log(node);\r\n            common.isDisableButton(\"#delet\", false);\r\n            common.isDisableButton(\"#showStaff\", false);\r\n            region.baseData.nodeData = node;\r\n          }\r\n        }\r\n      };\r\n      region.init();\r\n    }\r\n  );\r\n"]}