{"version":3,"sources":["platform/userauth.js"],"names":["layui","config","base","extend","index","use","$","table","layer","common","tree","consts","jquery_ztree","jquery_ztree_excheck","render","elem","url","setter","baseUrl","parseData","cols","type","field","title","templet","d","GroupClassify","LockoutEnabled","page","loading","limit","text","on","obj","console","log","checked","data","isDisableButton","auth","baseData","id","Id","server","getUserAccessOrganNode","getUserAccessRightNode","getRoleWidthUserRightNode","z_tree","init","treeData","el","riod","this","renderTree","zTreeObj","treeSeting","check","enable","chkboxType","Y","N","nocheckInherit","simpleData","callback","onCheck","e","treeId","treeNode","treeSetingRiod","chkStyle","radioType","event","seting","treeObj","getZTreeObj","nodes","getNodes","length","expandNode","getRoleTreeData","getAccessOrganTreeData","getAccessRightTreeData","nodeData","editFalge","click","nodeArry","getCheckedNodes","idArry","currData","getArryNodeId","userId","putRoleAccessRight","ajax","dataType","headers","Accept","Content-Type","success","closeAll","IsSucceed","i","name","Title","children","Children","Flag","nocheck","Result","TreeNodes","nodeData1","renderRoleTree","msg","Errors","Message","icon","error","err","userflage","checkNode","checkUserNode","nodeData2","renderAccessOrganTree","renderAccessOrganTreeUser","Name","Functions","Permissions","renderAccessRightTree","flage","urlID","setTreeNodeCheck","load","dataBean","basePostData","Data","str1","JSON","stringify","openDeleteConfirm","dataNode","organTree","checkAllNodes","node","getNodeByParam","updateNode","ArrayNode","item","arr","push"],"mappings":"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","file":"../../../platform/userauth.js","sourcesContent":["layui\r\n  .config({\r\n    base: \"../../../layuiadmin/\"\r\n  })\r\n  .extend({\r\n    index: \"lib/index\" //主入口模块\r\n  })\r\n  .use(\r\n    [\r\n      \"index\",\r\n      \"layer\",\r\n      \"tree\",\r\n      \"common\",\r\n      \"element\",\r\n      \"consts\",\r\n      \"jquery_ztree_excheck\",\r\n      \"table\"\r\n    ],\r\n    function() {\r\n      var $ = layui.$,\r\n        table = layui.table,\r\n        layer = layui.layer,\r\n        tree = layui.tree,\r\n        common = layui.common,\r\n        consts = layui.consts;\r\n      jquery_ztree = layui.jquery_ztree_excheck;\r\n      //表格\r\n      //用户管理表格渲染\r\n\r\n      var userManageTable = table.render({\r\n        elem: \"#userAuthTable\",\r\n        url: layui.setter.baseUrl + \"/api/User/query/group/normal/1/10\", //接口\r\n        // response: layui.setter.response,\r\n        parseData: layui.setter.parseData,\r\n        cols: [\r\n          [\r\n            { type: \"radio\" },\r\n            { field: \"NormalizedName\", title: \"用户名\" },\r\n            {\r\n              field: \"GroupClassify\",\r\n              title: \"类别\",\r\n              templet: function(d) {\r\n                if ((d.GroupClassify = \"normal\")) {\r\n                  return \"普通用户\";\r\n                } else if ((d.GroupClassify = \"manager\")) {\r\n                  return \"业务管理员\";\r\n                } else {\r\n                  return \"未知类别\";\r\n                }\r\n              }\r\n            },\r\n            {\r\n              field: \"锁定/解锁\",\r\n              title: \"锁定状态\",\r\n              templet: function(d) {\r\n                if (d.LockoutEnabled) {\r\n                  return '<span class=\"layui-btn layui-btn-primary layui-btn-xs\">解锁</span>';\r\n                } else {\r\n                  return '<span class=\"layui-btn layui-btn-normal layui-btn-xs\">锁定</span>';\r\n                }\r\n              }\r\n            }\r\n          ]\r\n        ],\r\n        page: true,\r\n        loading: true,\r\n        limit: 10,\r\n        text: \"对不起，加载出现异常！\"\r\n      });\r\n      //表单选定\r\n      table.on(\"radio(userAuthTable)\", function(obj) {\r\n        console.log(obj.checked); //当前是否选中状态\r\n        console.log(obj.data); //选中行的相关数据\r\n        if (obj.checked) {\r\n          common.isDisableButton(\".layui-btn\", false);\r\n          auth.baseData.id = obj.data.Id;\r\n          //获取对应表格用户id 与权限\r\n          auth.server.getUserAccessOrganNode(\"userTable\", obj.data.Id);\r\n          auth.server.getUserAccessRightNode(\"userTable\", obj.data.Id);\r\n          auth.server.getRoleWidthUserRightNode(\"userTable\", obj.data.Id);\r\n        }\r\n      });\r\n      //z-tree\r\n      var z_tree = {\r\n        init: function(treeData, el, riod) {\r\n          this.render.renderTree(treeData, el, riod);\r\n        },\r\n        baseData: {\r\n          zTreeObj: {}\r\n        },\r\n        treeSeting: {\r\n          check: {\r\n            enable: true,\r\n            chkboxType: { Y: \"s\", N: \"ps\" },\r\n            nocheckInherit: false\r\n          },\r\n          data: {\r\n            simpleData: {\r\n              enable: true\r\n            }\r\n          },\r\n          callback: {\r\n            onCheck: function(e, treeId, treeNode) {\r\n              console.log(treeNode, \"callback\");\r\n            }\r\n          }\r\n        },\r\n        treeSetingRiod: {\r\n          check: {\r\n            enable: true,\r\n            chkStyle: \"radio\",\r\n            radioType: \"all\",\r\n            chkboxType: { Y: \"s\", N: \"ps\" },\r\n            nocheckInherit: false\r\n          },\r\n          data: {\r\n            simpleData: {\r\n              enable: true\r\n            }\r\n          },\r\n          callback: {\r\n            onCheck: function(e, treeId, treeNode) {\r\n              auth.baseData.id = treeNode.Id;\r\n              if (treeNode.checked) {\r\n                common.isDisableButton(\".layui-btn\", false);\r\n                //获取对应表格用户id 与权限\r\n                auth.server.getUserAccessOrganNode(\"userTable\", treeNode.Id);\r\n                auth.server.getUserAccessRightNode(\"userTable\", treeNode.Id);\r\n                auth.server.getRoleWidthUserRightNode(\"userTable\", treeNode.Id);\r\n              } else {\r\n                common.isDisableButton(\".layui-btn\", true);\r\n              }\r\n            }\r\n          }\r\n        },\r\n        event: {},\r\n        render: {\r\n          renderTree: function(treeData, el, riod) {\r\n            var seting = riod ? z_tree.treeSetingRiod : z_tree.treeSeting;\r\n            z_tree.baseData.zTreeObj = layui.jquery_ztree.init(\r\n              $(\"#\" + el),\r\n              seting,\r\n              treeData\r\n            );\r\n            var treeObj = layui.jquery_ztree.getZTreeObj(el);\r\n            var nodes = treeObj.getNodes();\r\n            if (nodes.length > 0) {\r\n              //自动展开第一项\r\n              treeObj.expandNode(nodes[0], true, false, true);\r\n            }\r\n          }\r\n        }\r\n      };\r\n      //auth\r\n      var auth = {\r\n        init: function() {\r\n          this.server.getRoleTreeData();\r\n          this.server.getAccessOrganTreeData();\r\n          this.server.getAccessRightTreeData();\r\n          this.event();\r\n        },\r\n        baseData: {\r\n          treeNode: {},\r\n          id: \"\",\r\n          nodeData: {},\r\n          editFalge: false\r\n        },\r\n        event: function() {\r\n          $(\"#accessOrganSub\").click(function() {\r\n            var nodeArry = layui.jquery_ztree\r\n              .getZTreeObj(\"treeOrgan\")\r\n              .getCheckedNodes(true);\r\n            var idArry = auth.currData.getArryNodeId(nodeArry, \"Id\");\r\n            var userId = auth.baseData.id;\r\n            auth.server.putRoleAccessRight(\"Organ\", idArry, userId);\r\n          });\r\n          $(\"#accessRightSub\").click(function() {\r\n            var nodeArry = layui.jquery_ztree\r\n              .getZTreeObj(\"treeAccessRight\")\r\n              .getCheckedNodes(true);\r\n            var idArry = auth.currData.getArryNodeId(nodeArry, \"Id\");\r\n            var userId = auth.baseData.id;\r\n            auth.server.putRoleAccessRight(\"Right\", idArry, userId);\r\n          });\r\n          $(\"#accessRoleSub\").click(function() {\r\n            var nodeArry = layui.jquery_ztree\r\n              .getZTreeObj(\"roleTree\")\r\n              .getCheckedNodes(true);\r\n            var idArry = auth.currData.getArryNodeId(nodeArry, \"Id\");\r\n            var userId = auth.baseData.id;\r\n            auth.server.putRoleAccessRight(\"User\", idArry, userId);\r\n          });\r\n        },\r\n        server: {\r\n          getRoleTreeData: function() {\r\n            $.ajax({\r\n              type: \"get\",\r\n              url: layui.setter.baseUrl + \"/api/Role/treeview\",\r\n              dataType: \"json\",\r\n              headers: {\r\n                Accept: \"application/json\",\r\n                \"Content-Type\": \"application/json\"\r\n              },\r\n              success: function(data) {\r\n                layer.closeAll(\"loading\");\r\n                if (data.IsSucceed) {\r\n                  console.log(data.Result.TreeNodes);\r\n                  var nodeData = data.Result.TreeNodes;\r\n                  function currData(data) {\r\n                    if (data.length > 0) {\r\n                      for (var i = 0; i < data.length; i++) {\r\n                        data[i].name = data[i].Title;\r\n                        data[i].children = data[i].Children;\r\n                        if (data[i].Flag == \"roleCatalog\") {\r\n                          data[i].nocheck = true;\r\n                        }\r\n                        if (data[i].Children.length > 0) {\r\n                          currData(data[i].Children);\r\n                        }\r\n                      }\r\n                    }\r\n                    return data;\r\n                  }\r\n                  var nodeData1 = currData(nodeData);\r\n                  //z-tree树形结构渲染 数据,domID\r\n                  auth.render.renderRoleTree(nodeData1);\r\n                } else {\r\n                  layer.msg(\"获取角色数据失败!\" + data.Errors[0].Message, {\r\n                    icon: 5\r\n                  });\r\n                }\r\n              },\r\n              error: function(err) {\r\n                layer.closeAll();\r\n                layer.msg(\"数据操作失败\", { icon: 5 });\r\n              }\r\n            });\r\n          },\r\n          getAccessOrganTreeData: function() {\r\n            $.ajax({\r\n              type: \"get\",\r\n              url: layui.setter.baseUrl + \"/api/organ/treeview\",\r\n              dataType: \"json\",\r\n              headers: {\r\n                Accept: \"application/json\",\r\n                \"Content-Type\": \"application/json\"\r\n              },\r\n              success: function(data) {\r\n                layer.closeAll(\"loading\");\r\n                if (data.IsSucceed) {\r\n                  console.log(data.Result.TreeNodes);\r\n                  var nodeData = data.Result.TreeNodes;\r\n                  function currData(data, userflage) {\r\n                    if (data.length > 0) {\r\n                      for (var i = 0; i < data.length; i++) {\r\n                        data[i].name = data[i].Title;\r\n                        data[i].children = data[i].Children;\r\n                        if (userflage) {\r\n                          var nocheck = data[i].Flag === \"staff\" ? false : true;\r\n                          data[i].nocheck = nocheck;\r\n                          if (data[i].Flag === \"staff\") {\r\n                            delete data[i].Children;\r\n                            delete data[i].children;\r\n                          }\r\n                        }\r\n                        if (data[i].Children && data[i].Children.length > 0) {\r\n                          currData(data[i].Children, userflage);\r\n                        }\r\n                      }\r\n                    }\r\n                    return data;\r\n                  }\r\n                  //深拷贝数据\r\n                  var checkNode = $.extend(true, [], nodeData);\r\n                  var checkUserNode = $.extend(true, [], nodeData);\r\n\r\n                  var nodeData1 = currData(checkNode, false);\r\n                  var nodeData2 = currData(checkUserNode, true);\r\n\r\n                  auth.render.renderAccessOrganTree(nodeData1);\r\n                  auth.render.renderAccessOrganTreeUser(nodeData2);\r\n                } else {\r\n                  layer.msg(\"获取数据失败\" + data.Errors[0].Message, {\r\n                    icon: 5\r\n                  });\r\n                }\r\n              },\r\n              error: function(err) {\r\n                layer.closeAll();\r\n                layer.msg(\"数据操作失败\", { icon: 5 });\r\n              }\r\n            });\r\n          },\r\n          getAccessRightTreeData: function() {\r\n            $.ajax({\r\n              type: \"get\",\r\n              url: layui.setter.baseUrl + \"/api/Module/deep/permission\",\r\n              dataType: \"json\",\r\n              headers: {\r\n                Accept: \"application/json\",\r\n                \"Content-Type\": \"application/json\"\r\n              },\r\n              success: function(data) {\r\n                layer.closeAll(\"loading\");\r\n                if (data.IsSucceed) {\r\n                  var nodeData = data.Result;\r\n                  function currData(data) {\r\n                    if (data.length > 0) {\r\n                      for (var i = 0; i < data.length; i++) {\r\n                        data[i].name = data[i].Name;\r\n                        if (data[i].Functions && data[i].Functions.length > 0) {\r\n                          data[i].children = data[i].Functions;\r\n                        }\r\n                        if (\r\n                          data[i].Permissions &&\r\n                          data[i].Permissions.length > 0\r\n                        ) {\r\n                          data[i].children = data[i].Permissions;\r\n                        }\r\n                        if (data[i].children && data[i].children.length > 0) {\r\n                          currData(data[i].children);\r\n                        }\r\n                      }\r\n                    }\r\n                    return data;\r\n                  }\r\n                  var nodeData1 = currData(nodeData);\r\n\r\n                  auth.render.renderAccessRightTree(nodeData1);\r\n                } else {\r\n                  layer.msg(\"获取数据失败\" + data.Errors[0].Message, {\r\n                    icon: 5\r\n                  });\r\n                }\r\n              },\r\n              error: function(err) {\r\n                layer.closeAll();\r\n                layer.msg(\"数据操作失败\", { icon: 5 });\r\n              }\r\n            });\r\n          },\r\n          getUserAccessOrganNode: function(flage, id) {\r\n            if (flage === \"userTable\") {\r\n              urlID = \"/api/User/accessOrgan/\" + id;\r\n            } else {\r\n              return;\r\n            }\r\n            $.ajax({\r\n              type: \"get\",\r\n              url: layui.setter.baseUrl + \"/api/Role/accessOrgan/\" + id,\r\n              dataType: \"json\",\r\n              headers: {\r\n                Accept: \"application/json\",\r\n                \"Content-Type\": \"application/json\"\r\n              },\r\n              success: function(data) {\r\n                layer.closeAll();\r\n                if (data.IsSucceed) {\r\n                  auth.render.setTreeNodeCheck(data.Result, \"treeOrgan\");\r\n                } else {\r\n                  layer.msg(\"获取节点数据失败! \" + data.Errors[0].Message, {\r\n                    icon: 5\r\n                  });\r\n                }\r\n              },\r\n              error: function(err) {\r\n                layer.closeAll();\r\n                layer.msg(\"数据操作失败\", { icon: 5 });\r\n              }\r\n            });\r\n          },\r\n          getUserAccessRightNode: function(flage, id) {\r\n            var urlID = \"\";\r\n            if (flage === \"userTable\") {\r\n              urlID = \"/api/User/accessRight/\" + id;\r\n            } else {\r\n              return;\r\n            }\r\n            layer.load(2);\r\n            $.ajax({\r\n              type: \"get\",\r\n              url: layui.setter.baseUrl + urlID,\r\n              dataType: \"json\",\r\n              headers: {\r\n                Accept: \"application/json\",\r\n                \"Content-Type\": \"application/json\"\r\n              },\r\n              success: function(data) {\r\n                layer.closeAll();\r\n                if (data.IsSucceed) {\r\n                  auth.render.setTreeNodeCheck(data.Result, \"treeAccessRight\");\r\n                } else {\r\n                  layer.msg(\r\n                    \"获取功能访问权限数据失败! \" + data.Errors[0].Message,\r\n                    {\r\n                      icon: 5\r\n                    }\r\n                  );\r\n                }\r\n              },\r\n              error: function(err) {\r\n                layer.closeAll();\r\n                layer.msg(\"数据操作失败\", { icon: 5 });\r\n              }\r\n            });\r\n          },\r\n          getRoleWidthUserRightNode: function(flage, id) {\r\n            if (flage === \"userTable\") {\r\n              urlID = \"/api/Role/with/user/\" + id;\r\n            } else {\r\n              return;\r\n            }\r\n            $.ajax({\r\n              type: \"get\",\r\n              url: layui.setter.baseUrl + urlID,\r\n              dataType: \"json\",\r\n              headers: {\r\n                Accept: \"application/json\",\r\n                \"Content-Type\": \"application/json\"\r\n              },\r\n              success: function(data) {\r\n                layer.closeAll();\r\n                if (data.IsSucceed) {\r\n                  auth.render.setTreeNodeCheck(data.Result, \"roleTree\");\r\n                } else {\r\n                  layer.msg(\"获取节点数据失败! \" + data.Errors[0].Message, {\r\n                    icon: 5\r\n                  });\r\n                }\r\n              },\r\n              error: function(err) {\r\n                layer.closeAll();\r\n                layer.msg(\"数据操作失败\", { icon: 5 });\r\n              }\r\n            });\r\n          },\r\n          putRoleAccessRight: function(flage, data, userId) {\r\n            var urlID = \"\";\r\n            if (flage === \"Organ\") {\r\n              urlID = \"/api/Role/accessOrgan/\" + userId;\r\n            } else if (flage === \"Right\") {\r\n              urlID = \"/api/Role/accessRight/\" + userId;\r\n            } else if (flage === \"User\") {\r\n              urlID = \"/api/Role/with/user/\" + userId;\r\n            } else {\r\n              return layer.msg(\"出错啦\");\r\n            }\r\n            var dataBean = layui.consts.basePostData();\r\n            dataBean.Data = data;\r\n            var str1 = JSON.stringify(dataBean);\r\n            layer.load();\r\n            $.ajax({\r\n              type: \"put\",\r\n              url: layui.setter.baseUrl + urlID,\r\n              dataType: \"json\",\r\n              data: str1,\r\n              headers: {\r\n                Accept: \"application/json\",\r\n                \"Content-Type\": \"application/json\"\r\n              },\r\n              success: function(data) {\r\n                layer.closeAll();\r\n                if (data.IsSucceed) {\r\n                  console.log(data.Result, \"当前角色点\");\r\n                  layer.msg(\"更新权限成功!\", { icon: 6 });\r\n                } else {\r\n                  layer.msg(\"更新权限数据失败! \" + data.Errors[0].Message, {\r\n                    icon: 5\r\n                  });\r\n                }\r\n              },\r\n              error: function(err) {\r\n                layer.closeAll();\r\n                layer.msg(\"数据操作失败\", { icon: 5 });\r\n              }\r\n            });\r\n          }\r\n        },\r\n        render: {\r\n          renderRoleTree: function(data) {\r\n            //树形渲染\r\n            z_tree.init(data, \"roleTree\");\r\n          },\r\n          renderAccessOrganTree: function(data) {\r\n            z_tree.init(data, \"treeOrgan\");\r\n          },\r\n          renderAccessRightTree: function(data) {\r\n            z_tree.init(data, \"treeAccessRight\");\r\n          },\r\n          renderAccessOrganTreeUser: function(data) {\r\n            z_tree.init(data, \"treeOrganUser\", true);\r\n          },\r\n          openDeleteConfirm: function(data) {\r\n            console.log(data, \"模态框\");\r\n          },\r\n          setTreeNodeCheck: function(dataNode, el) {\r\n            //获取树的实例\r\n            var organTree = layui.jquery_ztree.getZTreeObj(el);\r\n            console.log(dataNode, el, \"被赋值的选项\");\r\n            //全部取消之前的选定\r\n            if (organTree == null) {\r\n              return;\r\n            }\r\n            organTree.checkAllNodes(false);\r\n            var nodes = organTree.getNodes();\r\n            if (nodes.length > 0 && dataNode.length > 0) {\r\n              //挨个赋值选定\r\n              for (var i = 0; i < dataNode.length; i++) {\r\n                var node = organTree.getNodeByParam(\"Id\", dataNode[i], null);\r\n                organTree.expandNode(node, true, true, true, false);\r\n                if (node === null) {\r\n                  return;\r\n                }\r\n                node.checked = true;\r\n                organTree.updateNode(node, false);\r\n              }\r\n            }\r\n          }\r\n        },\r\n        currData: {\r\n          getArryNodeId: function(ArrayNode, item) {\r\n            var arr = [];\r\n            for (var i = 0; i < ArrayNode.length; i++) {\r\n              var id = ArrayNode[i][item];\r\n              arr.push(id);\r\n            }\r\n            return arr;\r\n          }\r\n        }\r\n      };\r\n      auth.init();\r\n    }\r\n  );\r\n"]}