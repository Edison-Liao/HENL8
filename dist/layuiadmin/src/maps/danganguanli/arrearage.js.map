{"version":3,"sources":["danganguanli/arrearage.js"],"names":["layui","config","base","extend","index","use","$","form","table","layer","on","data","field","console","log","reload","where","render","elem","url","setter","huibleUrl","parseData","request","cols","title","minWidth","templet","d","DeviceType","IsActived","util","toDateString","CreateDate","width","align","fixed","toolbar","loading","page","limit","text","obj","event","msg","confirm","icon","userSeverEvent","unActive","addMac","closeAll","load","shade","dataBean","basePostData","Data","str1","JSON","stringify","ajax","type","async","dataType","headers","Accept","Content-Type","success","IsSucceed","error","err","RegistId","Id","res","Errors","active","add","open","content","area","btn","yes","macData","Mac","val","Description","IsForce","MacStr","substr","length","btn2","layero","this","call"],"mappings":"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","file":"../../../danganguanli/arrearage.js","sourcesContent":["layui\r\n  .config({\r\n    base: \"../../../layuiadmin/\" //静态资源所在路径\r\n  })\r\n  .extend({\r\n    index: \"lib/index\" //主入口模块\r\n  })\r\n  .use([\"index\", \"table\", \"layer\"], function() {\r\n    var $ = layui.$,\r\n      form = layui.form,\r\n      table = layui.table;\r\n    layer = layui.layer;\r\n    //监听搜索\r\n    form.on(\"submit(IccRegist-search)\", function(data) {\r\n      var field = data.field;\r\n      console.log(data, \"数据\");\r\n      //执行重载\r\n      table.reload(\"iccRegistTable\", {\r\n        where: field\r\n      });\r\n    });\r\n\r\n    //用户管理表格渲染\r\n    var iccRegistTable = table.render({\r\n      elem: \"#iccRegistTable\",\r\n      url: layui.setter.huibleUrl + \"/api/IccWchat/regist/search\", //接口\r\n      parseData: layui.setter.parseData,\r\n      request: layui.setter.request,\r\n      cols: [\r\n        [\r\n          {\r\n            field: \"Mac\",\r\n            // width: 100,\r\n            title: \"Mac号\"\r\n          },\r\n          { field: \"DeviceId\", title: \"设备Id\", minWidth: 100 },\r\n          {\r\n            field: \"DeviceType\",\r\n            title: \"设备类型\",\r\n            templet: function(d) {\r\n              if (d.DeviceType === \"blue\") {\r\n                return '<span class=\"layui-badge layui-bg-blue\">蓝牙</span>';\r\n              } else {\r\n                return '<span class=\"layui-badge layui-bg-gray\">蓝牙</span>';\r\n              }\r\n            }\r\n          },\r\n          {\r\n            field: \"IsActived\",\r\n            title: \"设备是否激活\",\r\n            templet: function(d) {\r\n              if (d.IsActived == true) {\r\n                return '<span class=\"layui-badge layui-bg-blue\">已激活</span>';\r\n              } else {\r\n                return '<span class=\"layui-badge layui-bg-gray layui-badge-rim\">未激活</span>';\r\n              }\r\n            }\r\n          },\r\n          {\r\n            field: \"CreateDate\",\r\n            title: \"设备创建时间\",\r\n            templet: function(d) {\r\n              return \"<div>\" + layui.util.toDateString(d.CreateDate) + \"</div>\";\r\n            }\r\n          },\r\n          {\r\n            title: \"操作\",\r\n            width: 150,\r\n            align: \"center\",\r\n            fixed: \"right\",\r\n            toolbar: \"#table-IccRegist\"\r\n          }\r\n        ]\r\n      ],\r\n      loading: true,\r\n      page: true,\r\n      limit: 10,\r\n      text: \"对不起，加载出现异常！\"\r\n    });\r\n\r\n    //监听工具条\r\n    table.on(\"tool(table-IccRegist)\", function(obj) {\r\n      var data = obj.data;\r\n      if (obj.event === \"unActive\") {\r\n        var msg = data.IsActived\r\n          ? \"确认要取消激活该设备吗?\"\r\n          : \"确认要激活该设备吗?\";\r\n        layer.confirm(msg, { icon: 3, title: \"提示\" }, function(index) {\r\n          userSeverEvent.unActive(data);\r\n        });\r\n      }\r\n    });\r\n    //服务交互\r\n    var userSeverEvent = {\r\n      addMac: function(data) {\r\n        layer.closeAll();\r\n        layer.load(0, { shade: false });\r\n        var dataBean = layui.setter.basePostData;\r\n        dataBean.Data = data;\r\n        var str1 = JSON.stringify(dataBean);\r\n        $.ajax({\r\n          type: \"Post\",\r\n          url: layui.setter.huibleUrl + \"/api/IccWchat/regist\",\r\n          data: str1,\r\n          async: true,\r\n          dataType: \"json\",\r\n          headers: {\r\n            Accept: \"application/json\",\r\n            \"Content-Type\": \"application/json\"\r\n          },\r\n          success: function(data) {\r\n            layer.closeAll();\r\n            console.log(data);\r\n            if (data.IsSucceed) {\r\n              layer.msg(\"添加用户成功!\", { icon: 6 });\r\n              table.reload(\"iccRegistTable\");\r\n            } else {\r\n              table.reload(\"iccRegistTable\");\r\n              layer.msg(\"失败\" + data, { icon: 5 });\r\n            }\r\n          },\r\n          error: function(err) {\r\n            layer.closeAll();\r\n            layer.msg(\"数据操作失败\", { icon: 5 });\r\n          }\r\n        });\r\n      },\r\n      unActive: function(data) {\r\n        layer.closeAll();\r\n        layer.load(0, { shade: false });\r\n        var dataBean = layui.setter.basePostData;\r\n        dataBean.Data = {\r\n          IsActived: !data.IsActived,\r\n          RegistId: data.Id\r\n        };\r\n        var str1 = JSON.stringify(dataBean);\r\n        $.ajax({\r\n          type: \"put\",\r\n          url: layui.setter.huibleUrl + \"/api/IccWchat/regist\",\r\n          data: str1,\r\n          async: true,\r\n          dataType: \"json\",\r\n          headers: {\r\n            Accept: \"application/json\",\r\n            \"Content-Type\": \"application/json\"\r\n          },\r\n          success: function(res) {\r\n            layer.closeAll();\r\n            console.log(data);\r\n            if (res.IsSucceed) {\r\n              var msg = data.IsActived ? \"设备取消激活成功!\" : \"设备激活成功!\";\r\n              layer.msg(msg, { icon: 6 });\r\n              table.reload(\"iccRegistTable\");\r\n            } else {\r\n              table.reload(\"iccRegistTable\");\r\n              layer.msg(\"失败\" + res.Errors[0], { icon: 5 });\r\n            }\r\n          },\r\n          error: function(err) {\r\n            layer.closeAll();\r\n            layer.msg(\"数据操作失败\", { icon: 5 });\r\n          }\r\n        });\r\n      }\r\n    };\r\n    //事件\r\n    var active = {\r\n      add: function() {\r\n        layer.open({\r\n          type: 1,\r\n          title: \"新增设备注册信息\", //不显示标题\r\n          content: $(\"#rigist-from\"),\r\n          area: [\"500px\"],\r\n          btn: [\"确认\", \"取消\"],\r\n          yes: function() {\r\n            var macData = {\r\n              Mac: $(\"#Mac\").val(),\r\n              Description: \"\",\r\n              DeviceType: \"blue\",\r\n              IsForce: \"fasle\"\r\n            };\r\n            var MacStr = macData.Mac.substr(0, 7);\r\n            if (MacStr !== \"34008AD\") {\r\n              layer.msg(\"请输入34008AD开始的MAC号!\");\r\n              return;\r\n            } else if (macData.Mac.length !== 12) {\r\n              layer.msg(\"MAC号为12位字符串!\");\r\n              return;\r\n            }\r\n            userSeverEvent.addMac(macData);\r\n          },\r\n          btn2: function(index, layero) {\r\n            console.log(\"取消锁定解锁1\");\r\n          }\r\n        });\r\n      }\r\n    };\r\n    //按钮操作\r\n    $(\".layui-btn\").on(\"click\", function() {\r\n      var type = $(this).data(\"type\");\r\n      active[type] ? active[type].call(this) : \"\";\r\n    });\r\n  });\r\n"]}