{"version":3,"sources":["userfiles/userfiles.js"],"names":["layui","config","base","extend","index","use","$","form","table","layer","selectedData","on","data","field","console","log","reload","where","render","elem","url","setter","huibleUrl","parseData","request","cols","width","type","title","minWidth","templet","d","DeviceType","IsActived","util","toDateString","CreateDate","align","fixed","toolbar","loading","page","limit","text","obj","checked","event","msg","confirm","icon","userSeverEvent","unActive","addMac","closeAll","load","shade","dataBean","basePostData","Data","str1","JSON","stringify","ajax","async","dataType","headers","Accept","Content-Type","success","IsSucceed","error","err","RegistId","Id","res","Errors","active","add","open","content","area","btn","yes","macData","Mac","val","Description","IsForce","MacStr","substr","length","btn2","layero","this","call"],"mappings":"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","file":"../../../userfiles/userfiles.js","sourcesContent":["layui\r\n  .config({\r\n    base: \"../../../layuiadmin/\" //静态资源所在路径\r\n  })\r\n  .extend({\r\n    index: \"lib/index\" //主入口模块\r\n  })\r\n  .use([\"index\", \"table\", \"layer\"], function() {\r\n    var $ = layui.$,\r\n      form = layui.form,\r\n      table = layui.table,\r\n      layer = layui.layer,\r\n      selectedData = []; // 选中的数据\r\n\r\n    //监听搜索\r\n    form.on(\"submit(IccRegist-search)\", function(data) {\r\n      var field = data.field;\r\n      console.log(data, \"数据\");\r\n      //执行重载\r\n      table.reload(\"userFilesTable\", {\r\n        where: field\r\n      });\r\n    });\r\n\r\n    //表格渲染\r\n    var userFilesTable = table.render({\r\n      elem: \"#userFilesTable\",\r\n      url: layui.setter.huibleUrl + \"/api/IccWchat/regist/search\", //接口\r\n      parseData: layui.setter.parseData,\r\n      request: layui.setter.request,\r\n      cols: [\r\n        [\r\n          {\r\n            width: 50,\r\n            type: \"checkbox\"\r\n          },\r\n          { field: \"DeviceId\", title: \"设备Id\", minWidth: 100 },\r\n          {\r\n            field: \"DeviceType\",\r\n            title: \"设备类型\",\r\n            templet: function(d) {\r\n              if (d.DeviceType === \"blue\") {\r\n                return '<span class=\"layui-badge layui-bg-blue\">蓝牙</span>';\r\n              } else {\r\n                return '<span class=\"layui-badge layui-bg-gray\">蓝牙</span>';\r\n              }\r\n            }\r\n          },\r\n          {\r\n            field: \"IsActived\",\r\n            title: \"设备是否激活\",\r\n            templet: function(d) {\r\n              if (d.IsActived == true) {\r\n                return '<span class=\"layui-badge layui-bg-blue\">已激活</span>';\r\n              } else {\r\n                return '<span class=\"layui-badge layui-bg-gray layui-badge-rim\">未激活</span>';\r\n              }\r\n            }\r\n          },\r\n          {\r\n            field: \"CreateDate\",\r\n            title: \"设备创建时间\",\r\n            templet: function(d) {\r\n              return \"<div>\" + layui.util.toDateString(d.CreateDate) + \"</div>\";\r\n            }\r\n          },\r\n          {\r\n            title: \"操作\",\r\n            width: 150,\r\n            align: \"center\",\r\n            fixed: \"right\",\r\n            toolbar: \"#table-UserFiles\"\r\n          }\r\n        ]\r\n      ],\r\n      loading: true,\r\n      page: true,\r\n      limit: 10,\r\n      text: \"对不起，加载出现异常！\"\r\n    });\r\n\r\n    //监听复选框\r\n    table.on(\"checkbox(table-UserFiles)\", function(obj) {\r\n      console.log(selectedData, \"selectedData\");\r\n      console.log(obj.checked); //当前是否选中状态\r\n      console.log(obj.data); //选中行的相关数据\r\n      console.log(obj.type); //如果触发的是全选，则为：all，如果触发的是单选，则为：one\r\n    });\r\n    //监听工具条\r\n    table.on(\"tool(table-UserFiles)\", function(obj) {\r\n      var data = obj.data;\r\n      if (obj.event === \"unActive\") {\r\n        var msg = data.IsActived\r\n          ? \"确认要取消激活该设备吗?\"\r\n          : \"确认要激活该设备吗?\";\r\n        layer.confirm(msg, { icon: 3, title: \"提示\" }, function(index) {\r\n          userSeverEvent.unActive(data);\r\n        });\r\n      }\r\n    });\r\n    //服务交互\r\n    var userSeverEvent = {\r\n      addMac: function(data) {\r\n        layer.closeAll();\r\n        layer.load(0, { shade: false });\r\n        var dataBean = layui.setter.basePostData;\r\n        dataBean.Data = data;\r\n        var str1 = JSON.stringify(dataBean);\r\n        $.ajax({\r\n          type: \"Post\",\r\n          url: layui.setter.huibleUrl + \"/api/IccWchat/regist\",\r\n          data: str1,\r\n          async: true,\r\n          dataType: \"json\",\r\n          headers: {\r\n            Accept: \"application/json\",\r\n            \"Content-Type\": \"application/json\"\r\n          },\r\n          success: function(data) {\r\n            layer.closeAll();\r\n            console.log(data);\r\n            if (data.IsSucceed) {\r\n              layer.msg(\"添加用户成功!\", { icon: 6 });\r\n              table.reload(\"userFilesTable\");\r\n            } else {\r\n              table.reload(\"userFilesTable\");\r\n              layer.msg(\"失败\" + data, { icon: 5 });\r\n            }\r\n          },\r\n          error: function(err) {\r\n            layer.closeAll();\r\n            layer.msg(\"数据操作失败\", { icon: 5 });\r\n          }\r\n        });\r\n      },\r\n      unActive: function(data) {\r\n        layer.closeAll();\r\n        layer.load(0, { shade: false });\r\n        var dataBean = layui.setter.basePostData;\r\n        dataBean.Data = {\r\n          IsActived: !data.IsActived,\r\n          RegistId: data.Id\r\n        };\r\n        var str1 = JSON.stringify(dataBean);\r\n        $.ajax({\r\n          type: \"put\",\r\n          url: layui.setter.huibleUrl + \"/api/IccWchat/regist\",\r\n          data: str1,\r\n          async: true,\r\n          dataType: \"json\",\r\n          headers: {\r\n            Accept: \"application/json\",\r\n            \"Content-Type\": \"application/json\"\r\n          },\r\n          success: function(res) {\r\n            layer.closeAll();\r\n            console.log(data);\r\n            if (res.IsSucceed) {\r\n              var msg = data.IsActived ? \"设备取消激活成功!\" : \"设备激活成功!\";\r\n              layer.msg(msg, { icon: 6 });\r\n              table.reload(\"userFilesTable\");\r\n            } else {\r\n              table.reload(\"userFilesTable\");\r\n              layer.msg(\"失败\" + res.Errors[0], { icon: 5 });\r\n            }\r\n          },\r\n          error: function(err) {\r\n            layer.closeAll();\r\n            layer.msg(\"数据操作失败\", { icon: 5 });\r\n          }\r\n        });\r\n      }\r\n    };\r\n    //事件\r\n    var active = {\r\n      add: function() {\r\n        layer.open({\r\n          type: 1,\r\n          title: \"新增设备注册信息\", //不显示标题\r\n          content: $(\"#rigist-from\"),\r\n          area: [\"500px\"],\r\n          btn: [\"确认\", \"取消\"],\r\n          yes: function() {\r\n            var macData = {\r\n              Mac: $(\"#Mac\").val(),\r\n              Description: \"\",\r\n              DeviceType: \"blue\",\r\n              IsForce: \"fasle\"\r\n            };\r\n            var MacStr = macData.Mac.substr(0, 7);\r\n            if (MacStr !== \"34008AD\") {\r\n              layer.msg(\"请输入34008AD开始的MAC号!\");\r\n              return;\r\n            } else if (macData.Mac.length !== 12) {\r\n              layer.msg(\"MAC号为12位字符串!\");\r\n              return;\r\n            }\r\n            userSeverEvent.addMac(macData);\r\n          },\r\n          btn2: function(index, layero) {\r\n            console.log(\"取消锁定解锁1\");\r\n          }\r\n        });\r\n      }\r\n    };\r\n    //按钮操作\r\n    $(\".layui-btn\").on(\"click\", function() {\r\n      var type = $(this).data(\"type\");\r\n      active[type] ? active[type].call(this) : \"\";\r\n    });\r\n  });\r\n"]}