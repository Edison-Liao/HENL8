{"version":3,"sources":["tpl/tree/organTree.js"],"names":["layui","config","base","extend","index","use","$","form","layer","table","common","tree","z_treeConfig","on","data","console","log","field","topName","organ","baseData","editFalge","server","eidtOrgan","addOrgan","init","this","getTreeData","render","showtips","event","treeObj","id","nodeData","sunNodeFalge","click","html","isDisableButton","currData","getcheckedData","openDeleteConfirm","ajaxFun","then","res","appResult","isSucceeded","iconCode","addIcon","Result","TreeNodes","renderTree","loadErrorText","fail","err","getNodedata","flage","urlID","showForm","load","ajax","type","url","setter","baseUrl","dataType","headers","Accept","Content-Type","success","closeAll","IsSucceed","dataNode","val","Name","Code","Message","msg","Errors","icon","error","callback","onClick","treeOnClick","check","enable","confirm","Title","btn","delet","Flag","Id","length","i","iconOpen","Children","getTreeNodeName","treeData","title","e","node","getCheckedNodes"],"mappings":";EAAA,YAAAA,OACGC,QACCC,KAAM,yBAEPC,QACCC,MAAO,cAERC,KACE,QAAS,QAAS,QAAS,SAAU,SAAU,gBAChD,WACE,GAAIC,GAAIN,MAAMM,EACZC,EAAOP,MAAMO,KAEbC,GADQR,MAAMS,MACNT,MAAMQ,OAEdE,GADOV,MAAMW,KACJX,MAAMU,OACAV,OAAMY,YAEvBL,GAAKM,GAAG,yBAA0B,SAASC,GAUzC,MATAC,SAAQC,IAAIF,EAAKG,MAAO,cACjBH,GAAKG,MAAMC,QACdC,EAAMC,SAASC,WACjBN,QAAQC,IAAI,UACZG,EAAMG,OAAOC,UAAUT,EAAKG,MAAO,YAAa,gBAEhDE,EAAMG,OAAOE,SAASV,EAAKG,MAAO,YAAa,cAC/CF,QAAQC,IAAI,YAEP,GAKT,IAAIG,IACFM,KAAM,WACJC,KAAKJ,OAAOK,cACZD,KAAKE,OAAOC,WACZH,KAAKI,SAEPV,UACEW,WACAC,GAAI,GACJC,YACAC,cAAc,EACdb,WAAW,GAEbS,MAAO,WACLxB,EAAE,YAAY6B,MAAM,WAClB7B,EAAE,cAAc8B,KAAK,IACrBjB,EAAMG,OAAOK,cAEbjB,EAAO2B,gBAAgB,UAAU,GACjC3B,EAAO2B,gBAAgB,UAAU,KAEnC/B,EAAE,mBAAmB6B,MAAM,WACzBhB,EAAMmB,SAASC,mBAEjBjC,EAAE,cAAc6B,MAAM,cACtB7B,EAAE,UAAU6B,MAAM,WAChBhB,EAAMS,OAAOY,kBAAkBrB,EAAMC,SAASa,aAGlDX,QACEK,YAAa,WACXZ,QAAQC,IAAI,UACZN,EACG+B,QAAQ,MAAO,uBACfC,KAAK,SAASC,GACb,GAAIjC,EAAOkC,UAAUC,YAAYF,GAAM,CACrC,GAAIG,GAAW3B,EAAMmB,SAASS,QAAQJ,EAAIK,OAAOC,UAEjD9B,GAAMS,OAAOsB,WAAWJ,OAExBpC,GAAOkC,UAAUO,cAAcR,KAGlCS,KAAK,SAAAC,GACJtC,QAAQC,IAAIqC,MAGlBC,YAAa,SAASC,EAAOvB,GAC3B,GAAIwB,GAAQ,EACZ,IAAc,gBAAVD,EACFC,EAAQ,aAAexB,EACvBb,EAAMS,OAAO6B,SAAS,uBACjB,CAAA,GAAc,aAAVF,EAIT,MAHAC,GAAQ,aAAexB,EACvBb,EAAMS,OAAO6B,SAAS,cAIxBjD,EAAMkD,KAAK,GACXpD,EAAEqD,MACAC,KAAM,MACNC,IAAK7D,MAAM8D,OAAOC,QAAUP,EAC5BQ,SAAU,OACVC,SACEC,OAAQ,mBACRC,eAAgB,oBAElBC,QAAS,SAAStD,GAGhB,GAFAN,EAAM6D,WAEFvD,EAAKwD,UAAW,CAClBnD,EAAMC,SAASa,SAAWnB,EAAKkC,MAC/B,IAAIuB,GAAWzD,EAAKkC,MACN,iBAAVO,EACFhD,EAAKiE,IAAI,kBACPC,KAAMF,EAASE,KACfC,KAAMH,EAASG,KACfC,QAASJ,EAASI,UAED,aAAVpB,GACThD,EAAKiE,IAAI,aACPC,KAAMF,EAASE,KACfC,KAAMH,EAASG,KACfC,QAASJ,EAASI,cAItBnE,GAAMoE,IAAI,aAAe9D,EAAK+D,OAAO,GAAGF,SACtCG,KAAM,KAIZC,MAAO,SAAS1B,GACd7C,EAAM6D,WACN7D,EAAMoE,IAAI,UAAYE,KAAM,SAKpClD,QACEsB,WAAY,SAASpC,GAEnBK,EAAMC,SAASW,QAAU/B,MAAMY,aAAasC,WAC1CpC,EACA,cAEEkE,UACEC,QAAS9D,EAAMmB,SAAS4C,aAE1BC,OACEC,QAAQ,MAKhBvD,SAAU,WACRnB,EAAOmB,SAAS,4BAElBW,kBAAmB,SAAS1B,GAC1BN,EAAM6E,QACJ,0CACEvE,EAAKwE,MACL,gBAEAC,KAAM,KAAM,MACZT,KAAM,GAER,WACE3D,EAAMG,OAAOkE,MAAM1E,EAAK2E,KAAM3E,EAAK4E,KAErC,WACE3E,QAAQC,IAAI,UAKpBsB,UACES,QAAS,SAASjC,GAEhB,GADAC,QAAQC,IAAIF,EAAM,MACdA,EAAK6E,OAAS,EAChB,IAAK,GAAIC,GAAI,EAAGA,EAAI9E,EAAK6E,OAAQC,IACV,UAAjB9E,EAAK8E,GAAGH,MACV3E,EAAK8E,GAAGd,KACN,qDACFhE,EAAK8E,GAAGC,SACN,wDACwB,eAAjB/E,EAAK8E,GAAGH,MACjB3E,EAAK8E,GAAGd,KACN,wDACFhE,EAAK8E,GAAGC,SACN,2DACwB,aAAjB/E,EAAK8E,GAAGH,MACjB3E,EAAK8E,GAAGd,KACN,sDACFhE,EAAK8E,GAAGC,SACN,yDACwB,UAAjB/E,EAAK8E,GAAGH,aACV3E,GAAK8E,GAAGE,SACfhF,EAAK8E,GAAGd,KACN,mDACFhE,EAAK8E,GAAGC,SACN,sDAEA/E,EAAK8E,GAAGE,UAAYhF,EAAK8E,GAAGE,SAASH,OAAS,GAChDxE,EAAMmB,SAASS,QAAQjC,EAAK8E,GAAGE,SAIrC,OAAOhF,IAETiF,gBAAiB,SAASC,EAAUhE,GAClC,GAAIiE,GAAQvF,EAAOqF,gBAAgBC,EAAUhE,EAAI,OACjD1B,GAAE,YAAYkE,IAAIyB,GAClB3F,EAAE,WAAW8B,KAAK,SAGpB8C,YAAa,SAASgB,EAAGlE,EAAImE,GAC3BpF,QAAQC,IAAImF,GACZzF,EAAO2B,gBAAgB,UAAU,GACjC3B,EAAO2B,gBAAgB,cAAc,GACrClB,EAAMC,SAASa,SAAWkE,GAG5B5D,eA/CQ,WAiDN,GAAIzB,GAAOK,EAAMC,SAASW,QAAQqE,iBAAgB,EAClDrF,SAAQC,IAAIF,EAAM,UAIxBK,GAAMM","file":"../../../../tpl/tree/organTree.js","sourcesContent":["layui\r\n  .config({\r\n    base: \"../../../layuiadmin/\"\r\n  })\r\n  .extend({\r\n    index: \"lib/index\" //主入口模块\r\n  })\r\n  .use(\r\n    [\"index\", \"table\", \"layer\", \"common\", \"consts\", \"z_treeConfig\"],\r\n    function() {\r\n      var $ = layui.$,\r\n        form = layui.form,\r\n        table = layui.table,\r\n        layer = layui.layer,\r\n        tree = layui.tree,\r\n        common = layui.common,\r\n        z_treeConfig = layui.z_treeConfig;\r\n      //数据表单监听(部门)\r\n      form.on(\"submit(DepartmentFrom)\", function(data) {\r\n        console.log(data.field, \"新增部门\");\r\n        delete data.field.topName;\r\n        if (organ.baseData.editFalge) {\r\n          console.log(\"执行编辑命令\");\r\n          organ.server.eidtOrgan(data.field, \"/api/Role\", \"department\");\r\n        } else {\r\n          organ.server.addOrgan(data.field, \"/api/Role\", \"department\");\r\n          console.log(\"执行添加命令\");\r\n        }\r\n        return false;\r\n      });\r\n      //数据表单监听(角色)\r\n\r\n      //organ\r\n      var organ = {\r\n        init: function() {\r\n          this.server.getTreeData();\r\n          this.render.showtips();\r\n          this.event();\r\n        },\r\n        baseData: {\r\n          treeObj: {},\r\n          id: \"\",\r\n          nodeData: {},\r\n          sunNodeFalge: false,\r\n          editFalge: false\r\n        },\r\n        event: function() {\r\n          $(\"#refresh\").click(function() {\r\n            $(\"#treeOrgan\").html(\"\");\r\n            organ.server.getTreeData();\r\n\r\n            common.isDisableButton(\"#delet\", true);\r\n            common.isDisableButton(\"#delet\", true);\r\n          });\r\n          $(\"#showDepartment\").click(function() {\r\n            organ.currData.getcheckedData();\r\n          });\r\n          $(\"#showStaff\").click(function() {});\r\n          $(\"#delet\").click(function() {\r\n            organ.render.openDeleteConfirm(organ.baseData.nodeData);\r\n          });\r\n        },\r\n        server: {\r\n          getTreeData: function() {\r\n            console.log(\"获取数据信息\");\r\n            common\r\n              .ajaxFun(\"get\", \"/api/Organ/treeview\")\r\n              .then(function(res) {\r\n                if (common.appResult.isSucceeded(res)) {\r\n                  var iconCode = organ.currData.addIcon(res.Result.TreeNodes);\r\n                  //渲染树\r\n                  organ.render.renderTree(iconCode);\r\n                } else {\r\n                  common.appResult.loadErrorText(res);\r\n                }\r\n              })\r\n              .fail(err => {\r\n                console.log(err);\r\n              });\r\n          },\r\n          getNodedata: function(flage, id) {\r\n            var urlID = \"\";\r\n            if (flage === \"roleCatalog\") {\r\n              urlID = \"/api/Role/\" + id;\r\n              organ.render.showForm(\"#DepartmentFrom\");\r\n            } else if (flage === \"roleInfo\") {\r\n              urlID = \"/api/Role/\" + id;\r\n              organ.render.showForm(\"#staffFrom\");\r\n            } else {\r\n              return;\r\n            }\r\n            layer.load(2);\r\n            $.ajax({\r\n              type: \"get\",\r\n              url: layui.setter.baseUrl + urlID,\r\n              dataType: \"json\",\r\n              headers: {\r\n                Accept: \"application/json\",\r\n                \"Content-Type\": \"application/json\"\r\n              },\r\n              success: function(data) {\r\n                layer.closeAll();\r\n\r\n                if (data.IsSucceed) {\r\n                  organ.baseData.nodeData = data.Result;\r\n                  var dataNode = data.Result;\r\n                  if (flage === \"roleCatalog\") {\r\n                    form.val(\"DepartmentFrom\", {\r\n                      Name: dataNode.Name,\r\n                      Code: dataNode.Code,\r\n                      Message: dataNode.Message\r\n                    });\r\n                  } else if (flage === \"roleInfo\") {\r\n                    form.val(\"staffFrom\", {\r\n                      Name: dataNode.Name,\r\n                      Code: dataNode.Code,\r\n                      Message: dataNode.Message\r\n                    });\r\n                  }\r\n                } else {\r\n                  layer.msg(\"获取节点数据失败! \" + data.Errors[0].Message, {\r\n                    icon: 5\r\n                  });\r\n                }\r\n              },\r\n              error: function(err) {\r\n                layer.closeAll();\r\n                layer.msg(\"数据操作失败\", { icon: 5 });\r\n              }\r\n            });\r\n          }\r\n        },\r\n        render: {\r\n          renderTree: function(data) {\r\n            //渲染树 1.数据 2.DOM节点 3.配置项目\r\n            organ.baseData.treeObj = layui.z_treeConfig.renderTree(\r\n              data,\r\n              \"treeRegion\",\r\n              {\r\n                callback: {\r\n                  onClick: organ.currData.treeOnClick\r\n                },\r\n                check: {\r\n                  enable: true\r\n                }\r\n              }\r\n            );\r\n          },\r\n          showtips: function() {\r\n            common.showtips(\".layui-btn-group button\");\r\n          },\r\n          openDeleteConfirm: function(data) {\r\n            layer.confirm(\r\n              \"你确定要删除<span style='font-weight:bolder'>\" +\r\n                data.Title +\r\n                \"</span>的节点吗?\",\r\n              {\r\n                btn: [\"确定\", \"取消\"], //按钮\r\n                icon: 3\r\n              },\r\n              function() {\r\n                organ.server.delet(data.Flag, data.Id);\r\n              },\r\n              function() {\r\n                console.log(\"取消\");\r\n              }\r\n            );\r\n          }\r\n        },\r\n        currData: {\r\n          addIcon: function(data) {\r\n            console.log(data, \"数据\");\r\n            if (data.length > 0) {\r\n              for (var i = 0; i < data.length; i++) {\r\n                if (data[i].Flag === \"organ\") {\r\n                  data[i].icon =\r\n                    \"../../../layuiadmin/style/img/ztreeImg/company.png\";\r\n                  data[i].iconOpen =\r\n                    \"../../../layuiadmin/style/img/ztreeImg/companyOp.png\";\r\n                } else if (data[i].Flag === \"department\") {\r\n                  data[i].icon =\r\n                    \"../../../layuiadmin/style/img/ztreeImg/department.png\";\r\n                  data[i].iconOpen =\r\n                    \"../../../layuiadmin/style/img/ztreeImg/departmentOp.png\";\r\n                } else if (data[i].Flag === \"position\") {\r\n                  data[i].icon =\r\n                    \"../../../layuiadmin/style/img/ztreeImg/position.png\";\r\n                  data[i].iconOpen =\r\n                    \"../../../layuiadmin/style/img/ztreeImg/positionOp.png\";\r\n                } else if (data[i].Flag === \"staff\") {\r\n                  delete data[i].Children;\r\n                  data[i].icon =\r\n                    \"../../../layuiadmin/style/img/ztreeImg/staff.png\";\r\n                  data[i].iconOpen =\r\n                    \"../../../layuiadmin/style/img/ztreeImg/staffOp.png\";\r\n                }\r\n                if (data[i].Children && data[i].Children.length > 0) {\r\n                  organ.currData.addIcon(data[i].Children);\r\n                }\r\n              }\r\n            }\r\n            return data;\r\n          },\r\n          getTreeNodeName: function(treeData, id) {\r\n            var title = common.getTreeNodeName(treeData, id, \"name\");\r\n            $(\".topName\").val(title);\r\n            $(\".submit\").html(\"立即修改\");\r\n          },\r\n          //每个节点的点击事件\r\n          treeOnClick: function(e, id, node) {\r\n            console.log(node);\r\n            common.isDisableButton(\"#delet\", false);\r\n            common.isDisableButton(\"#showStaff\", false);\r\n            organ.baseData.nodeData = node;\r\n          },\r\n          //获取勾选的数据\r\n          getcheckedData() {\r\n            //获取节点\r\n            var data = organ.baseData.treeObj.getCheckedNodes(true);\r\n            console.log(data, \"打印节点\");\r\n          }\r\n        }\r\n      };\r\n      organ.init();\r\n    }\r\n  );\r\n"]}