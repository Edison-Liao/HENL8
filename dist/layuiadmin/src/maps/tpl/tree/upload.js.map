{"version":3,"sources":["tpl/tree/upload.js"],"names":["layui","config","base","extend","index","use","showImgBox","file","result","icon","alink","name","el","$","jquery","common","upload","uploadInst","render","elem","url","before","obj","preview","attr","done","res","code","layer","msg","error","demoText","html","find","on","e","stopPropagation","console","log","photos","shade","anim","_this","this","ajaxFun","then","appResult","isSucceeded","loadErrorText","fail","err","parent","hide","multiple","append","accept","exts","size","tips","item"],"mappings":";EAAA,YAAAA,OACGC,QACCC,KAAM,yBAEPC,QACCC,MAAO,cAERC,KAAK,QAAS,SAAU,UAAW,WAiClC,QAASC,GAAWF,EAAOG,EAAMC,GAC/B,GAAIC,GACF,6cACEC,EAAAA,8DACFH,EAAKI,KADH,KAECJ,EAAKI,KAFN,OAGAC,EAAAA,8CAAmDJ,EAAnD,UAAmEA,EAAnE,UACFD,EAAKI,KADH,8BAE0BD,EAF1B,6BAE4DD,EAF5D,WAGJ,OAAOG,GAzCT,GAAIC,GAAIb,MAAMc,MACbC,QAASf,MAAMe,OAAUC,OAAShB,MAAMgB,MAGzC,IAAIC,GAAaD,OAAOE,QACtBC,KAAM,sBACNC,IAAK,WACLC,OAAQ,SAASC,GAEfA,EAAIC,QAAQ,SAASnB,EAAOG,EAAMC,GAChCK,EAAE,2BAA2BW,KAAK,MAAOhB,MAG7CiB,KAAM,SAASC,GAEb,GAAIA,EAAIC,KAAO,EACb,MAAOC,OAAMC,IAAI,SAIrBC,MAAO,WAEL,GAAIC,GAAWlB,EAAE,wBACjBkB,GAASC,KACP,oGAEFD,EAASE,KAAK,gBAAgBC,GAAG,QAAS,WACxCjB,EAAWD,aAiBjBH,GAAE,QAAQqB,GAAG,QAAS,gBAAiB,SAASC,GAC9CA,EAAEC,kBAEFC,QAAQC,IAAI,MACZV,MAAMW,QACJC,OAAQ,GAAK,QACbD,OAAQ,gBACRE,KAAM,MAIV5B,EAAE,0BAA0BqB,GAAG,QAAS,kBAAmB,SAASC,GAAG,GAAAO,GAAAC,IACrER,GAAEC,kBACFrB,OACG6B,QAAQ,OAAQ,aAChBC,KAAK,SAASnB,GACTX,OAAO+B,UAAUC,YAAYrB,IAG/BX,OAAO+B,UAAUE,cAActB,KAGlCuB,KAAK,SAAAC,GACJb,QAAQC,IAAI,OACZzB,EAAE6B,GACCS,SACAC,KAAK,OAEZf,QAAQC,IAAI,QAKdtB,OAAOE,QACLC,KAAM,oBACNC,IAAK,WACLiC,UAAU,EACVhC,OAAQ,SAASC,GACfe,QAAQC,IAAIhB,EAAK,OAEjBA,EAAIC,QAAQ,SAASnB,EAAOG,EAAMC,GAChCK,EAAE,0BAA0ByC,OAAOhD,EAAWF,EAAOG,EAAMC,OAG/DiB,KAAM,SAASC,OAMjBV,OAAOE,QACLC,KAAM,qBACNC,IAAK,WACLmC,OAAQ,OACR9B,KAAM,SAASC,GACbW,QAAQC,IAAIZ,MAGhBV,OAAOE,QAELC,KAAM,qBACNC,IAAK,WACLmC,OAAQ,OACRC,KAAM,aACN/B,KAAM,SAASC,GACbW,QAAQC,IAAIZ,MAGhBV,OAAOE,QACLC,KAAM,qBACNC,IAAK,WACLmC,OAAQ,QACR9B,KAAM,SAASC,GACbW,QAAQC,IAAIZ,MAGhBV,OAAOE,QACLC,KAAM,qBACNC,IAAK,WACLmC,OAAQ,QACR9B,KAAM,SAASC,GACbW,QAAQC,IAAIZ,MAKhBV,OAAOE,QACLC,KAAM,oBACNC,IAAK,WACLqC,KAAM,IACNhC,KAAM,SAASC,GACbW,QAAQC,IAAIZ,MAKhBV,OAAOE,QACLC,KAAM,wBACNE,OAAQ,WACNO,MAAM8B,KAAK,QAAUf,KAAKvB,IAAKuB,KAAKgB,MAAQD,KAAM,KAEpDjC,KAAM,SAASC,EAAKtB,EAAOY,GACzB,GAAI2C,GAAOhB,KAAKgB,IAChBtB,SAAQC,IAAIqB","file":"../../../../tpl/tree/upload.js","sourcesContent":["layui\r\n  .config({\r\n    base: \"../../../layuiadmin/\" //静态资源所在路径\r\n  })\r\n  .extend({\r\n    index: \"lib/index\" //主入口模块\r\n  })\r\n  .use([\"index\", \"upload\", \"common\"], function() {\r\n    var $ = layui.jquery;\r\n    (common = layui.common), (upload = layui.upload);\r\n\r\n    //普通图片上传\r\n    var uploadInst = upload.render({\r\n      elem: \"#test-upload-normal\",\r\n      url: \"/upload/\",\r\n      before: function(obj) {\r\n        //预读本地文件示例，不支持ie8\r\n        obj.preview(function(index, file, result) {\r\n          $(\"#test-upload-normal-img\").attr(\"src\", result); //图片链接（base64）\r\n        });\r\n      },\r\n      done: function(res) {\r\n        //如果上传失败\r\n        if (res.code > 0) {\r\n          return layer.msg(\"上传失败\");\r\n        }\r\n        //上传成功\r\n      },\r\n      error: function() {\r\n        //演示失败状态，并实现重传\r\n        var demoText = $(\"#test-upload-demoText\");\r\n        demoText.html(\r\n          '<span style=\"color: #FF5722;\">上传失败</span> <a class=\"layui-btn layui-btn-mini demo-reload\">重试</a>'\r\n        );\r\n        demoText.find(\".demo-reload\").on(\"click\", function() {\r\n          uploadInst.upload();\r\n        });\r\n      }\r\n    });\r\n\r\n    function showImgBox(index, file, result) {\r\n      var icon =\r\n        '<svg viewBox=\"64 64 896 896\" class=\"\" data-icon=\"close\" width=\"1em\" height=\"1em\" fill=\"currentColor\" aria-hidden=\"true\"><path d=\"M563.8 512l262.5-312.9c4.4-5.2.7-13.1-6.1-13.1h-79.8c-4.7 0-9.2 2.1-12.3 5.7L511.6 449.8 295.1 191.7c-3-3.6-7.5-5.7-12.3-5.7H203c-6.8 0-10.5 7.9-6.1 13.1L459.4 512 196.9 824.9A7.95 7.95 0 0 0 203 838h79.8c4.7 0 9.2-2.1 12.3-5.7l216.5-258.1 216.5 258.1c3 3.6 7.5 5.7 12.3 5.7h79.8c6.8 0 10.5-7.9 6.1-13.1L563.8 512z\"></path></svg>';\r\n      var alink = `<a class=\"alink\"   class=\"ant-upload-list-item-name\" title=${\r\n        file.name\r\n      } >${file.name}</a>`;\r\n      var el = `<div class=\"img_list_box\"><img  layer-src=\"${result}\" src=\"${result}\" alt=\"${\r\n        file.name\r\n      }\" class=\"layui-upload-img\">${alink}<i class='close_btn_icon'>${icon}<i></div>`;\r\n      return el;\r\n    }\r\n    //图片盒子(预览)\r\n    $(\"body\").on(\"click\", \".img_list_box\", function(e) {\r\n      e.stopPropagation();\r\n\r\n      console.log(\"预览\");\r\n      layer.photos({\r\n        shade: [0.7, \"#000\"],\r\n        photos: \".img_list_box\",\r\n        anim: 0\r\n      });\r\n    });\r\n    //删除(图片消失)\r\n    $(\"#test-upload-more-list\").on(\"click\", \".close_btn_icon\", function(e) {\r\n      e.stopPropagation();\r\n      common\r\n        .ajaxFun(\"post\", \"/api/....\")\r\n        .then(function(res) {\r\n          if (common.appResult.isSucceeded(res)) {\r\n            //$(this).parent().hide(700);\r\n          } else {\r\n            common.appResult.loadErrorText(res);\r\n          }\r\n        })\r\n        .fail(err => {\r\n          console.log(\"错处啦\");\r\n          $(this)\r\n            .parent()\r\n            .hide(700);\r\n        });\r\n      console.log(\"关闭\");\r\n\r\n      // console.log($(this).parent(), '父级节点')\r\n    });\r\n    //多图片上传\r\n    upload.render({\r\n      elem: \"#test-upload-more\",\r\n      url: \"/upload/\",\r\n      multiple: true,\r\n      before: function(obj) {\r\n        console.log(obj, \"~~~\");\r\n        //预读本地文件示例，不支持ie8\r\n        obj.preview(function(index, file, result) {\r\n          $(\"#test-upload-more-list\").append(showImgBox(index, file, result));\r\n        });\r\n      },\r\n      done: function(res) {\r\n        //上传完毕\r\n      }\r\n    });\r\n\r\n    //指定允许上传的文件类型\r\n    upload.render({\r\n      elem: \"#test-upload-type1\",\r\n      url: \"/upload/\",\r\n      accept: \"file\", //普通文件\r\n      done: function(res) {\r\n        console.log(res);\r\n      }\r\n    });\r\n    upload.render({\r\n      //允许上传的文件后缀\r\n      elem: \"#test-upload-type2\",\r\n      url: \"/upload/\",\r\n      accept: \"file\", //普通文件\r\n      exts: \"zip|rar|7z\", //只允许上传压缩文件\r\n      done: function(res) {\r\n        console.log(res);\r\n      }\r\n    });\r\n    upload.render({\r\n      elem: \"#test-upload-type3\",\r\n      url: \"/upload/\",\r\n      accept: \"video\", //视频\r\n      done: function(res) {\r\n        console.log(res);\r\n      }\r\n    });\r\n    upload.render({\r\n      elem: \"#test-upload-type4\",\r\n      url: \"/upload/\",\r\n      accept: \"audio\", //音频\r\n      done: function(res) {\r\n        console.log(res);\r\n      }\r\n    });\r\n\r\n    //设定文件大小限制\r\n    upload.render({\r\n      elem: \"#test-upload-size\",\r\n      url: \"/upload/\",\r\n      size: 1000, //限制文件大小，单位 KB\r\n      done: function(res) {\r\n        console.log(res);\r\n      }\r\n    });\r\n\r\n    //同时绑定多个元素，并将属性设定在元素上\r\n    upload.render({\r\n      elem: \".test-upload-demoMore\",\r\n      before: function() {\r\n        layer.tips(\"接口地址：\" + this.url, this.item, { tips: 1 });\r\n      },\r\n      done: function(res, index, upload) {\r\n        var item = this.item;\r\n        console.log(item); //获取当前触发上传的元素，layui 2.1.0 新增\r\n      }\r\n    });\r\n  });\r\n"]}