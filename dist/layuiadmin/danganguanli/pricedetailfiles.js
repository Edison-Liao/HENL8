/** layuiAdmin.std-v1.0.0 LPPL License By http://www.layui.com/admin/ */
 ;"use strict";layui.config({base:"../../../layuiadmin/"}).extend({index:"lib/index"}).use(["index","table","layer","tree","jquery_ztree_excheck","utils","common","consts"],function(){var e=layui.$,t=layui.form,i=layui.table,r=layui.layer,n=(layui.tree,layui.ztree,layui.jquery_ztree_excheck,layui.utils),a=(layui.common,[]),o=[],l=[];t.on("submit(Handler-search)",function(e){var t=e.field;console.log(e,"数据"),i.reload("priceDetailFilesTable",{where:t})});i.render({elem:"#priceDetailFilesTable",url:layui.setter.revenueUrl+"/api/PriceDetail/query/list",parseData:layui.setter.parseData,request:layui.setter.request,where:{Method:"list","Data.CompanyCoding":"string"},cols:[[{title:"价格类型名称",templet:function(e){return e.PriceName}},{title:"价格类型编号",templet:function(e){return e.PriceCoding}},{title:"价格版本",templet:function(e){return e.Me.PriceVersion}},{title:"基础价格",templet:function(e){return e.Me.BasePrice}},{title:"是否启用阶梯",templet:function(e){return e.Me.IsLadder===!0?"是":"否"}},{title:"创建时间",templet:function(e){return"<div>"+layui.util.toDateString(e.Me.CreateDate)+"</div>"}},{title:"操作",width:150,align:"center",fixed:"right",toolbar:"#table-Handler"}]],loading:!0,page:!0,limit:10,text:{none:layui.consts.DATA_NO}});i.on("tool(table-Handler)",function(e){console.log(e.event,"obj 监听工具条"),"delete"===e.event&&s["delete"]({Tip:"是否确认删除？",Method:"remove",Data:{Id:e.data.Me.Id}}),"edit"===e.event&&s.edit({type:e.event,haveArray:!0,ladderType:JSON.stringify(a),surchargeType:JSON.stringify(o),surchargeStartType:JSON.stringify(l),data:JSON.stringify([e.data])})});var c={getLadderType:function(){n.request("/api/PriceDetail/priceladdertypestatus",{Method:"priceladdertypestatus"},"GET",function(e){if(e.IsSucceed)a=e.Result;else{var t=e.Errors[0].Message;r.msg(t,{icon:5})}},function(e){console.log(e,"err")})},getSurchargeType:function(){n.request("/api/PriceDetail/pricesurchargetypestatus",{Method:"pricesurchargetypestatus"},"GET",function(e){if(e.IsSucceed)o=e.Result;else{var t=e.Errors[0].Message;r.msg(t,{icon:5})}},function(e){console.log(e,"err")})},getSurchargeStartType:function(){n.request("/api/PriceDetail/pricesurchargestarttypestatus",{Method:"pricesurchargestarttypestatus"},"GET",function(e){if(e.IsSucceed)l=e.Result;else{var t=e.Errors[0].Message;r.msg(t,{icon:5})}},function(e){console.log(e,"err")})},getSomeTypes:function(e,t){n.request("/api/PriceDetail/"+e,{Method:e},"GET",function(e){if(e.IsSucceed)t=e.Result;else{var i=e.Errors[0].Message;r.msg(i,{icon:5})}},function(e){console.log(e,"err")})},insertPriceDetail:function(e){n.request("/api/PriceDetail/insert",e,"POST",function(e){if(e.IsSucceed)i.reload("priceDetailFilesTable"),r.msg("新增成功",{icon:1});else{var t=e.Errors[0].Message;r.msg(t,{icon:5})}},function(e){console.log(e,"err")},{contentType:"application/json"})},addPriceDetail:function(e){n.request("/api/Common/GetInsertGuid",{},"GET",function(t){console.log(t,"获取 Guid res"),t.IsSucceed?(e.Data.Idd=t.Result,e.Data.PriceTypeID=t.Result,c.insertPriceDetail(e)):r.msg("获取Guid失败",{icon:5})},function(e){console.log(e,"获取 Guid err")})},editPriceDetail:function(e){n.request("/api/PriceDetail/update",e,"PUT",function(e){if(e.IsSucceed)i.reload("priceDetailFilesTable"),r.msg("修改成功",{icon:1});else{var t=e.Errors[0].Message;r.msg(t,{icon:5})}},function(e){console.log(e,"err")},{contentType:"application/json"})},delPriceDetail:function(e){n.request("/api/PriceDetail/remove",e,"DELETE",function(e){e.IsSucceed?(i.reload("priceDetailFilesTable"),r.msg("删除成功",{icon:1})):r.msg("删除失败",{icon:5})},function(e){console.log(e,"err")},{contentType:"application/json"})}},s={"export":function(){console.log("导出数据")},create:function(t){console.log("新增");var i="../tpl/from/priceDetailForm.html?"+e.param(t);r.open({type:2,title:"新增价格明细",content:i,maxmin:!0,area:["700px","400px"],btn:["确定","取消"],yes:function(e,t){console.log("点击确定");var i=window["layui-layer-iframe"+e],n="LAY-pricetype-files-submit",a=t.find("iframe").contents().find("#"+n);i.layui.form.on("submit("+n+")",function(t){var i=t.field;i.PriceStartDateTime=new Date(i.PriceStartDateTime).toISOString(),i.PriceEndDateTime=new Date(i.PriceEndDateTime).toISOString();var n={Method:"insert",Data:i};console.log(n,"新增价格明细 params"),c.addPriceDetail(n),r.close(e)}),a.trigger("click")},btn2:function(){console.log("点击取消")},cancel:function(){console.log("点击取消")}})},edit:function(t){console.log("编辑");var i="../tpl/from/priceDetailForm.html?"+e.param(t);r.open({type:2,title:"编辑价格明细",content:i,maxmin:!0,area:["700px","400px"],btn:["确定","取消"],yes:function(i,n){console.log("点击确定");var a=window["layui-layer-iframe"+i],o="LAY-pricetype-files-submit",l=n.find("iframe").contents().find("#"+o);a.layui.form.on("submit("+o+")",function(n){var a=JSON.parse(t.data)[0],o=e.extend({},n.field,{Id:a.Id}),l={Method:"update",Data:o};console.log(l,"passFields"),c.editPriceDetail(l),r.close(i)}),l.trigger("click")},btn2:function(){console.log("点击取消")},cancel:function(){console.log("点击取消")}})},"delete":function(e){console.log("删除",e),r.confirm(e.Tip,{icon:3,title:"删除提示"},function(){console.log(e.Data.Id,"待删除的ID"),c.delPriceDetail(e)})}};e(".layui-btn").on("click",function(){var t=e(this).data("type");s[t]?s[t].call(this,{type:t,haveArray:!0,ladderType:JSON.stringify(a),surchargeType:JSON.stringify(o),surchargeStartType:JSON.stringify(l),data:[]}):""}),c.getLadderType(),c.getSurchargeType(),c.getSurchargeStartType()});
//# sourceMappingURL=../src/maps/danganguanli/pricedetailfiles.js.map
